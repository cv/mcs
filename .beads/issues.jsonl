{"id":"mcs-05wz","title":"Extract mock server helper for API error tests","description":"Error type tests in client_test.go and client_integration_test.go share similar mock server setup patterns. Extract reusable helper.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T10:06:17.058454-08:00","updated_at":"2025-12-23T10:16:58.2199-08:00","closed_at":"2025-12-23T10:16:58.2199-08:00","close_reason":"Addressed as part of mcs-3c9w - setupErrorServer helper covers API error test patterns"}
{"id":"mcs-0gj","title":"Convert control_test.go to table-driven tests","description":"Lines 26-240 contain 10 nearly identical test functions for control endpoints. Convert to single table-driven test with struct containing name, endpoint, and method.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T08:10:06.829419-08:00","updated_at":"2025-12-19T08:54:09.17012-08:00","closed_at":"2025-12-19T08:54:09.17012-08:00","close_reason":"Converted 11 test functions to single table-driven test, reduced ~57 lines","dependencies":[{"issue_id":"mcs-0gj","depends_on_id":"mcs-1h0","type":"blocks","created_at":"2025-12-19T08:11:00.78099-08:00","created_by":"daemon"}]}
{"id":"mcs-0ln","title":"CLAUDE.md: Outdated Response Structs table - missing OdometerKm field","description":"## Problem\n\nCLAUDE.md documents GetOdometerInfo() as returning OdometerInfo with a field named 'Kilometers', but the actual implementation in types.go uses 'OdometerKm'.\n\nCLAUDE.md line 85:\n`| GetOdometerInfo() | OdometerInfo | Kilometers |`\n\nActual code in internal/api/types.go:\n```go\ntype OdometerInfo struct {\n    OdometerKm float64\n}\n```\n\n## Location\n- /Users/carlosvillela/src/dummy/mysmartcar/mcs/CLAUDE.md (line 85)\n- /Users/carlosvillela/src/dummy/mysmartcar/mcs/internal/api/types.go (lines 379-382)\n\n## How to Fix\nUpdate CLAUDE.md Response Structs table to show 'OdometerKm' instead of 'Kilometers'.\n\n## Development Guidelines\n- TDD: Write/update tests before changing code\n- DTSTTCPW: Do the simplest thing that could possibly work\n- DRY: Don't repeat yourself\n- No lint ignores, no failing tests\n- Small commits, quality focus","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T17:46:55.675767-08:00","updated_at":"2025-12-19T18:09:20.285116-08:00","closed_at":"2025-12-19T18:09:20.285116-08:00","close_reason":"Fixed Response Structs table to match actual types.go definitions"}
{"id":"mcs-0vf","title":"Extract ResultCodeSuccess constant","description":"Magic string '200S00' appears 5+ times across vehicle.go, types.go. Define const ResultCodeSuccess = '200S00'.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T08:10:34.553938-08:00","updated_at":"2025-12-19T08:31:24.713071-08:00","closed_at":"2025-12-19T08:31:24.713071-08:00","close_reason":"Extracted ResultCodeSuccess constant, replaced 4+ hardcoded occurrences"}
{"id":"mcs-0yn","title":"Add Example field to 'mcs raw' command","description":"Add Cobra Example field to raw command showing example JSON output structure for debugging use cases.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T08:15:10.386042-08:00","updated_at":"2025-12-19T09:38:57.99149-08:00","closed_at":"2025-12-19T09:38:57.99149-08:00","close_reason":"Added Example fields to raw command and status/ev/vehicle subcommands","dependencies":[{"issue_id":"mcs-0yn","depends_on_id":"mcs-kd7","type":"blocks","created_at":"2025-12-19T08:15:17.804003-08:00","created_by":"daemon"}]}
{"id":"mcs-1","title":"Initialize Go module and project structure","description":"Create go.mod, directory structure (cmd/cx90, internal/api, internal/config, internal/cli)","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-18T00:17:33.514372-08:00","updated_at":"2025-12-18T22:36:26.034539-08:00","closed_at":"2025-12-18T00:24:48.770456-08:00"}
{"id":"mcs-10","title":"Implement root CLI command","description":"Version flag, help, config path display, cobra root setup","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-18T00:17:43.537957-08:00","updated_at":"2025-12-18T22:36:26.036228-08:00","closed_at":"2025-12-18T00:36:59.078451-08:00","dependencies":[{"issue_id":"mcs-10","depends_on_id":"mcs-2","type":"blocks","created_at":"2025-12-18T00:18:01.88321-08:00","created_by":"carlosvillela","metadata":"{}"},{"issue_id":"mcs-10","depends_on_id":"mcs-9","type":"blocks","created_at":"2025-12-18T00:18:01.889795-08:00","created_by":"carlosvillela","metadata":"{}"}]}
{"id":"mcs-11","title":"Implement status command","description":"cx90 status with subcommands: battery, fuel, location, tires, doors. Human-readable and --json output","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-18T00:17:43.543139-08:00","updated_at":"2025-12-18T22:36:26.036003-08:00","closed_at":"2025-12-18T00:53:26.855614-08:00","dependencies":[{"issue_id":"mcs-11","depends_on_id":"mcs-10","type":"blocks","created_at":"2025-12-18T00:18:07.194671-08:00","created_by":"carlosvillela","metadata":"{}"},{"issue_id":"mcs-11","depends_on_id":"mcs-6","type":"blocks","created_at":"2025-12-18T00:18:07.199414-08:00","created_by":"carlosvillela","metadata":"{}"},{"issue_id":"mcs-11","depends_on_id":"mcs-7","type":"blocks","created_at":"2025-12-18T00:18:07.203873-08:00","created_by":"carlosvillela","metadata":"{}"}]}
{"id":"mcs-12","title":"Implement lock/unlock commands","description":"cx90 lock, cx90 unlock with --yes flag to skip confirmation","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-18T00:17:43.547819-08:00","updated_at":"2025-12-18T22:36:26.042793-08:00","closed_at":"2025-12-18T00:54:26.997324-08:00","dependencies":[{"issue_id":"mcs-12","depends_on_id":"mcs-10","type":"blocks","created_at":"2025-12-18T00:18:07.209377-08:00","created_by":"carlosvillela","metadata":"{}"},{"issue_id":"mcs-12","depends_on_id":"mcs-8","type":"blocks","created_at":"2025-12-18T00:18:07.215147-08:00","created_by":"carlosvillela","metadata":"{}"}]}
{"id":"mcs-13","title":"Implement start/stop commands","description":"cx90 start (remote start), cx90 stop (stop engine)","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-18T00:17:43.552355-08:00","updated_at":"2025-12-18T22:36:26.04259-08:00","closed_at":"2025-12-18T00:55:24.580242-08:00","dependencies":[{"issue_id":"mcs-13","depends_on_id":"mcs-10","type":"blocks","created_at":"2025-12-18T00:18:07.221048-08:00","created_by":"carlosvillela","metadata":"{}"},{"issue_id":"mcs-13","depends_on_id":"mcs-8","type":"blocks","created_at":"2025-12-18T00:18:07.226248-08:00","created_by":"carlosvillela","metadata":"{}"}]}
{"id":"mcs-14","title":"Implement charge commands","description":"cx90 charge start, cx90 charge stop","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-18T00:17:43.556858-08:00","updated_at":"2025-12-18T22:36:26.042389-08:00","closed_at":"2025-12-18T00:56:54.474374-08:00","dependencies":[{"issue_id":"mcs-14","depends_on_id":"mcs-10","type":"blocks","created_at":"2025-12-18T00:18:07.230776-08:00","created_by":"carlosvillela","metadata":"{}"},{"issue_id":"mcs-14","depends_on_id":"mcs-8","type":"blocks","created_at":"2025-12-18T00:18:07.234897-08:00","created_by":"carlosvillela","metadata":"{}"}]}
{"id":"mcs-15","title":"Implement climate commands","description":"cx90 climate on/off/set \u003ctemp\u003e/defrost","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-18T00:17:43.561036-08:00","updated_at":"2025-12-18T22:36:26.042188-08:00","closed_at":"2025-12-18T00:57:57.917391-08:00","dependencies":[{"issue_id":"mcs-15","depends_on_id":"mcs-10","type":"blocks","created_at":"2025-12-18T00:18:07.239455-08:00","created_by":"carlosvillela","metadata":"{}"},{"issue_id":"mcs-15","depends_on_id":"mcs-8","type":"blocks","created_at":"2025-12-18T00:18:07.244136-08:00","created_by":"carlosvillela","metadata":"{}"}]}
{"id":"mcs-16","title":"Implement raw debug commands","description":"cx90 raw status, cx90 raw ev - output raw JSON from API","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-18T00:17:43.565243-08:00","updated_at":"2025-12-18T22:36:26.045121-08:00","closed_at":"2025-12-18T00:59:12.867538-08:00","dependencies":[{"issue_id":"mcs-16","depends_on_id":"mcs-10","type":"blocks","created_at":"2025-12-18T00:18:07.248145-08:00","created_by":"carlosvillela","metadata":"{}"},{"issue_id":"mcs-16","depends_on_id":"mcs-6","type":"blocks","created_at":"2025-12-18T00:18:07.252491-08:00","created_by":"carlosvillela","metadata":"{}"},{"issue_id":"mcs-16","depends_on_id":"mcs-7","type":"blocks","created_at":"2025-12-18T00:18:07.256685-08:00","created_by":"carlosvillela","metadata":"{}"}]}
{"id":"mcs-17","title":"Implement token caching","description":"Cache access token in ~/.cache/cx90/token.json, check expiration, refresh when needed","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-18T00:17:49.423185-08:00","updated_at":"2025-12-18T22:36:26.041989-08:00","closed_at":"2025-12-18T01:27:53.601686-08:00","dependencies":[{"issue_id":"mcs-17","depends_on_id":"mcs-4","type":"blocks","created_at":"2025-12-18T00:18:07.260882-08:00","created_by":"carlosvillela","metadata":"{}"}]}
{"id":"mcs-18","title":"Add pretty terminal output","description":"Colored output, progress bars for battery/fuel, formatted tables","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-18T00:17:49.427952-08:00","updated_at":"2025-12-19T09:44:55.623622-08:00","closed_at":"2025-12-19T09:44:55.623622-08:00","close_reason":"Added ANSI colors, progress bars, TTY detection, --no-color flag - all with zero dependencies","dependencies":[{"issue_id":"mcs-18","depends_on_id":"mcs-11","type":"blocks","created_at":"2025-12-18T00:18:07.26603-08:00","created_by":"carlosvillela","metadata":"{}"}]}
{"id":"mcs-19","title":"Add shell completions","description":"cx90 completion bash/zsh/fish","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-18T00:17:49.432188-08:00","updated_at":"2025-12-18T22:36:26.044642-08:00","closed_at":"2025-12-18T01:20:42.336885-08:00","dependencies":[{"issue_id":"mcs-19","depends_on_id":"mcs-10","type":"blocks","created_at":"2025-12-18T00:18:07.271686-08:00","created_by":"carlosvillela","metadata":"{}"}]}
{"id":"mcs-1gh","title":"Add Example field to 'mcs lock' and 'mcs unlock' commands","description":"Add Cobra Example field to lock and unlock commands. Show success output examples.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T08:15:09.93608-08:00","updated_at":"2025-12-19T09:32:06.94352-08:00","closed_at":"2025-12-19T09:32:06.94352-08:00","close_reason":"Added Example fields to lock and unlock commands, updated SimpleCommandConfig to support examples","dependencies":[{"issue_id":"mcs-1gh","depends_on_id":"mcs-kd7","type":"blocks","created_at":"2025-12-19T08:15:17.565584-08:00","created_by":"daemon"}]}
{"id":"mcs-1h0","title":"Enhance test helpers in test_helpers_test.go","description":"createSuccessServer barely used, createErrorServer could accept more params. Add helper for testing all control endpoints at once.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T08:10:34.925551-08:00","updated_at":"2025-12-19T08:51:14.624794-08:00","closed_at":"2025-12-19T08:51:14.624794-08:00","close_reason":"Enhanced createErrorServer, promoted createControlTestServer to shared helpers, eliminated ~110 lines in control_test.go"}
{"id":"mcs-1jfz","title":"CLAUDE.md: crypto package has two locations - confusing documentation","description":"## Problem\n\nCLAUDE.md documents crypto functions in two places which could confuse developers:\n\n1. internal/api/crypto.go - documented as 'AES-128-CBC, RSA encryption'\n2. internal/crypto/crypto.go - documented as 'AES and PKCS7 padding utilities'\n\nThe relationship between these is not clear from the documentation:\n- internal/crypto/crypto.go has the low-level implementations\n- internal/api/crypto.go wraps those for API use (adds base64 encoding, uses api.IV constant)\n\n## Location\n- /Users/carlosvillela/src/dummy/mysmartcar/mcs/CLAUDE.md (lines 12 and 32-33)\n- /Users/carlosvillela/src/dummy/mysmartcar/mcs/internal/api/crypto.go\n- /Users/carlosvillela/src/dummy/mysmartcar/mcs/internal/crypto/crypto.go\n\n## How to Fix\nClarify the relationship in CLAUDE.md:\n- internal/crypto/crypto.go: Low-level AES/PKCS7 primitives (used by sensordata too)\n- internal/api/crypto.go: API-specific wrappers (adds base64, uses fixed IV, includes RSA)\n\nOr consolidate if the separation isn't necessary.\n\n## Development Guidelines\n- TDD, DTSTTCPW, DRY\n- No lint ignores, no failing tests\n- Small commits, quality focus","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T17:49:56.447799-08:00","updated_at":"2025-12-20T17:21:20.043494-08:00","closed_at":"2025-12-20T17:21:20.043494-08:00","close_reason":"Fixed in docs commit 13fbe00"}
{"id":"mcs-1lb","title":"Tests: Use table-driven tests consistently in status_test.go","description":"## Summary\nThe status_test.go file doesn't consistently use table-driven tests, making some test cases harder to follow.\n\n## Proposed Solution\nRefactor to use table-driven tests consistently throughout.\n\n## Files to Modify\n- `internal/cli/status_test.go`\n\n## Development Guidelines\n- **TDD**: Write tests first, then implementation\n- **DTSTTCPW**: Do the simplest thing that could possibly work\n- **DRY**: Don't repeat yourself\n- **No lint ignores**: All code must pass `golangci-lint run` without ignores\n- **No failing tests**: All tests must pass before committing\n- **Small frequent commits**: Commit after each logical change\n- **Attention to detail and high quality**: Clean code, proper error handling, good naming","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T13:40:43.097839-08:00","updated_at":"2025-12-19T16:06:04.200313-08:00","closed_at":"2025-12-19T16:06:04.200313-08:00","close_reason":"Converted 14 test functions to table-driven pattern"}
{"id":"mcs-1ms","title":"Replace status type strings with typed enum","description":"status_cmd.go uses magic strings 'all', 'battery', 'fuel', etc. Create StatusType enum for type safety.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T08:10:34.199276-08:00","updated_at":"2025-12-19T08:37:56.353762-08:00","closed_at":"2025-12-19T08:37:56.353762-08:00","close_reason":"Created StatusType enum with 9 constants, updated function signatures for type safety"}
{"id":"mcs-1rsk","title":"Debug logging prints sensitive data","description":"When debug mode is enabled, logRequest prints full headers and original body, which may contain sensitive fields such as email, password, or access tokens","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T23:14:41.931767-08:00","updated_at":"2025-12-20T16:20:54.577859-08:00","closed_at":"2025-12-20T16:20:54.577859-08:00","close_reason":"Low risk: access-token is already redacted in logRequest. Login function (which has email) doesn't use logRequest. Password is RSA-encrypted before being added to request body. Response body is encrypted payload."}
{"id":"mcs-2","title":"Add cobra and viper dependencies","description":"go get cobra, viper for CLI framework and config management","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-18T00:17:33.519847-08:00","updated_at":"2025-12-18T22:36:26.037365-08:00","closed_at":"2025-12-18T00:26:01.604305-08:00","dependencies":[{"issue_id":"mcs-2","depends_on_id":"mcs-1","type":"blocks","created_at":"2025-12-18T00:18:01.829145-08:00","created_by":"carlosvillela","metadata":"{}"}]}
{"id":"mcs-20","title":"Add Google Maps link to location output","description":"When displaying location info (cx90 status location), include a clickable Google Maps URL like https://maps.google.com/?q=LAT,LON","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-18T01:50:32.591602-08:00","updated_at":"2025-12-18T22:36:26.044462-08:00","closed_at":"2025-12-18T01:51:37.517925-08:00"}
{"id":"mcs-21","title":"Fix unsafe type assertions in status.go and getInternalVIN","description":"Multiple unguarded type assertions can panic at runtime:\n- getInternalVIN (status.go:177-199) - panic on unexpected vehicle format\n- extractBatteryInfo (status.go:266-278) - panic on missing EV data\n- extractClimateInfo, extractTireInfo, etc.\n\nAll map[string]interface{} type assertions should use safe form:\n  val, ok := data[\"key\"].(Type)\n  if !ok { return error }\n\nFiles: internal/cli/status.go","design":"## Fix locations:\n- getInternalVIN (status.go:177-199) - 3 unsafe assertions\n- extractBatteryInfo (266-278) - 6 unsafe\n- extractClimateInfo - 4 unsafe\n- extractTireInfo - 3 unsafe\n- extractDoorInfo - 4 unsafe\n\nBetter approach: implement mcs-23 first, then json.Unmarshal handles safety","acceptance_criteria":"- [ ] All type assertions use safe form with ok check\n- [ ] Appropriate error messages for type mismatches\n- [ ] No panic possible from API response parsing\n- [ ] All tests pass","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-18T03:19:07.034509-08:00","updated_at":"2025-12-18T22:36:26.033604-08:00","closed_at":"2025-12-18T03:42:55.543567-08:00","dependencies":[{"issue_id":"mcs-21","depends_on_id":"mcs-23","type":"related","created_at":"2025-12-18T03:20:19.967059-08:00","created_by":"carlosvillela","metadata":"{}"}]}
{"id":"mcs-21t","title":"CLAUDE.md: DoorStatus struct documentation incomplete and inaccurate","description":"## Problem\n\nCLAUDE.md documents GetDoorsInfo() as returning DoorStatus with 'Driver, Passenger, RearLeft, RearRight, Hood, Trunk + lock status', but actual implementation has many more fields with different naming.\n\nCLAUDE.md line 82:\n`| GetDoorsInfo() | DoorStatus | Driver, Passenger, RearLeft, RearRight, Hood, Trunk + lock status |`\n\nActual code in internal/api/types.go:\n```go\ntype DoorStatus struct {\n    DriverOpen      bool\n    PassengerOpen   bool\n    RearLeftOpen    bool\n    RearRightOpen   bool\n    TrunkOpen       bool\n    HoodOpen        bool\n    FuelLidOpen     bool\n    DriverLocked    bool\n    PassengerLocked bool\n    RearLeftLocked  bool\n    RearRightLocked bool\n    AllLocked       bool\n}\n```\n\nMissing from docs: FuelLidOpen, AllLocked. Also, field naming uses explicit Open/Locked suffixes.\n\n## Location\n- /Users/carlosvillela/src/dummy/mysmartcar/mcs/CLAUDE.md (line 82)\n- /Users/carlosvillela/src/dummy/mysmartcar/mcs/internal/api/types.go (lines 330-344)\n\n## How to Fix\nUpdate CLAUDE.md to accurately list all fields or provide a more concise but accurate summary.\n\n## Development Guidelines\n- TDD, DTSTTCPW, DRY\n- No lint ignores, no failing tests\n- Small commits, quality focus","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T17:47:29.785776-08:00","updated_at":"2025-12-19T18:09:20.351694-08:00","closed_at":"2025-12-19T18:09:20.351694-08:00","close_reason":"Fixed Response Structs table to match actual types.go definitions"}
{"id":"mcs-22","title":"Extract common CLI setup boilerplate into helper","description":"All CLI command handlers (lock.go, engine.go, charge.go, climate.go, raw.go) contain ~25 identical lines:\n  client, err := createAPIClient()\n  defer saveClientCache(client)\n  vecBaseInfos, err := client.GetVecBaseInfos()\n  internalVIN, err := getInternalVIN(vecBaseInfos)\n\nThis pattern repeats 10+ times totaling ~200 lines.\n\nCreate helper:\n  func withVehicleClient(fn func(*api.Client, string) error) error\n\nFiles: internal/cli/lock.go, engine.go, charge.go, climate.go, raw.go","design":"## Helper signature:\n```go\nfunc withVehicleClient(fn func(*api.Client, string) error) error\n```\n\nThen each command becomes:\n```go\nfunc runLock(cmd *cobra.Command, args []string) error {\n    return withVehicleClient(func(client *api.Client, vin string) error {\n        return client.DoorLock(vin)\n    })\n}\n```\n\nFiles: lock.go, engine.go, charge.go, climate.go, raw.go","acceptance_criteria":"- [ ] withVehicleClient helper exists in client.go\n- [ ] All 10 command handlers use the helper\n- [ ] No duplicate client setup code remains\n- [ ] All tests pass\n- [ ] golangci-lint passes","status":"closed","priority":0,"issue_type":"chore","created_at":"2025-12-18T03:19:24.764835-08:00","updated_at":"2025-12-18T22:36:26.033367-08:00","closed_at":"2025-12-18T03:46:33.38379-08:00"}
{"id":"mcs-23","title":"Define typed structs for API responses instead of map[string]interface{}","description":"The entire API layer uses map[string]interface{} for responses. This causes:\n- Unsafe type assertions throughout the code\n- No compile-time type checking  \n- Poor discoverability of available fields\n- Runtime panic risk\n\nDefine structs like:\n  type EVVehicleStatus struct {\n    ResultCode string\n    ResultData []EVResultData\n  }\n  type ChargeInfo struct {\n    SmaphSOC float64\n    SmaphRemDrvDistKm float64\n    ...\n  }\n\nFiles: internal/api/vehicle.go, internal/cli/status.go","design":"## Strategy:\n1. Create internal/api/types.go with response structs\n2. Use `mcs raw status` and `mcs raw ev` to capture real JSON for struct definitions\n3. Update API methods to return typed responses\n4. This naturally fixes mcs-21 (unsafe type assertions)\n\nNote: InternalVIN field comes as float64 OR string - use interface{} or custom unmarshaler","acceptance_criteria":"- [ ] internal/api/types.go exists with response structs\n- [ ] GetVecBaseInfos returns typed response\n- [ ] GetVehicleStatus returns typed response\n- [ ] GetEVVehicleStatus returns typed response\n- [ ] No map[string]interface{} in public API signatures\n- [ ] All tests pass","status":"closed","priority":0,"issue_type":"chore","created_at":"2025-12-18T03:19:24.817991-08:00","updated_at":"2025-12-18T22:36:26.032842-08:00","closed_at":"2025-12-18T03:42:51.407977-08:00"}
{"id":"mcs-24","title":"Consolidate duplicate control functions in API layer","description":"All 11 control functions (DoorLock, DoorUnlock, EngineStart, etc.) in control.go have identical structure:\n  bodyParams := map[string]interface{}{...}\n  response, err := c.APIRequest(...)\n  if resultCode != \"200S00\" { return error }\n\nExtract generic helper:\n  func (c *Client) executeControlCommand(internalVIN, endpoint, actionDesc string) error\n\nReduces ~200 lines to ~30 lines.\n\nFiles: internal/api/control.go","design":"## All 11 endpoints follow same pattern:\ndoorLock, doorUnLock, lightOn, lightOff, engineStart, engineStop, evChargeStart, evChargeStop, hvacOn, hvacOff, vehicleStatus\n\nExtract:\n```go\nfunc (c *Client) executeControl(endpoint, action, internalVIN string) error\n```\n\nEach public method becomes one-liner calling executeControl.","acceptance_criteria":"- [ ] executeControl helper function exists\n- [ ] All 11 control functions use the helper\n- [ ] Each public function is ≤5 lines\n- [ ] All tests pass","status":"closed","priority":1,"issue_type":"chore","created_at":"2025-12-18T03:19:24.876602-08:00","updated_at":"2025-12-18T22:36:26.035807-08:00","closed_at":"2025-12-18T11:10:40.232391-08:00"}
{"id":"mcs-25","title":"Complete or remove incomplete test stubs","description":"Several test functions contain placeholder comments like 'Test will be implemented when APIRequest exists' but APIRequest already exists:\n- client_test.go:99-100\n- client_test.go:125-126\n- client_test.go:152-153\n- client_test.go:262-264\n- client_test.go:301-303\n- client_test.go:343-344\n\nEither complete the tests or remove the stubs.\n\nFiles: internal/api/client_test.go","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T03:19:24.936813-08:00","updated_at":"2025-12-18T22:36:26.035589-08:00","closed_at":"2025-12-18T11:16:20.174023-08:00"}
{"id":"mcs-26","title":"Refactor CLI tests to use table-driven pattern","description":"Tests for status subcommands (battery, fuel, location, tires, doors) repeat same pattern:\n  cmd := NewStatusCmd()\n  for _, subCmd := range cmd.Commands() {\n    if subCmd.Use == \"battery\" { ... }\n  }\n\nConvert to table-driven test:\n  subcommands := []string{\"battery\", \"fuel\", \"location\", \"tires\", \"doors\"}\n  for _, name := range subcommands {\n    t.Run(name, func(t *testing.T) { ... })\n  }\n\nAlso deduplicate test client setup using shared fixtures.\n\nFiles: internal/cli/status_test.go, internal/api/vehicle_test.go","acceptance_criteria":"- [ ] Subcommand tests use table-driven pattern\n- [ ] Test client setup uses shared helper\n- [ ] Tests clearly document expected behavior\n- [ ] No duplicate test setup code\n- [ ] All tests pass","status":"closed","priority":1,"issue_type":"chore","created_at":"2025-12-18T03:19:24.991759-08:00","updated_at":"2025-12-18T22:36:26.035364-08:00","closed_at":"2025-12-18T11:19:43.041731-08:00","dependencies":[{"issue_id":"mcs-26","depends_on_id":"mcs-25","type":"related","created_at":"2025-12-18T03:20:22.636349-08:00","created_by":"carlosvillela","metadata":"{}"}]}
{"id":"mcs-2683","title":"Improve confirmation polling: 20s HVAC delay, 5s poll interval, in-place progress","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T03:21:15.478627-08:00","updated_at":"2025-12-21T03:21:22.183812-08:00","closed_at":"2025-12-21T03:21:22.183812-08:00","close_reason":"Implemented: 20s initial delay for HVAC commands, 5s poll interval, in-place progress updates with carriage return"}
{"id":"mcs-27","title":"Add context.Context support to API client","description":"The API client doesn't support Go's context.Context for cancellation and timeouts. This is important for CLI applications where users might want to cancel long-running operations.\n\nAdd context parameter to API methods:\n  func (c *Client) APIRequest(ctx context.Context, method, uri string, ...) error\n  func (c *Client) DoorLock(ctx context.Context, internalVIN string) error\n\nFiles: internal/api/client.go, control.go, vehicle.go","design":"## Migration:\n1. Add ctx param to APIRequest, use http.NewRequestWithContext\n2. Update control.go and vehicle.go functions\n3. CLI: use cmd.Context() from cobra or context.WithTimeout\n\nStart with context.TODO() during migration, replace incrementally","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-18T03:19:25.041813-08:00","updated_at":"2025-12-18T22:36:26.035167-08:00","closed_at":"2025-12-18T11:34:23.679134-08:00"}
{"id":"mcs-278q","title":"Remove redundant mcs status subcommands","description":"The `mcs status` command has subcommands (battery, fuel, location, tires, doors) that are redundant with the main status output.\n\n## Current state\n- `mcs status` shows all info: battery, fuel, HVAC, doors, windows, hazards, tires, location, odometer\n- Subcommands show individual sections: battery, fuel, location, tires, doors\n- Inconsistent: some sections have subcommands, some don't (windows, hvac, odometer)\n\n## Proposal\nRemove all subcommands. The main `mcs status` command provides all the info, and `mcs status --json` can be used for scripting.\n\n## Subcommands to remove\n- `mcs status battery`\n- `mcs status fuel`\n- `mcs status location`\n- `mcs status tires`\n- `mcs status doors`","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T10:12:51.254642-08:00","updated_at":"2025-12-29T10:16:24.463278-08:00","closed_at":"2025-12-29T10:16:24.463278-08:00","close_reason":"Closed"}
{"id":"mcs-28","title":"Replace custom base64Encode with stdlib","description":"A custom base64 encoding function (30 lines) is implemented when Go's standard library provides this.\n\nLocation: internal/api/auth.go:379-410\n\nReplace with:\n  encoding/base64.StdEncoding.EncodeToString(data)\n\nwhich is already used elsewhere in the codebase (crypto.go:32).","status":"closed","priority":1,"issue_type":"chore","created_at":"2025-12-18T03:19:47.250193-08:00","updated_at":"2025-12-18T22:36:26.034948-08:00","closed_at":"2025-12-18T11:09:39.669959-08:00"}
{"id":"mcs-29","title":"Remove hardcoded vehicle model from status output","description":"The vehicle model is hardcoded in status.go:223:\n  output := \"\\nCX-90 GT PHEV (2025)\\n\"\n\nThis should be extracted from vecBaseInfos or made configurable to support other vehicle models.\n\nFiles: internal/cli/status.go","design":"## Options:\n1. Extract from vecBaseInfos response (preferred) - look for CarName/ModelName/ModelYear fields\n2. Add to config.toml as fallback\n\nRun `mcs raw status` to see actual JSON structure for field names","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-18T03:19:47.315867-08:00","updated_at":"2025-12-18T22:36:26.034754-08:00","closed_at":"2025-12-18T11:08:33.964914-08:00"}
{"id":"mcs-29on","title":"Nil pointer dereference when TokenCache.Load returns nil","description":"TokenCache.Load returns nil when the cache file does not exist, but callers may not check for nil before dereferencing, risking runtime panics","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T23:14:33.414852-08:00","updated_at":"2025-12-20T16:20:04.064735-08:00","closed_at":"2025-12-20T16:20:04.064735-08:00","close_reason":"Not a bug. Load() returning nil is documented behavior. TestLoad_NoCache verifies this. Callers are expected to check for nil."}
{"id":"mcs-2dk","title":"CLAUDE.md: Response Structs table shows wrong WindowStatus fields","description":"## Problem\n\nCLAUDE.md documents GetWindowsInfo() as returning WindowStatus with fields 'FrontLeft, FrontRight, RearLeft, RearRight', but actual implementation uses '*Position' suffix.\n\nCLAUDE.md line 83:\n`| GetWindowsInfo() | WindowStatus | FrontLeft, FrontRight, RearLeft, RearRight |`\n\nActual code in internal/api/types.go:\n```go\ntype WindowStatus struct {\n    DriverPosition    float64\n    PassengerPosition float64\n    RearLeftPosition  float64\n    RearRightPosition float64\n}\n```\n\nNote: Not only are field names different (Position suffix, Driver/Passenger instead of FrontLeft/FrontRight), but the naming convention is completely different.\n\n## Location\n- /Users/carlosvillela/src/dummy/mysmartcar/mcs/CLAUDE.md (line 83)\n- /Users/carlosvillela/src/dummy/mysmartcar/mcs/internal/api/types.go (lines 385-390)\n\n## How to Fix\nUpdate CLAUDE.md to show: 'DriverPosition, PassengerPosition, RearLeftPosition, RearRightPosition'\n\n## Development Guidelines\n- TDD, DTSTTCPW, DRY\n- No lint ignores, no failing tests\n- Small commits, quality focus","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T17:47:20.259132-08:00","updated_at":"2025-12-19T18:09:20.334995-08:00","closed_at":"2025-12-19T18:09:20.334995-08:00","close_reason":"Fixed Response Structs table to match actual types.go definitions"}
{"id":"mcs-2kj","title":"Refactor: Move sensordata random generation helpers to shared utilities","description":"## Summary\nThe sensordata package has random generation helpers that could be useful elsewhere.\n\n## Proposed Solution\nMove random generation helpers to a shared utilities package if needed elsewhere.\n\n## Files to Modify\n- `internal/sensordata/`\n- Potential new utilities package\n\n## Development Guidelines\n- **TDD**: Write tests first, then implementation\n- **DTSTTCPW**: Do the simplest thing that could possibly work\n- **DRY**: Don't repeat yourself\n- **No lint ignores**: All code must pass `golangci-lint run` without ignores\n- **No failing tests**: All tests must pass before committing\n- **Small frequent commits**: Commit after each logical change\n- **Attention to detail and high quality**: Clean code, proper error handling, good naming","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T13:40:51.75137-08:00","updated_at":"2025-12-19T16:08:25.537949-08:00","closed_at":"2025-12-19T16:08:25.537949-08:00","close_reason":"Not needed - random helpers are domain-specific to sensordata, no duplication found"}
{"id":"mcs-2mrp","title":"Remove problematic key rotation goroutine from NewClient","description":"mcs-8ho7 introduced a background goroutine that: (1) silently discards errors, (2) has no shutdown mechanism, (3) uses context.Background() so not cancellable, (4) leaks resources since goroutine never terminates, (5) uses arbitrary 24h interval. For a CLI tool that runs for seconds, this is wasteful. The existing retry mechanism already handles stale keys via EncryptionError retry logic.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-20T13:46:36.162475-08:00","updated_at":"2025-12-20T16:05:23.794221-08:00","closed_at":"2025-12-20T16:05:23.794221-08:00","close_reason":"Removed goroutine and rotateTicker field from Client. The existing EncryptionError retry logic handles stale keys."}
{"id":"mcs-2rj","title":"Add --confirm flag to 'mcs lock' command","description":"## Summary\nAdd a `--confirm` flag (enabled by default) to the `mcs lock` command that polls vehicle status until the doors are confirmed locked, instead of the current fire-and-forget behavior.\n\n## Current Behavior\nThe `mcs lock` command sends the lock request to the API and immediately returns with a success message, without verifying the doors actually locked.\n\n## Desired Behavior\n- Add `--confirm` flag (default: true) to poll status after sending lock command\n- Use polling logic similar to `refreshAndWaitForStatus` in `status_cmd.go:257`\n- Poll until `GetDoorsInfo()` shows all doors locked (`all_locked: true`)\n- Support `--confirm-wait` flag to configure max wait time (default: 90s)\n- Use `--confirm=false` to skip confirmation and use fire-and-forget behavior\n- Show progress messages while waiting (e.g., \"Waiting for door lock confirmation... (30s/90s)\")\n\n## Files to Modify\n- `internal/cli/lock.go` - Add flag handling\n- `internal/cli/command_factory.go` - May need to extend SimpleCommandConfig to support confirmation\n- Add new confirmation polling logic (consider DRY with status_cmd.go polling)\n\n## Development Guidelines\n- **TDD**: Write tests first, then implementation\n- **DTSTTCPW**: Do the simplest thing that could possibly work\n- **DRY**: Extract shared polling logic if applicable to other confirm commands\n- **No lint ignores**: All code must pass golangci-lint without ignores\n- **No failing tests**: All tests must pass before committing\n- **Small frequent commits**: Commit after each logical change\n- **Attention to detail and quality**: Clean code, proper error handling, good UX","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-19T11:00:17.983676-08:00","updated_at":"2025-12-19T11:08:16.648633-08:00","closed_at":"2025-12-19T11:08:16.648633-08:00","close_reason":"Implemented --confirm flag with reusable polling infrastructure"}
{"id":"mcs-2ue","title":"Standardize error handling in types.go getter methods","description":"Inconsistent error handling: GetBatteryInfo/GetFuelInfo/GetLocationInfo return errors, but GetHvacInfo (lines 265-279) silently returns zero values. Callers can't tell if nil means 'no data' or 'parsing error'. Standardize on (T, error) pattern. File: internal/api/types.go","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T23:39:00.124051-08:00","updated_at":"2025-12-19T00:56:36.954956-08:00","closed_at":"2025-12-19T00:56:36.954956-08:00","close_reason":"Standardized all getters to return (T, error) - updated GetHvacInfo and GetOccurrenceDate","dependencies":[{"issue_id":"mcs-2ue","depends_on_id":"mcs-swm","type":"blocks","created_at":"2025-12-19T00:23:21.082254-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"mcs-3","title":"Implement crypto utilities","description":"AES-128-CBC encryption/decryption, RSA-ECB-PKCS1 password encryption, MD5/SHA256 signing, device ID generation from email hash","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-18T00:17:33.525784-08:00","updated_at":"2025-12-18T22:36:26.034314-08:00","closed_at":"2025-12-18T00:29:19.579439-08:00","dependencies":[{"issue_id":"mcs-3","depends_on_id":"mcs-1","type":"blocks","created_at":"2025-12-18T00:18:01.834357-08:00","created_by":"carlosvillela","metadata":"{}"}]}
{"id":"mcs-30","title":"Consolidate duplicated crypto functions (PKCS7, AES)","description":"The following functions are implemented twice:\n\n1. pkcs7Pad - internal/api/crypto.go:128-158 AND internal/sensordata/sensor_data.go:277-285\n\n2. encryptAES128CBC - internal/api/crypto.go:18-33 AND internal/sensordata/sensor_data.go:260-275\n\nMove to a shared internal/crypto utility package.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-18T03:19:47.399102-08:00","updated_at":"2025-12-18T22:36:26.041815-08:00","closed_at":"2025-12-18T11:36:54.035746-08:00"}
{"id":"mcs-31","title":"Extract __INTERNAL_ID__ magic string to constant","description":"The string \"__INTERNAL_ID__\" is hardcoded in every API request body:\n- vehicle.go:8,17,42\n- control.go (11 occurrences)\n\nDefine as constant:\n  const InternalUserID = \"__INTERNAL_ID__\"","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-18T03:19:47.457635-08:00","updated_at":"2025-12-18T22:36:26.041639-08:00","closed_at":"2025-12-18T11:11:47.668267-08:00"}
{"id":"mcs-32","title":"Clean up unused code: PrintConfigPath, NewInvalidRegionError","description":"Unused functions should be removed or used:\n\n1. PrintConfigPath (root.go:76-83) - defined but never called\n   → Either remove or add a 'config' subcommand\n\n2. NewInvalidRegionError (errors.go:60-62) - defined but NewClient uses fmt.Errorf instead\n   → Either use it in auth.go:97 or remove it","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-18T03:19:47.521121-08:00","updated_at":"2025-12-18T22:36:26.041464-08:00","closed_at":"2025-12-18T11:37:48.820789-08:00"}
{"id":"mcs-33","title":"Standardize error message capitalization to lowercase","description":"Error messages use inconsistent capitalization:\n\n  return fmt.Errorf(\"Failed to get vehicle status...\")  // Capital F\n  return fmt.Errorf(\"failed to get vehicle info...\")    // lowercase f\n\nGo convention is lowercase. Standardize all error messages.\n\nFiles: internal/api/vehicle.go, control.go","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-18T03:19:47.576667-08:00","updated_at":"2025-12-18T22:36:26.041288-08:00","closed_at":"2025-12-18T11:12:09.078319-08:00"}
{"id":"mcs-34","title":"Consolidate region validation to single source of truth","description":"Region validation exists in two places:\n- RegionConfigs map in auth.go:51-67\n- validRegions map in config.go:18-23\n\nThe config package should reference the API package's RegionConfigs instead of duplicating.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-18T03:20:02.045053-08:00","updated_at":"2025-12-18T22:36:26.041111-08:00","closed_at":"2025-12-18T11:38:32.133483-08:00"}
{"id":"mcs-34t","title":"Refactor: Consider extracting common JSON map assertion helpers in tests","description":"## Summary\nTests that work with JSON maps have repeated assertion patterns for checking keys and values.\n\n## Proposed Solution\nExtract common JSON map assertion helpers (assertMapHasKey, assertMapValue, etc.).\n\n## Files to Modify\n- `internal/cli/test_helpers_test.go`\n- Various test files\n\n## Development Guidelines\n- **TDD**: Write tests first, then implementation\n- **DTSTTCPW**: Do the simplest thing that could possibly work\n- **DRY**: Don't repeat yourself\n- **No lint ignores**: All code must pass `golangci-lint run` without ignores\n- **No failing tests**: All tests must pass before committing\n- **Small frequent commits**: Commit after each logical change\n- **Attention to detail and high quality**: Clean code, proper error handling, good naming","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T13:41:00.053026-08:00","updated_at":"2025-12-19T16:13:47.611419-08:00","closed_at":"2025-12-19T16:13:47.611419-08:00","close_reason":"Extracted parseJSONToMap and assertMapValue helpers, reduced ~60 lines"}
{"id":"mcs-35","title":"Create InternalVIN type alias for documentation","description":"The internal VIN is passed as plain string everywhere with no type safety or documentation.\n\nConsider:\n  type InternalVIN string\n  func (v InternalVIN) String() string { return string(v) }\n\nMinor improvement for code documentation.","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-12-18T03:20:02.138104-08:00","updated_at":"2025-12-18T22:36:26.044282-08:00","closed_at":"2025-12-18T11:12:27.36902-08:00"}
{"id":"mcs-36","title":"Extract verbose debug logging to helper method","description":"Debug logging in sendAPIRequest (client.go:157-191) is inline and clutters main logic.\n\nExtract to helper:\n  func (c *Client) logRequest(method, url string, headers map[string]string, body string)","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-12-18T03:20:02.211295-08:00","updated_at":"2025-12-18T22:36:26.044086-08:00","closed_at":"2025-12-18T11:41:13.172202-08:00"}
{"id":"mcs-36j","title":"Consolidate withVehicleClient and withVehicleClientEx","description":"withVehicleClient() (lines 77-95) and withVehicleClientEx() (lines 108-136) are 95% identical. Extract common client setup into shared helper. File: internal/cli/client.go","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T23:38:58.694526-08:00","updated_at":"2025-12-19T00:38:35.330194-08:00","closed_at":"2025-12-19T00:38:35.330194-08:00","close_reason":"Extracted setupVehicleClient() helper, eliminated ~60 lines of duplication"}
{"id":"mcs-37","title":"Extract generic JSON/text formatting helper","description":"Each format*Status function in status.go (426-551) has the same pattern for JSON output:\n  if jsonOutput {\n    data := map[string]interface{}{...}\n    jsonBytes, _ := json.MarshalIndent(data, \"\", \"  \")\n    return string(jsonBytes)\n  }\n\nExtract helper:\n  func formatOutput(data interface{}, textFn func() string, json bool) string","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-12-18T03:20:02.27639-08:00","updated_at":"2025-12-19T09:46:25.979468-08:00","closed_at":"2025-12-19T09:46:25.979468-08:00","close_reason":"Already addressed by existing toJSON() and *ToMap() helpers - no further refactoring needed"}
{"id":"mcs-38","title":"Extract touch event generation helper in sensordata","description":"The same event generation pattern (down event, move events, up event) is repeated 3 times in TouchEventList.Randomize (touch_event.go:41-140).\n\nExtract helper:\n  func (t *TouchEventList) addTouchSequence(baseTime int)","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-12-18T03:20:02.334158-08:00","updated_at":"2025-12-18T22:36:26.043735-08:00","closed_at":"2025-12-18T12:18:07.245077-08:00"}
{"id":"mcs-3869","title":"Missing validation of encryption key and IV length may cause runtime errors","description":"The AES encryption/decryption functions do not validate that the key and IV are exactly 16 bytes, which can cause NewCipher or CryptBlocks to panic at runtime if invalid lengths are passed","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T23:15:46.521324-08:00","updated_at":"2025-12-20T16:24:03.14078-08:00","closed_at":"2025-12-20T16:24:03.14078-08:00","close_reason":"Low risk. Key length is validated by aes.NewCipher (returns error). IV is hardcoded constant '0102030405060708' (16 bytes) - never user-provided. cipher.NewCBCEncrypter would panic on wrong IV but that can't happen with our constant."}
{"id":"mcs-39","title":"Add Homebrew tap support to goreleaser","description":"The .goreleaser.yml is missing Homebrew tap configuration. This would allow users to install via:\n  brew install mysmartcar/tap/mcs\n\nNeeds a brews: section added to .goreleaser.yml pointing to a homebrew-tap repository.","design":"## Add to .goreleaser.yml:\n\n```yaml\nbrews:\n  - repository:\n      owner: cv\n      name: taps\n      token: \"{{ .Env.HOMEBREW_TAP_GITHUB_TOKEN }}\"\n    directory: Formula\n    homepage: https://github.com/cv/mcs\n    description: CLI for controlling your connected vehicle\n    license: MIT\n    install: |\n      bin.install \"mcs\"\n    test: |\n      system \"#{bin}/mcs\", \"--version\"\n```\n\n## Prerequisites:\n1. Add HOMEBREW_TAP_GITHUB_TOKEN secret to CI\n\nAfter release, users can install via:\n  brew install cv/taps/mcs","acceptance_criteria":"- [ ] brews section added to .goreleaser.yml\n- [ ] homebrew-tap repository exists\n- [ ] CI has HOMEBREW_TAP_GITHUB_TOKEN secret\n- [ ] `brew install cv/tap/mcs` works after release","notes":"Taps repo: https://github.com/cv/taps","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-18T03:26:30.908772-08:00","updated_at":"2025-12-19T09:50:55.396647-08:00","closed_at":"2025-12-19T09:50:55.396647-08:00","close_reason":"Closed"}
{"id":"mcs-3bt","title":"Duplicate documentation between README.md and CLAUDE.md","description":"## Problem\n\nREADME.md and CLAUDE.md contain overlapping content that needs to be kept in sync. Both documents mention:\n\n1. Token caching location (~/.cache/mcs/token.json)\n2. Engine start limit (2 consecutive starts)\n3. App version may need updating when manufacturer updates\n\nThis creates maintenance burden and risk of divergence.\n\nREADME.md lines 84-87:\n- 'Tokens cached in ~/.cache/mcs/token.json'\n- 'Remote start limited to 2 consecutive starts without driving'\n- 'If the manufacturer updates the app, constants in internal/api/auth.go may need updating'\n\nCLAUDE.md lines 143-147, 68:\n- 'Credentials are cached in ~/.cache/mcs/token.json'\n- 'If the manufacturer updates the app, AppVersion and related user-agent strings may need updating'\n\n## Location\n- /Users/carlosvillela/src/dummy/mysmartcar/mcs/README.md (lines 84-87)\n- /Users/carlosvillela/src/dummy/mysmartcar/mcs/CLAUDE.md (lines 68, 143-147)\n\n## How to Fix\nChoose one canonical location for each piece of information:\n- README.md should focus on user-facing information\n- CLAUDE.md should focus on developer implementation details\n- Add cross-references where needed\n\n## Development Guidelines\n- TDD, DTSTTCPW, DRY\n- No lint ignores, no failing tests\n- Small commits, quality focus","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T17:48:18.931024-08:00","updated_at":"2025-12-19T17:59:29.769294-08:00","closed_at":"2025-12-19T17:59:29.769294-08:00","close_reason":"Consolidated docs - README for users, CLAUDE.md for developers, added cross-references"}
{"id":"mcs-3c9w","title":"Extract shared test setup for decryption tests","description":"3 similar decryption tests in client_test.go (lines 153-279) share ~40 lines each. Extract common mock server and setup logic.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T10:06:16.720385-08:00","updated_at":"2025-12-23T10:16:58.063588-08:00","closed_at":"2025-12-23T10:16:58.063588-08:00","close_reason":"Created setupTestClient and setupErrorServer helpers, eliminated 5 duplicate test patterns"}
{"id":"mcs-3qwd","title":"Add mcs skill install command with embedded skill files","description":"Add a skill subcommand that installs the Claude Code skill to ~/.claude/skills/mcs-control/.\n\nImplementation:\n- Use go:embed to compile .claude/skills/mcs-control/* into binary\n- mcs skill install - copies embedded files to ~/.claude/skills/mcs-control/\n- mcs skill uninstall - removes the skill directory\n- mcs skill path - shows where skill would be installed\n\nThe embedded approach means no network, works offline, skill version matches CLI.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T17:26:42.959631-08:00","updated_at":"2025-12-21T18:28:22.875876-08:00","closed_at":"2025-12-21T18:28:22.875876-08:00","close_reason":"Closed"}
{"id":"mcs-3sy","title":"Add --confirm flag to 'mcs climate set' command","description":"## Summary\nAdd a `--confirm` flag (enabled by default) to the `mcs climate set` command that polls vehicle status until the HVAC settings are confirmed applied, instead of the current fire-and-forget behavior.\n\n## Current Behavior\nThe `mcs climate set` command sends the HVAC settings to the API and immediately returns with a success message, without verifying the settings were actually applied.\n\n## Desired Behavior\n- Add `--confirm` flag (default: true) to poll status after sending HVAC settings\n- Use polling logic similar to `refreshAndWaitForStatus` in `status_cmd.go:257`\n- Poll until `GetHvacInfo()` shows the expected values:\n  - Temperature matches requested value (within tolerance)\n  - FrontDefroster matches `--front-defrost` flag value\n  - RearDefroster matches `--rear-defrost` flag value\n- Support `--confirm-wait` flag to configure max wait time (default: 90s)\n- Use `--confirm=false` to skip confirmation and use fire-and-forget behavior\n- Show progress messages while waiting (e.g., \"Waiting for HVAC settings confirmation... (30s/90s)\")\n\n## Files to Modify\n- `internal/cli/climate.go` - Add flag handling to `newClimateSetCmd` and `runClimateSet`\n- Reuse shared polling logic from lock --confirm implementation\n\n## Development Guidelines\n- **TDD**: Write tests first, then implementation\n- **DTSTTCPW**: Do the simplest thing that could possibly work\n- **DRY**: Reuse polling logic from previous --confirm implementations\n- **No lint ignores**: All code must pass golangci-lint without ignores\n- **No failing tests**: All tests must pass before committing\n- **Small frequent commits**: Commit after each logical change\n- **Attention to detail and quality**: Clean code, proper error handling, good UX","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-19T11:00:31.500124-08:00","updated_at":"2025-12-19T12:33:14.548043-08:00","closed_at":"2025-12-19T12:33:14.548043-08:00","close_reason":"Implemented --confirm flag using existing polling infrastructure"}
{"id":"mcs-4","title":"Implement authentication flow","description":"checkVersion endpoint for enc/sign keys, usher encryptionKey for RSA pubkey, usher login for access token, token refresh logic","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-18T00:17:33.531077-08:00","updated_at":"2025-12-18T22:36:26.034082-08:00","closed_at":"2025-12-18T00:34:52.678031-08:00","dependencies":[{"issue_id":"mcs-4","depends_on_id":"mcs-3","type":"blocks","created_at":"2025-12-18T00:18:01.839684-08:00","created_by":"carlosvillela","metadata":"{}"}]}
{"id":"mcs-40","title":"Add climate set command for temperature and defroster control","description":"Add `mcs climate set` command to configure HVAC temperature and defrosters.\n\n## API Details\nEndpoint: `remoteServices/updateHVACSetting/v4`\nMethod: POST\n\nBody parameters (in addition to standard internaluserid/internalvin):\n- `Temperature`: float (desired temperature)\n- `TemperatureType`: int (1=Celsius, 2=Fahrenheit)\n- `FrontDefroster`: int (0=off, 1=on)\n- `RearDefogger`: int (0=off, 1=on)\n\nReference: github.com/ungineer/pymazda controller.py `set_hvac_setting()`\n\n## Implementation Notes\n1. Add `SetHVACSetting(internalVIN, temp float64, tempUnit string, frontDefrost, rearDefrost bool)` to `internal/api/control.go`\n   - Cannot reuse `executeControl()` since this needs additional body params\n   - Validate tempUnit is \"c\" or \"f\", convert to 1 or 2\n2. Add `climate set` subcommand in `internal/cli/climate.go`\n   - Flags: `--temp`, `--unit` (default \"c\"), `--front-defrost`, `--rear-defrost`\n   - At minimum `--temp` should be required\n3. Add tests for new API method and CLI command\n\n## Acceptance Criteria\n- [ ] `mcs climate set --temp 22` sets temperature to 22°C\n- [ ] `mcs climate set --temp 72 --unit f` sets temperature to 72°F\n- [ ] `mcs climate set --temp 20 --front-defrost` enables front defroster\n- [ ] `mcs climate set --rear-defrost=false` can disable rear defroster\n- [ ] Invalid unit values rejected with clear error\n- [ ] Unit tests cover API method and CLI flag parsing","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-18T11:32:06.084534-08:00","updated_at":"2025-12-18T22:36:26.040729-08:00","closed_at":"2025-12-18T11:40:16.455692-08:00"}
{"id":"mcs-41","title":"Replace map[string]interface{} with typed structs for API responses","description":"The API package extensively uses map[string]interface{} for responses instead of typed structs. This leads to unsafe type assertions throughout the code (e.g., auth.go:196-197) that can panic at runtime.\n\nAffected areas:\n- GetEncryptionKeys parses into map[string]interface{} (auth.go:176)\n- GetUsherEncryptionKey returns from map[string]interface{} (auth.go:229-242)  \n- Login parses into map[string]interface{} (auth.go:294)\n- APIRequest returns map[string]interface{} (client.go:19)\n- decryptPayloadUsingKey returns map[string]interface{} (client.go:256)\n\nSuggested structs:\n- EncryptionKeysResponse\n- LoginResponse  \n- VehicleInfoResponse\n- etc.\n\nThis should also fix the unsafe type assertions like:\n  c.encKey = decrypted[\"encKey\"].(string) // panics if nil\n\nUse two-return form: encKey, ok := decrypted[\"encKey\"].(string)","notes":"Scope clarification: The main vehicle status responses now use typed structs (types.go), but the auth flow still uses map[string]interface{} extensively in auth.go and client.go. Focus on adding structs for EncryptionKeysResponse, LoginResponse, and UsherEncryptionKeyResponse.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T11:50:46.761906-08:00","updated_at":"2025-12-18T22:36:26.040527-08:00","closed_at":"2025-12-18T12:08:47.921021-08:00"}
{"id":"mcs-42","title":"Add test coverage for sensordata package","description":"The sensordata package has zero test coverage. This is critical anti-bot functionality that needs testing.\n\nMissing tests:\n- SensorDataBuilder.GenerateSensorData()\n- Individual event list randomization (TouchEvent, MotionEvent, OrientationEvent, DeviceInfoEvent)\n- SystemInfo.ToString() and GetCharCodeSum()\n- encryptSensorData function\n- Helper functions: feistelCipher, countSeparators\n\nConsider:\n- Unit tests for each event type's Randomize() method\n- Integration test for full sensor data generation\n- Edge case testing for the encryption functions","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T11:50:46.811404-08:00","updated_at":"2025-12-18T22:36:26.040331-08:00","closed_at":"2025-12-18T12:11:52.972721-08:00"}
{"id":"mcs-42q","title":"Extract generic response conversion helper in api package","description":"## Problem\n`internal/api/vehicle.go` repeats the same marshal/unmarshal pattern 3 times:\n\n```go\njsonBytes, err := json.Marshal(response)\nif err != nil { return nil, fmt.Errorf(\"...\") }\nif err := json.Unmarshal(jsonBytes, \u0026typed); err != nil { return nil, fmt.Errorf(\"...\") }\n```\n\nLocations:\n- `GetVecBaseInfos()` lines 21-31\n- `GetVehicleStatus()` lines 50-66  \n- `GetEVVehicleStatus()` lines 84-100\n\n## Solution\nCreate a generic helper:\n\n```go\nfunc unmarshalResponse[T any](response map[string]interface{}) (*T, error) {\n    jsonBytes, err := json.Marshal(response)\n    if err != nil {\n        return nil, fmt.Errorf(\"failed to marshal response: %w\", err)\n    }\n    var result T\n    if err := json.Unmarshal(jsonBytes, \u0026result); err != nil {\n        return nil, fmt.Errorf(\"failed to unmarshal response: %w\", err)\n    }\n    return \u0026result, nil\n}\n```\n\n## Impact\n~30 lines of duplicate code removed.","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-12-18T23:07:47.764207-08:00","updated_at":"2025-12-18T23:17:04.256468-08:00","closed_at":"2025-12-18T23:17:04.256468-08:00","close_reason":"Added generic unmarshalResponse[T] helper, refactored 3 functions, 27 lines removed, tests added"}
{"id":"mcs-43","title":"Extract duplicate token validation logic","description":"Token validation logic is duplicated between:\n- Client.IsTokenValid() in internal/api/auth.go:322-327\n- TokenCache.IsValid() in internal/cache/cache.go:20-25\n\nBoth check for empty token and expired timestamp with identical logic.\n\nSuggested fix: Have Client.IsTokenValid() delegate to a shared validation method, or have Client create a TokenCache internally and delegate to its IsValid() method.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T11:50:46.860115-08:00","updated_at":"2025-12-18T22:36:26.040148-08:00","closed_at":"2025-12-18T12:13:15.195717-08:00"}
{"id":"mcs-43w","title":"Refactor: Use consistent error message format across API methods","description":"## Summary\nError messages across API methods have inconsistent formats (some use \"failed to X\", others use \"error X\", etc.).\n\n## Proposed Solution\nStandardize error message format across all API methods.\n\n## Files to Modify\n- `internal/api/auth.go`\n- `internal/api/vehicle.go`\n- `internal/api/control.go`\n- `internal/api/client.go`\n\n## Development Guidelines\n- **TDD**: Write tests first, then implementation\n- **DTSTTCPW**: Do the simplest thing that could possibly work\n- **DRY**: Don't repeat yourself\n- **No lint ignores**: All code must pass `golangci-lint run` without ignores\n- **No failing tests**: All tests must pass before committing\n- **Small frequent commits**: Commit after each logical change\n- **Attention to detail and high quality**: Clean code, proper error handling, good naming","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T13:41:59.464963-08:00","updated_at":"2025-12-19T17:20:33.444912-08:00","closed_at":"2025-12-19T17:20:33.444912-08:00","close_reason":"Standardized 23 error messages across 4 files to 'failed to X' pattern"}
{"id":"mcs-44","title":"Define constants for API error codes","description":"Error codes are hardcoded magic numbers throughout internal/api/client.go:201-215.\n\nCurrent code:\n  case 600001:\n      return nil, NewEncryptionError()\n  case 600002:\n      return nil, NewTokenExpiredError()  \n  case 920000:\n      if extraCode == \"400S01\" { ... }\n\nSuggested fix - define named constants:\n  const (\n      ErrorCodeEncryption        = 600001\n      ErrorCodeTokenExpired      = 600002\n      ErrorCodeRequestIssue      = 920000\n      ExtraCodeRequestInProgress = \"400S01\"\n      ExtraCodeEngineStartLimit  = \"400S11\"\n  )","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T11:50:46.912662-08:00","updated_at":"2025-12-18T22:36:26.039969-08:00","closed_at":"2025-12-18T12:14:01.71072-08:00"}
{"id":"mcs-45","title":"Use strings.Builder in sensordata generation","description":"The GenerateSensorData method in internal/sensordata/sensor_data.go:65-111 uses extensive string concatenation with += which is inefficient in Go.\n\nCurrent: result += sdkVersion + \"-1,2,-94,-100,\"\n\nSuggested fix:\n  var sb strings.Builder\n  sb.WriteString(sdkVersion)\n  sb.WriteString(\"-1,2,-94,-100,\")\n  // ...\n  return encryptSensorData(sb.String())\n\nThis also applies to the repetitive touch event generation in touch_event.go:35-141 which has three nearly identical code blocks.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T12:01:11.93625-08:00","updated_at":"2025-12-18T22:36:26.039792-08:00","closed_at":"2025-12-18T12:15:40.038361-08:00"}
{"id":"mcs-46","title":"Refactor long runStatus function","description":"The runStatus function in internal/cli/status.go:83-187 is 104 lines and handles multiple concerns:\n- Client creation\n- Refresh logic with polling\n- Display logic\n\nAdditionally, runStatus manually duplicates the withVehicleClient pattern instead of using the existing helper (unlike lock, engine, charge, climate commands which all use it).\n\nSuggested refactoring:\n1. Extract refresh polling into refreshAndWait(ctx, client, evStatus, refreshWait)\n2. Consider using withVehicleClient for consistency with other commands","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T12:01:12.009491-08:00","updated_at":"2025-12-18T22:36:26.039615-08:00","closed_at":"2025-12-18T12:17:07.472856-08:00"}
{"id":"mcs-47","title":"Create shared CLI test helpers","description":"The pattern for finding subcommands is duplicated in multiple CLI test files:\n- charge_test.go:27-33, 55-60\n- raw_test.go:27-33, 55-60\n- climate_test.go:27-33, 55-60, 82-87, 102-108\n\nOnly status_test.go has a findSubcommand helper function.\n\nThe api package has a dedicated test_helpers_test.go file - create a similar cli_test_helpers_test.go to consolidate:\n- findSubcommand helper\n- Any other shared test utilities","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T12:01:12.076624-08:00","updated_at":"2025-12-18T22:36:26.039437-08:00","closed_at":"2025-12-18T12:20:10.927264-08:00"}
{"id":"mcs-48","title":"Add type-safe TemperatureUnit enum","description":"Temperature unit in internal/api/control.go:85-94 is passed as a string and validated with a switch statement.\n\nCurrent:\n  func (c *Client) SetHVACSetting(... tempUnit string ...) error {\n      switch tempUnit {\n      case \"c\", \"C\": tempType = 1\n      case \"f\", \"F\": tempType = 2\n      ...\n      }\n  }\n\nSuggested fix - type-safe enum:\n  type TemperatureUnit int\n  const (\n      Celsius    TemperatureUnit = 1  \n      Fahrenheit TemperatureUnit = 2\n  )\n\nAlso add temperature range validation (e.g., 15-30°C, 60-86°F).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T12:01:12.142548-08:00","updated_at":"2025-12-18T22:36:26.039243-08:00","closed_at":"2025-12-18T12:41:49.579387-08:00"}
{"id":"mcs-49","title":"Have format functions reuse extract functions for JSON output","description":"In internal/cli/status.go:251-311, the extractXxxData functions duplicate logic in the formatXxxStatus functions.\n\nExample - extractBatteryData and formatBatteryStatus both construct the same map structure when JSON output is needed:\n  \n  // extractBatteryData (lines 252-260)\n  return map[string]interface{}{\"level\": batteryLevel, \"range\": range_, ...}\n  \n  // formatBatteryStatus JSON branch (lines 314-324)\n  data := map[string]interface{}{\"level\": batteryLevel, \"range\": range_, ...}\n\nSuggested fix: Have formatBatteryStatus call extractBatteryData when jsonOutput=true to eliminate duplication.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T12:01:12.227589-08:00","updated_at":"2025-12-18T22:36:26.039063-08:00","closed_at":"2025-12-18T12:44:08.538745-08:00"}
{"id":"mcs-4d3t","title":"Add tests for CLI client helpers","description":"Add tests for internal/cli/client.go:\n- setupVehicleClient() - 0% coverage\n- withVehicleClient() - 0% coverage  \n- withVehicleClientEx() - 0% coverage\n\nThese require mocked API client. Consider using interfaces for testability.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-21T18:47:37.371286-08:00","updated_at":"2025-12-21T19:07:56.207771-08:00","closed_at":"2025-12-21T19:07:56.207771-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mcs-4d3t","depends_on_id":"mcs-r6kk","type":"blocks","created_at":"2025-12-21T18:47:45.676005-08:00","created_by":"daemon"}]}
{"id":"mcs-4ih","title":"Refactor: Rename WindowInfo struct to avoid shadowing in types.go","description":"## Summary\nThe WindowInfo struct name shadows the standard pattern of XxxInfo for info types but represents something different.\n\n## Proposed Solution\nRename to WindowStatus or similar to avoid confusion with the info getter pattern.\n\n## Files to Modify\n- `internal/api/types.go`\n\n## Development Guidelines\n- **TDD**: Write tests first, then implementation\n- **DTSTTCPW**: Do the simplest thing that could possibly work\n- **DRY**: Don't repeat yourself\n- **No lint ignores**: All code must pass `golangci-lint run` without ignores\n- **No failing tests**: All tests must pass before committing\n- **Small frequent commits**: Commit after each logical change\n- **Attention to detail and high quality**: Clean code, proper error handling, good naming","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T13:42:24.972775-08:00","updated_at":"2025-12-19T18:06:28.877139-08:00","closed_at":"2025-12-19T18:06:28.877139-08:00","close_reason":"Fixed comment typo - struct was already correctly named WindowStatus"}
{"id":"mcs-4l9h","title":"Document skill in README","description":"Add section to README.md explaining:\n- What the Claude Code skill enables\n- Example natural language commands\n- How to extend/customize the skill\n- Requirements (Claude Code with skills support)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-21T14:31:13.690244-08:00","updated_at":"2025-12-21T15:18:35.051775-08:00","closed_at":"2025-12-21T15:18:35.051775-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mcs-4l9h","depends_on_id":"mcs-cli9","type":"blocks","created_at":"2025-12-21T14:31:21.931135-08:00","created_by":"daemon"},{"issue_id":"mcs-4l9h","depends_on_id":"mcs-r0sw","type":"blocks","created_at":"2025-12-21T14:31:22.442364-08:00","created_by":"daemon"}]}
{"id":"mcs-5","title":"Implement API client core","description":"HTTP client with proper headers (user-agent, app-version, device-id), request signing, payload encryption/decryption, error handling","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-18T00:17:33.536932-08:00","updated_at":"2025-12-18T22:36:26.03384-08:00","closed_at":"2025-12-18T00:43:51.830466-08:00","dependencies":[{"issue_id":"mcs-5","depends_on_id":"mcs-3","type":"blocks","created_at":"2025-12-18T00:18:01.844475-08:00","created_by":"carlosvillela","metadata":"{}"},{"issue_id":"mcs-5","depends_on_id":"mcs-4","type":"blocks","created_at":"2025-12-18T00:18:01.849392-08:00","created_by":"carlosvillela","metadata":"{}"}]}
{"id":"mcs-50","title":"Remove unused contains helper in client_test.go","description":"The contains function in internal/api/client_test.go:13-15 wraps strings.Contains but provides no additional value:\n\n  func contains(s, substr string) bool {\n      return strings.Contains(s, substr)\n  }\n\nShould be removed and calls replaced with strings.Contains directly.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T12:01:12.277216-08:00","updated_at":"2025-12-18T22:36:26.038885-08:00","closed_at":"2025-12-18T12:45:09.532124-08:00"}
{"id":"mcs-51","title":"Add boolToInt helper for control.go","description":"In internal/api/control.go:96-103, boolean-to-integer conversion is verbose:\n\n  frontDefrost := 0\n  if frontDefroster {\n      frontDefrost = 1\n  }\n  rearDefrost := 0\n  if rearDefroster {\n      rearDefrost = 1\n  }\n\nSuggested fix - create a helper:\n  func boolToInt(b bool) int {\n      if b { return 1 }\n      return 0\n  }\n\nThen: frontDefrost := boolToInt(frontDefroster)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T12:01:29.461085-08:00","updated_at":"2025-12-18T22:36:26.038708-08:00","closed_at":"2025-12-18T12:46:36.032715-08:00"}
{"id":"mcs-51z","title":"CLAUDE.md duplicates information already clear from code structure","description":"## Problem\n\nCLAUDE.md contains documentation that duplicates information that's already obvious from reading the code, violating DRY principle. This creates maintenance burden.\n\n### Examples of redundant documentation:\n\n1. **Project Structure section** (lines 5-35) duplicates what `ls` and file headers show\n2. **Key Constants section** (lines 60-66) duplicates the actual const declarations in auth.go which have good comments\n3. **Response Structs table** (lines 76-86) duplicates the struct definitions which have doc comments\n4. **Status Constants** (lines 89-113) duplicates the const blocks in types.go\n\nThe code already has good documentation:\n- auth.go has clear comments on each constant\n- types.go has doc comments on structs and const blocks\n- Each function has appropriate doc comments\n\n## Location\n- /Users/carlosvillela/src/dummy/mysmartcar/mcs/CLAUDE.md\n\n## How to Fix\nCLAUDE.md should focus on:\n- High-level architecture and flow (the 'why')\n- Non-obvious gotchas and edge cases\n- Cross-cutting concerns not obvious from single files\n- Quick reference (but marked as such, not authoritative)\n\nRemove or consolidate sections that just restate what the code shows.\n\n## Development Guidelines\n- TDD, DTSTTCPW, DRY\n- No lint ignores, no failing tests\n- Small commits, quality focus","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T17:48:29.516026-08:00","updated_at":"2025-12-20T16:31:59.817729-08:00","closed_at":"2025-12-20T16:31:59.817729-08:00","close_reason":"Documentation duplication is intentional - CLAUDE.md is a self-contained developer guide."}
{"id":"mcs-52","title":"Standardize error message casing","description":"Error messages are inconsistent throughout the codebase:\n- Some lowercase: \"failed to create request: %w\"\n- Some uppercase: \"Request failed: %s\"\n\nGo convention: error strings should not be capitalized (unless proper nouns) and should not end with punctuation.\n\nShould audit all fmt.Errorf and error returns for consistency.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T12:01:29.51577-08:00","updated_at":"2025-12-18T22:36:26.038525-08:00","closed_at":"2025-12-18T12:02:58.460932-08:00"}
{"id":"mcs-52gh","title":"Potential missing context deadline may cause indefinite blocking","description":"The sleepWithContext function correctly respects context cancellation, but other parts of the code (e.g., genericRetry) may invoke operations that block indefinitely if the context lacks a deadline, potentially causing CLI commands to hang","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T23:15:55.448742-08:00","updated_at":"2025-12-20T16:23:13.355137-08:00","closed_at":"2025-12-20T16:23:13.355137-08:00","close_reason":"Duplicate of timeout issues. Context deadlines already addressed via AuthRequestTimeout and httpClient timeout."}
{"id":"mcs-53","title":"Extract touch event generation helper","description":"In internal/sensordata/touch_event.go:35-141, the Randomize method has three nearly identical code blocks for generating touch events (down, move, up) with only slight variations in timestamp offset logic.\n\nSuggested fix: Extract a helper method like generateTouchSequence(timestampOffset int, eventType string) to reduce repetition and improve maintainability.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T12:01:29.602601-08:00","updated_at":"2025-12-18T22:36:26.038351-08:00","closed_at":"2025-12-18T12:01:56.50459-08:00"}
{"id":"mcs-54","title":"Investigate undisplayed data from mcs status endpoints","description":"Investigate what information comes back from the endpoints in `mcs status` that we're not currently displaying and that could be interesting to users.\n\n## Background\nThe `mcs status` command displays a subset of the data returned by the API. There may be additional useful fields that users would find valuable.\n\n## Tasks\n- [ ] Review raw API responses from status endpoints\n- [ ] Compare returned fields vs what's currently displayed\n- [ ] Identify potentially interesting undisplayed data\n- [ ] Document findings and recommend which fields to add\n\n## Approach\nUse `mcs raw` or add debug logging to see full API responses, then compare against what `internal/cli/status.go` currently extracts and displays.","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-18T20:15:10.528737-08:00","updated_at":"2025-12-18T22:36:26.043561-08:00","closed_at":"2025-12-18T20:24:35.018336-08:00"}
{"id":"mcs-54l","title":"Add color coding to tire pressure display","description":"Color code tire pressures based on deviation from recommended values. Green: within ±3 PSI, Yellow: 4-6 PSI off, Red: \u003e6 PSI off. Default target: 36 PSI (Mazda CX-90 MHEV).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T09:52:13.508973-08:00","updated_at":"2025-12-19T09:53:32.004396-08:00","closed_at":"2025-12-19T09:53:32.004396-08:00","close_reason":"Added ColorPressure function and updated formatTiresStatus with color coding"}
{"id":"mcs-55","title":"Display odometer reading in mcs status","description":"Add odometer reading to `mcs status` output.\n\n## API Field\n- Source: `remoteInfos[].DriveInformation.OdoDispValue`\n- Type: float64\n- Unit: kilometers\n\n## Implementation\n1. Add `DriveInformation` struct to `types.go`:\n   ```go\n   type DriveInformation struct {\n       OdoDispValue float64 `json:\"OdoDispValue\"`\n   }\n   ```\n2. Add `DriveInformation DriveInformation` to `RemoteInfo` struct\n3. Add `GetOdometerInfo()` helper method to `VehicleStatusResponse`\n4. Update `displayAllStatus()` in `status.go` to show odometer\n5. Consider adding `mcs status odometer` subcommand\n\n## Display Format\n```\nODOMETER: 12,345.6 km\n```\n\n## Priority\nHigh - users frequently want to track mileage\n\n## Verified\nField confirmed to exist in API response (see undisplayed_fields_test.go)","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-18T20:23:42.854778-08:00","updated_at":"2025-12-18T22:36:26.038171-08:00","closed_at":"2025-12-18T20:29:27.188992-08:00"}
{"id":"mcs-56","title":"Display charging time estimates in mcs status","description":"Add charging time estimates to `mcs status` output for EV/PHEV vehicles.\n\n## API Fields\n- `ChargeInfo.MaxChargeMinuteAC` (float64) - Minutes to full via AC charging\n- `ChargeInfo.MaxChargeMinuteQBC` (float64) - Minutes to full via quick charging\n\n## Implementation\n1. Add fields to `ChargeInfo` struct in `types.go`:\n   ```go\n   MaxChargeMinuteAC  float64 `json:\"MaxChargeMinuteAC\"`\n   MaxChargeMinuteQBC float64 `json:\"MaxChargeMinuteQBC\"`\n   ```\n2. Update `GetBatteryInfo()` to return these values\n3. Update battery display to show time remaining when charging\n\n## Display Format\nWhen plugged in and charging:\n```\nBATTERY: 45% (120.5 km range) [charging, ~2h 30m to full]\n```\nOr with quick charge available:\n```\nBATTERY: 45% (120.5 km range) [charging, ~45m quick / ~3h AC]\n```\n\n## Priority\nHigh - critical info for EV owners planning charging stops\n\n## Verified\nFields confirmed to exist in API response (see undisplayed_fields_test.go)","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-18T20:24:25.288916-08:00","updated_at":"2025-12-18T22:36:26.037984-08:00","closed_at":"2025-12-18T20:32:02.441944-08:00"}
{"id":"mcs-56y","title":"Remove unnecessary display wrapper functions in status_display.go","description":"Lines 104-131 contain thin wrappers (displayBatteryStatus, etc) that just call format functions. Consider inlining at call sites.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T08:10:20.779361-08:00","updated_at":"2025-12-19T09:09:49.869112-08:00","closed_at":"2025-12-19T09:09:49.869112-08:00","close_reason":"Removed 5 unnecessary wrapper functions, inlined at call sites, -29 lines"}
{"id":"mcs-57","title":"Display individual door and trunk status in mcs status","description":"Show individual door open/closed and lock status instead of just \"all locked\".\n\n## API Fields (Door status - open/closed)\n- `Door.DrStatDrv` (float64) - Driver door (0=closed, 1=open)\n- `Door.DrStatPsngr` (float64) - Passenger door\n- `Door.DrStatRl` (float64) - Rear left door\n- `Door.DrStatRr` (float64) - Rear right door\n- `Door.DrStatTrnkLg` (float64) - Trunk (already parsed but not shown)\n- `Door.DrStatHood` (float64) - Hood\n\n## API Fields (Lock status)\n- `Door.LockLinkSwDrv` (float64) - Driver door lock\n- `Door.LockLinkSwPsngr` (float64) - Passenger door lock\n- `Door.LockLinkSwRl` (float64) - Rear left lock\n- `Door.LockLinkSwRr` (float64) - Rear right lock\n\n## Implementation\n1. Add missing fields to `DoorInfo` struct in `types.go`\n2. Update `GetDoorsInfo()` to return detailed status\n3. Update `formatDoorsStatus()` to show details\n\n## Display Format\nWhen all closed and locked:\n```\nDOORS: All locked\n```\nWhen issues exist:\n```\nDOORS: Driver unlocked, Trunk open, Hood open\n```\n\n## Priority\nMedium - useful for security awareness\n\n## Verified\nFields confirmed to exist in API response (see undisplayed_fields_test.go)","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-18T20:24:25.348289-08:00","updated_at":"2025-12-18T22:36:26.043382-08:00","closed_at":"2025-12-18T20:34:24.003863-08:00"}
{"id":"mcs-57fd","title":"Client struct has become a God object with too many responsibilities","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T23:13:06.419308-08:00","updated_at":"2025-12-19T23:37:58.555088-08:00","closed_at":"2025-12-19T23:37:58.555088-08:00","close_reason":"Closed"}
{"id":"mcs-58","title":"Display window positions in mcs status","description":"Add window open/closed status to `mcs status` output.\n\n## API Fields\n- `Pw.PwPosDrv` (float64) - Driver window position (0=closed, \u003e0=open percentage)\n- `Pw.PwPosPsngr` (float64) - Passenger window position\n- `Pw.PwPosRl` (float64) - Rear left window position\n- `Pw.PwPosRr` (float64) - Rear right window position\n\n## Implementation\n1. Add `WindowInfo` struct to `types.go`:\n   ```go\n   type WindowInfo struct {\n       PwPosDrv   float64 `json:\"PwPosDrv\"`\n       PwPosPsngr float64 `json:\"PwPosPsngr\"`\n       PwPosRl    float64 `json:\"PwPosRl\"`\n       PwPosRr    float64 `json:\"PwPosRr\"`\n   }\n   ```\n2. Add `Pw WindowInfo` to `AlertInfo` struct\n3. Add `GetWindowsInfo()` helper method\n4. Add window status to doors display or separate section\n\n## Display Format\nWhen all closed:\n```\nWINDOWS: All closed\n```\nWhen open:\n```\nWINDOWS: Driver 50%, Rear left 25%\n```\n\n## Priority\nMedium - useful for weather awareness (did I leave windows open?)\n\n## Verified\nFields confirmed to exist in API response (see undisplayed_fields_test.go)","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-18T20:24:25.41544-08:00","updated_at":"2025-12-18T22:36:26.043189-08:00","closed_at":"2025-12-18T20:38:55.511258-08:00"}
{"id":"mcs-59","title":"Display hazard lights status in mcs status","description":"Add hazard lights status to `mcs status` output.\n\n## API Field\n- `HazardLamp.HazardSw` (float64) - Hazard lights (0=off, 1=on)\n\n## Implementation\n1. Add `HazardLamp` struct to `types.go`:\n   ```go\n   type HazardLamp struct {\n       HazardSw float64 `json:\"HazardSw\"`\n   }\n   ```\n2. Add `HazardLamp HazardLamp` to `AlertInfo` struct\n3. Add `GetHazardInfo()` helper method\n4. Display in status output (only when on, or always?)\n\n## Display Format\nOnly show when hazards are on:\n```\nHAZARDS: On\n```\n\n## Priority\nLow - hazards are typically temporary, but could indicate car is in distress\n\n## Verified\nField confirmed to exist in API response (see undisplayed_fields_test.go)","status":"closed","priority":4,"issue_type":"feature","created_at":"2025-12-18T20:24:25.486692-08:00","updated_at":"2025-12-18T22:36:26.045934-08:00","closed_at":"2025-12-18T20:45:23.386659-08:00"}
{"id":"mcs-5au","title":"Refactor: Add typed endpoint constants in api package","description":"## Summary\nAPI endpoint paths are scattered as string literals throughout the code. This makes them hard to find and refactor.\n\n## Proposed Solution\nAdd typed endpoint constants in the api package.\n\n## Files to Modify\n- `internal/api/auth.go`\n- `internal/api/vehicle.go`\n- `internal/api/control.go`\n\n## Development Guidelines\n- **TDD**: Write tests first, then implementation\n- **DTSTTCPW**: Do the simplest thing that could possibly work\n- **DRY**: Don't repeat yourself\n- **No lint ignores**: All code must pass `golangci-lint run` without ignores\n- **No failing tests**: All tests must pass before committing\n- **Small frequent commits**: Commit after each logical change\n- **Attention to detail and high quality**: Clean code, proper error handling, good naming","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T13:40:35.253381-08:00","updated_at":"2025-12-19T15:45:59.985656-08:00","closed_at":"2025-12-19T15:45:59.985656-08:00","close_reason":"Added typed endpoint constants across auth.go, vehicle.go, and updated all usages"}
{"id":"mcs-5ke","title":"Use case-insensitive string parsing for temperature units","description":"ParseTemperatureUnit() handles 8 variations (c, C, celsius, Celsius, etc) but misses CELSIUS. Use strings.ToLower() before switch for robust parsing. File: internal/api/types.go lines 476-485","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-18T23:39:01.250254-08:00","updated_at":"2025-12-19T01:18:43.806538-08:00","closed_at":"2025-12-19T01:18:43.806538-08:00","close_reason":"Added strings.ToLower() normalization, simplified switch to 4 cases, added tests for uppercase variations"}
{"id":"mcs-5kv","title":"Extract duplicate bodyParams in vehicle.go","description":"GetVehicleStatus and GetEVVehicleStatus use identical bodyParams map (internaluserid, internalvin, limit, offset, vecinfotype). Extract to helper function or constant. File: internal/api/vehicle.go lines 39-90","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-18T23:39:01.839804-08:00","updated_at":"2025-12-19T01:14:33.42549-08:00","closed_at":"2025-12-19T01:14:33.42549-08:00","close_reason":"Created buildVehicleStatusParams() helper to eliminate duplicate bodyParams maps"}
{"id":"mcs-5u1a","title":"Potential indefinite blocking due to missing timeout on HTTP requests","description":"HTTP requests in executeAPIRequest use the provided context but do not set an explicit timeout on the http.Client, which may lead to hanging requests if the server is slow or unresponsive","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T23:15:49.836024-08:00","updated_at":"2025-12-20T16:23:13.171238-08:00","closed_at":"2025-12-20T16:23:13.171238-08:00","close_reason":"Duplicate of mcs-gu8y (already closed). httpClient has 30s timeout, auth functions use AuthRequestTimeout."}
{"id":"mcs-6","title":"Implement vehicle status endpoint","description":"get_vehicle_status - doors, windows, locks, fuel, odometer, location, tires, hazards","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-18T00:17:33.542912-08:00","updated_at":"2025-12-18T22:36:26.037142-08:00","closed_at":"2025-12-18T00:45:44.580381-08:00","dependencies":[{"issue_id":"mcs-6","depends_on_id":"mcs-5","type":"blocks","created_at":"2025-12-18T00:18:01.854874-08:00","created_by":"carlosvillela","metadata":"{}"}]}
{"id":"mcs-60","title":"Display fuel lid status in mcs status","description":"Add fuel lid open/closed status to `mcs status` output.\n\n## API Field\n- `Door.FuelLidOpenStatus` (float64) - Fuel lid (0=closed, 1=open)\n\n## Implementation\n1. Add `FuelLidOpenStatus float64` to `DoorInfo` struct in `types.go`\n2. Include in door status display\n\n## Display Format\nOnly show when open:\n```\nDOORS: All locked, Fuel lid open\n```\n\n## Priority\nLow - edge case but useful to know\n\n## Verified\nField confirmed to exist in API response (see undisplayed_fields_test.go)","status":"closed","priority":4,"issue_type":"feature","created_at":"2025-12-18T20:24:25.560149-08:00","updated_at":"2025-12-18T22:36:26.045725-08:00","closed_at":"2025-12-18T20:47:45.269672-08:00"}
{"id":"mcs-60o","title":"Increase usage of type-safe map helpers","description":"maphelpers.go (getString, getInt, etc) are well-designed but underutilized. Many places still do unsafe type assertions. Audit and replace.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T08:10:47.155291-08:00","updated_at":"2025-12-19T08:42:09.182773-08:00","closed_at":"2025-12-19T08:42:09.182773-08:00","close_reason":"Replaced 2 unsafe type assertions in test code; production code already uses safe helpers"}
{"id":"mcs-61","title":"Display battery heater status in mcs status","description":"Add battery heater status to `mcs status` output for EV/PHEV vehicles.\n\n## API Fields\n- `ChargeInfo.BatteryHeaterON` (float64) - Battery heater running (0=off, 1=on)\n- `ChargeInfo.CstmzStatBatHeatAutoSW` (float64) - Auto setting (0=off, 1=on)\n\n## Implementation\n1. Add fields to `ChargeInfo` struct in `types.go`:\n   ```go\n   BatteryHeaterON        float64 `json:\"BatteryHeaterON\"`\n   CstmzStatBatHeatAutoSW float64 `json:\"CstmzStatBatHeatAutoSW\"`\n   ```\n2. Update battery or climate display to show heater status\n\n## Display Format\nShow in battery section when relevant (cold weather):\n```\nBATTERY: 66% (180.5 km range) [battery heater on, auto enabled]\n```\n\n## Priority\nMedium - important for cold climate EV owners\n\n## Verified\nFields confirmed to exist in API response (see undisplayed_fields_test.go)","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-18T20:24:25.621192-08:00","updated_at":"2025-12-18T22:36:26.043006-08:00","closed_at":"2025-12-18T20:43:08.191296-08:00"}
{"id":"mcs-62","title":"Display target HVAC temperature in mcs status","description":"Add target HVAC temperature alongside interior temperature.\n\n## API Fields\n- `RemoteHvacInfo.InCarTeDC` (float64) - Current interior temp (already shown)\n- `RemoteHvacInfo.InteriorTemp` (float64) - May be same as above\n- `RemoteHvacInfo.TargetTemp` (float64) - Target/set temperature\n\n## Implementation\n1. Add `TargetTemp float64` to `RemoteHvacInfo` struct in `types.go`\n2. Update `GetHvacInfo()` to return target temp\n3. Update climate display to show both temps\n\n## Display Format\n```\nCLIMATE: On, 18°C → 22°C (front defroster on)\n```\nShows current temp (18°C) and target (22°C)\n\n## Priority\nLow - nice to have for climate control visibility\n\n## Verified\nField confirmed to exist in API response (see undisplayed_fields_test.go)","status":"closed","priority":4,"issue_type":"feature","created_at":"2025-12-18T20:24:25.681209-08:00","updated_at":"2025-12-18T22:36:26.045456-08:00","closed_at":"2025-12-18T20:53:41.704244-08:00"}
{"id":"mcs-63","title":"Display vehicle info (VIN, model, year, nickname) in mcs status","description":"Add vehicle identification info to `mcs status` output header.\n\n## API Source\nEndpoint: `remoteServices/getVecBaseInfos/v4` (already called to get internalVin)\n\n## Available Fields (from pymazda reference)\nTop-level in vecBaseInfos[]:\n- `vin` - Vehicle Identification Number\n- `nickname` - User-defined vehicle name\n- `econnectType` - Connection type\n\nIn vecBaseInfos[].Vehicle.OtherInformation:\n- `carlineName` - Model family (e.g., \"CX-90\")\n- `modelYear` - Manufacturing year  \n- `modelName` - Specific model name\n- `exteriorColorCode` / `exteriorColorName` - Color\n- `isElectric` - EV flag\n\n## Implementation\n\n1. Expand `VecBaseInfo` struct in `types.go`:\n   ```go\n   type VecBaseInfo struct {\n       VIN          string  `json:\"vin\"`\n       Nickname     string  `json:\"nickname\"`\n       EconnectType int     `json:\"econnectType\"`\n       Vehicle      Vehicle `json:\"Vehicle\"`\n   }\n   \n   type Vehicle struct {\n       CvInformation    CvInformation    `json:\"CvInformation\"`\n       OtherInformation OtherInformation `json:\"OtherInformation\"`\n   }\n   \n   type OtherInformation struct {\n       CarlineName       string `json:\"carlineName\"`\n       ModelYear         string `json:\"modelYear\"`\n       ModelName         string `json:\"modelName\"`\n       ExteriorColorName string `json:\"exteriorColorName\"`\n       IsElectric        bool   `json:\"isElectric\"`\n   }\n   ```\n\n2. Cache vehicle info in client or pass to status display\n\n3. Update status header to show vehicle info:\n   ```\n   CX-90 PHEV (2024) \"My Car\"\n   VIN: JM3KK...\n   \n   Vehicle Status (Last Updated: 2024-01-15 10:30:00)\n   \n   BATTERY: 66% ...\n   ```\n\n4. Add to JSON output under \"vehicle\" key\n\n## Display Format\n```\n\u003cModelName\u003e (\u003cYear\u003e) \"\u003cNickname\u003e\"\nVIN: \u003cVIN\u003e\n\nVehicle Status (Last Updated: ...)\n```\n\nIf no nickname: `CX-90 PHEV (2024)`\nIf no model info: Just show VIN\n\n## Acceptance Criteria\n- [ ] VIN displayed in status header\n- [ ] Model name and year displayed when available\n- [ ] Nickname displayed in quotes when set\n- [ ] JSON output includes vehicle info object\n- [ ] Works gracefully when fields are missing","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-18T20:43:57.27877-08:00","updated_at":"2025-12-18T22:36:26.037795-08:00","closed_at":"2025-12-18T20:58:15.889942-08:00"}
{"id":"mcs-64","title":"Clarify EV vs total range labels for PHEV vehicles","description":"## Problem\n\nFor PHEV vehicles, the status display shows confusing range values:\n\n```\nBATTERY: 55% (620.0 km range)\nFUEL: 92% (620.0 km range)\n```\n\nBoth battery and fuel show identical range values, which is misleading.\n\n## Root Cause\n\nThe API returns two different range fields:\n- `SmaphRemDrvDistKm` (EV status endpoint) - EV-only range\n- `RemDrvDistDActlKm` (vehicle status endpoint) - **total combined range**, not fuel-only\n\nThe current display labels both as just \"range\", making it unclear that the fuel line shows total range.\n\n## Affected Code\n\n- `internal/cli/status.go:424` - `formatBatteryStatus()` shows \"X km range\"\n- `internal/cli/status.go:470` - `formatFuelStatus()` shows \"X km range\"\n\n## Proposed Fix\n\nUpdate display labels:\n- Battery: \"X km EV range\"\n- Fuel: \"X km total range\"\n\n## Acceptance Criteria\n\n- [ ] `mcs status` shows battery as \"BATTERY: X% (Y km EV range)\"\n- [ ] `mcs status` shows fuel as \"FUEL: X% (Y km total range)\"\n- [ ] `mcs status battery` shows \"EV range\" in output\n- [ ] `mcs status fuel` shows \"total range\" in output\n- [ ] JSON output keys remain unchanged for backwards compatibility (`range_km`)\n- [ ] Tests pass","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-18T21:05:11.359581-08:00","updated_at":"2025-12-18T22:36:26.037599-08:00","closed_at":"2025-12-18T21:08:01.79456-08:00"}
{"id":"mcs-666","title":"Refactor: Simplify cache validation logic in cache.go","description":"## Summary\nThe cache validation logic in cache.go has nested conditionals that could be simplified.\n\n## Proposed Solution\nSimplify with early returns and clearer validation flow.\n\n## Files to Modify\n- `internal/cache/cache.go`\n\n## Development Guidelines\n- **TDD**: Write tests first, then implementation\n- **DTSTTCPW**: Do the simplest thing that could possibly work\n- **DRY**: Don't repeat yourself\n- **No lint ignores**: All code must pass `golangci-lint run` without ignores\n- **No failing tests**: All tests must pass before committing\n- **Small frequent commits**: Commit after each logical change\n- **Attention to detail and high quality**: Clean code, proper error handling, good naming","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T13:41:07.698303-08:00","updated_at":"2025-12-19T16:16:42.863034-08:00","closed_at":"2025-12-19T16:16:42.863034-08:00","close_reason":"Simplified with early returns for clearer validation flow"}
{"id":"mcs-6da","title":"Use NewParentWithSubcommands pattern in climate.go","description":"climate.go lines 20-40 manually add subcommands when they could use NewParentWithSubcommands like charge.go does.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T08:10:21.496402-08:00","updated_at":"2025-12-19T09:05:13.856982-08:00","closed_at":"2025-12-19T09:05:13.856982-08:00","close_reason":"Refactored to use NewParentWithSubcommands pattern, matching charge.go"}
{"id":"mcs-6dc3","title":"Magic numbers scattered (bit shifting for backoff) reduce readability","description":"The backoff calculation uses bit shifting and hardcoded constants, making intent unclear; adding named constants or comments would improve readability","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T23:14:46.355043-08:00","updated_at":"2025-12-20T16:23:12.984391-08:00","closed_at":"2025-12-20T16:23:12.984391-08:00","close_reason":"Duplicate of mcs-vnku (already closed). Bit shifting for 2^n is idiomatic Go."}
{"id":"mcs-6ot","title":"Consolidate retry logic into generic function","description":"apiRequestWithRetry (lines 59-113) and apiRequestJSONWithRetry (lines 115-169) duplicate entire retry/backoff logic. Use generics or function parameter to consolidate.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T08:10:06.500812-08:00","updated_at":"2025-12-19T08:21:03.978828-08:00","closed_at":"2025-12-19T08:21:03.978828-08:00","close_reason":"Consolidated retry logic using Go generics, eliminated 66 lines of duplication","dependencies":[{"issue_id":"mcs-6ot","depends_on_id":"mcs-lfr","type":"blocks","created_at":"2025-12-19T08:11:00.095637-08:00","created_by":"daemon"}]}
{"id":"mcs-6ztz","title":"CLAUDE.md: Missing documentation for error types and error handling","description":"## Problem\n\nCLAUDE.md mentions errors.go as 'Custom error types' in the project structure but doesn't document what error types exist or how to handle them. This is important for developers using the API.\n\nThe actual error types in errors.go:\n- APIError - general API error\n- EncryptionError - encryption rejected (600001)\n- TokenExpiredError - token expired (600002)\n- RequestInProgressError - request already in progress\n- EngineStartLimitError - engine start limit reached\n- ResultCodeError - unsuccessful result code\n\nError codes:\n- ErrorCodeEncryption = 600001\n- ErrorCodeTokenExpired = 600002\n- ErrorCodeRequestIssue = 920000\n- ExtraCodeRequestInProgress = \"400S01\"\n- ExtraCodeEngineStartLimit = \"400S11\"\n\nThis is more important than the status constants that are documented.\n\n## Location\n- /Users/carlosvillela/src/dummy/mysmartcar/mcs/CLAUDE.md (line 13 mentions errors.go but no details)\n- /Users/carlosvillela/src/dummy/mysmartcar/mcs/internal/api/errors.go (full implementation)\n\n## How to Fix\nAdd an Error Handling section to CLAUDE.md explaining:\n- What error types exist\n- How retry logic handles them (EncryptionError triggers key refresh, TokenExpiredError triggers re-login)\n- What errors callers should handle\n\n## Development Guidelines\n- TDD, DTSTTCPW, DRY\n- No lint ignores, no failing tests\n- Small commits, quality focus","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T17:49:15.663664-08:00","updated_at":"2025-12-20T16:39:13.118833-08:00","closed_at":"2025-12-20T16:39:13.118833-08:00","close_reason":"Fixed in docs commit a4d70e1"}
{"id":"mcs-7","title":"Implement EV status endpoint","description":"get_ev_vehicle_status - battery level, charging status, plug state, charge times, HVAC info, battery heater","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-18T00:17:33.547876-08:00","updated_at":"2025-12-18T22:36:26.036912-08:00","closed_at":"2025-12-18T00:47:14.592071-08:00","dependencies":[{"issue_id":"mcs-7","depends_on_id":"mcs-5","type":"blocks","created_at":"2025-12-18T00:18:01.861231-08:00","created_by":"carlosvillela","metadata":"{}"}]}
{"id":"mcs-7aa","title":"Refactor: Extract common command pattern for lock/unlock/start/stop/charge/climate commands","description":"## Summary\nThe command files (lock.go, engine.go, charge.go, climate.go) have extensive copy-paste code for confirmation handling. Each command follows the same pattern:\n1. Parse --confirm and --confirm-wait flags\n2. Call the API method\n3. If confirm disabled, print success and return\n4. Print \"waiting for confirmation\" message\n5. Call waitForXxx function\n6. Handle result (success or timeout)\n\nThis pattern is repeated 8+ times across ~600 lines of code.\n\n## Proposed Solution\nCreate a `ConfirmableCommand` abstraction that encapsulates this pattern, reducing to ~100 lines total.\n\n## Files to Modify\n- `internal/cli/lock.go`\n- `internal/cli/engine.go`\n- `internal/cli/charge.go`\n- `internal/cli/climate.go`\n- `internal/cli/confirm.go` (add ConfirmableCommand type)\n\n## Development Guidelines\n- **TDD**: Write tests first, then implementation\n- **DTSTTCPW**: Do the simplest thing that could possibly work\n- **DRY**: Don't repeat yourself\n- **No lint ignores**: All code must pass `golangci-lint run` without ignores\n- **No failing tests**: All tests must pass before committing\n- **Small frequent commits**: Commit after each logical change\n- **Attention to detail and high quality**: Clean code, proper error handling, good naming","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T13:39:24.627426-08:00","updated_at":"2025-12-19T14:14:05.647499-08:00","closed_at":"2025-12-19T14:14:05.647499-08:00","close_reason":"Implemented ConfirmableCommand abstraction, reduced ~300 lines of duplication"}
{"id":"mcs-7as","title":"Add Example field to 'mcs status' command and subcommands","description":"Add Cobra Example field to status, status battery, status doors, status fuel, status location, status tires. Include both human-readable and --json output examples.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T08:15:09.374918-08:00","updated_at":"2025-12-19T09:30:41.343564-08:00","closed_at":"2025-12-19T09:30:41.343564-08:00","close_reason":"Added Example fields to status command and all 5 subcommands with realistic output samples","dependencies":[{"issue_id":"mcs-7as","depends_on_id":"mcs-kd7","type":"blocks","created_at":"2025-12-19T08:15:17.191108-08:00","created_by":"daemon"}]}
{"id":"mcs-7ca","title":"Split status.go into focused files","description":"status.go is 806 lines with 50+ functions. Split into: status_cmd.go (command definition), status_display.go (display formatting), status_extract.go (data extraction), status_format.go (formatting helpers). Single responsibility principle. File: internal/cli/status.go","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-18T23:38:59.270865-08:00","updated_at":"2025-12-19T01:08:52.075935-08:00","closed_at":"2025-12-19T01:08:52.075935-08:00","close_reason":"Split 846-line status.go into 4 focused files: status_cmd.go, status_display.go, status_extract.go, status_format.go","dependencies":[{"issue_id":"mcs-7ca","depends_on_id":"mcs-hal","type":"blocks","created_at":"2025-12-19T00:23:21.251722-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"mcs-7cyk","title":"Error wrapping loses underlying error context","description":"Using fmt.Errorf with %w may lose underlying error details and stack traces, making debugging harder; consider preserving original error information","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T23:14:35.537953-08:00","updated_at":"2025-12-20T16:20:04.260777-08:00","closed_at":"2025-12-20T16:20:04.260777-08:00","close_reason":"Duplicate of mcs-ewrg"}
{"id":"mcs-7l31","title":"Refactor CLI globals into struct to enable parallel tests","description":"7 nolint:paralleltest comments exist because CLI uses package-level globals (Version, ConfigFile, NoColor). Refactoring to encapsulate state in a struct would:\n- Allow tests to run in parallel (remove 6 nolint comments)\n- Remove gochecknoglobals exclusions for root.go\n- Improve testability and reduce shared state\n\nFiles:\n- internal/cli/root.go (globals)\n- internal/cli/root_test.go (6 nolint comments)\n- internal/cli/client_test.go (1 nolint for t.Setenv - separate issue)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-24T00:41:16.113431-08:00","updated_at":"2025-12-24T11:06:18.581347-08:00","closed_at":"2025-12-24T11:06:18.581347-08:00","close_reason":"Refactored CLI globals into CLIConfig struct passed via context. Removed Version/ConfigFile/NoColor globals from root.go, moved Version to main.go for ldflags. All tests pass, linters pass, goreleaser build verified."}
{"id":"mcs-7ob6","title":"Verify mcs-olye test was actually committed","description":"mcs-olye commit claims to add TestLoad_NilDereference to cache_test.go, but the commit diff only shows .beads/issues.jsonl changes. Need to verify if test exists or was lost.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T13:46:36.500625-08:00","updated_at":"2025-12-20T16:06:00.760308-08:00","closed_at":"2025-12-20T16:06:00.760308-08:00","close_reason":"Confirmed: TestLoad_NilDereference was not committed. However, TestLoad_NoCache already tests the nil-return behavior. No action needed."}
{"id":"mcs-7rm","title":"Define endpoint constants in control.go","description":"control.go lines 38-102 use string literals for endpoints. Define constants like EndpointDoorLock, EndpointDoorUnlock, etc.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T08:10:34.377202-08:00","updated_at":"2025-12-19T08:34:49.114252-08:00","closed_at":"2025-12-19T08:34:49.114252-08:00","close_reason":"Defined 12 endpoint constants, replaced all hardcoded endpoint strings"}
{"id":"mcs-7s1","title":"Refactor: Introduce InternalVIN type alias in CLI layer for type safety","description":"## Summary\nInternalVIN is passed around as a plain string throughout the CLI layer. This loses type safety - any string could be passed where an InternalVIN is expected.\n\n## Proposed Solution\nIntroduce a type alias: `type InternalVIN string` to catch errors at compile time.\n\n## Files to Modify\n- `internal/cli/client.go`\n- `internal/cli/confirm.go`\n- All command files that use internalVIN\n\n## Development Guidelines\n- **TDD**: Write tests first, then implementation\n- **DTSTTCPW**: Do the simplest thing that could possibly work\n- **DRY**: Don't repeat yourself\n- **No lint ignores**: All code must pass `golangci-lint run` without ignores\n- **No failing tests**: All tests must pass before committing\n- **Small frequent commits**: Commit after each logical change\n- **Attention to detail and high quality**: Clean code, proper error handling, good naming","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T13:39:40.354518-08:00","updated_at":"2025-12-19T14:54:23.813262-08:00","closed_at":"2025-12-19T14:54:23.813262-08:00","close_reason":"Introduced api.InternalVIN type throughout CLI layer for compile-time type safety"}
{"id":"mcs-7xb","title":"Add --confirm flag to 'mcs unlock' command","description":"## Summary\nAdd a `--confirm` flag (enabled by default) to the `mcs unlock` command that polls vehicle status until the doors are confirmed unlocked, instead of the current fire-and-forget behavior.\n\n## Current Behavior\nThe `mcs unlock` command sends the unlock request to the API and immediately returns with a success message, without verifying the doors actually unlocked.\n\n## Desired Behavior\n- Add `--confirm` flag (default: true) to poll status after sending unlock command\n- Use polling logic similar to `refreshAndWaitForStatus` in `status_cmd.go:257`\n- Poll until `GetDoorsInfo()` shows doors unlocked (`all_locked: false`)\n- Support `--confirm-wait` flag to configure max wait time (default: 90s)\n- Use `--confirm=false` to skip confirmation and use fire-and-forget behavior\n- Show progress messages while waiting (e.g., \"Waiting for door unlock confirmation... (30s/90s)\")\n\n## Files to Modify\n- `internal/cli/lock.go` - Add flag handling to unlock command\n- `internal/cli/command_factory.go` - May need to extend SimpleCommandConfig to support confirmation\n- Reuse shared polling logic from lock --confirm implementation\n\n## Development Guidelines\n- **TDD**: Write tests first, then implementation\n- **DTSTTCPW**: Do the simplest thing that could possibly work\n- **DRY**: Reuse polling logic from lock --confirm implementation\n- **No lint ignores**: All code must pass golangci-lint without ignores\n- **No failing tests**: All tests must pass before committing\n- **Small frequent commits**: Commit after each logical change\n- **Attention to detail and quality**: Clean code, proper error handling, good UX","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-19T11:00:21.548991-08:00","updated_at":"2025-12-19T11:08:16.664089-08:00","closed_at":"2025-12-19T11:08:16.664089-08:00","close_reason":"Implemented --confirm flag with reusable polling infrastructure"}
{"id":"mcs-8","title":"Implement control endpoints","description":"lock/unlock doors, start/stop engine, hazards on/off, charge start/stop, HVAC on/off/settings, send POI, refresh status","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-18T00:17:43.526323-08:00","updated_at":"2025-12-18T22:36:26.036689-08:00","closed_at":"2025-12-18T00:49:15.000289-08:00","dependencies":[{"issue_id":"mcs-8","depends_on_id":"mcs-5","type":"blocks","created_at":"2025-12-18T00:18:01.867128-08:00","created_by":"carlosvillela","metadata":"{}"}]}
{"id":"mcs-80n","title":"Refactor: Consolidate duplicate crypto utilities between api/crypto.go and crypto/crypto.go","description":"## Summary\nThe same PKCS7 padding and AES encryption logic exists in two places:\n- `internal/api/crypto.go`\n- `internal/crypto/crypto.go`\n\nThis is a maintenance risk - changes need to be made in both places.\n\n## Proposed Solution\nConsolidate into a single crypto package and have api/crypto.go import from it.\n\n## Files to Modify\n- `internal/api/crypto.go`\n- `internal/crypto/crypto.go`\n\n## Development Guidelines\n- **TDD**: Write tests first, then implementation\n- **DTSTTCPW**: Do the simplest thing that could possibly work\n- **DRY**: Don't repeat yourself\n- **No lint ignores**: All code must pass `golangci-lint run` without ignores\n- **No failing tests**: All tests must pass before committing\n- **Small frequent commits**: Commit after each logical change\n- **Attention to detail and high quality**: Clean code, proper error handling, good naming","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T13:41:49.287208-08:00","updated_at":"2025-12-19T17:14:37.96181-08:00","closed_at":"2025-12-19T17:14:37.96181-08:00","close_reason":"Already consolidated - api/crypto.go imports from internal/crypto, no duplication"}
{"id":"mcs-872","title":"Add --confirm flag to 'mcs climate on' command","description":"## Summary\nAdd a `--confirm` flag (enabled by default) to the `mcs climate on` command that polls vehicle status until HVAC is confirmed on, instead of the current fire-and-forget behavior.\n\n## Current Behavior\nThe `mcs climate on` command sends the HVAC on request to the API and immediately returns with a success message, without verifying HVAC actually turned on.\n\n## Desired Behavior\n- Add `--confirm` flag (default: true) to poll status after sending HVAC on command\n- Use polling logic similar to `refreshAndWaitForStatus` in `status_cmd.go:257`\n- Poll until `GetHvacInfo()` shows `On: true` (HVACStatusOn = 1)\n- Support `--confirm-wait` flag to configure max wait time (default: 90s)\n- Use `--confirm=false` to skip confirmation and use fire-and-forget behavior\n- Show progress messages while waiting (e.g., \"Waiting for HVAC on confirmation... (30s/90s)\")\n\n## Files to Modify\n- `internal/cli/climate.go` - Add flag handling\n- `internal/cli/command_factory.go` - May need to extend SimpleCommandConfig to support confirmation\n- Reuse shared polling logic from lock --confirm implementation\n\n## Development Guidelines\n- **TDD**: Write tests first, then implementation\n- **DTSTTCPW**: Do the simplest thing that could possibly work\n- **DRY**: Reuse polling logic from previous --confirm implementations\n- **No lint ignores**: All code must pass golangci-lint without ignores\n- **No failing tests**: All tests must pass before committing\n- **Small frequent commits**: Commit after each logical change\n- **Attention to detail and quality**: Clean code, proper error handling, good UX","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-19T11:00:29.28822-08:00","updated_at":"2025-12-19T12:33:14.54618-08:00","closed_at":"2025-12-19T12:33:14.54618-08:00","close_reason":"Implemented --confirm flag using existing polling infrastructure"}
{"id":"mcs-8ho7","title":"Encryption keys not rotated automatically, may cause stale key usage","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T23:13:11.711688-08:00","updated_at":"2025-12-20T12:56:24.4346-08:00","closed_at":"2025-12-20T12:56:24.4346-08:00","close_reason":"Closed"}
{"id":"mcs-8moc","title":"Long-running executeAPIRequest method reduces readability and testability","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T23:13:13.110617-08:00","updated_at":"2025-12-20T16:21:39.723733-08:00","closed_at":"2025-12-20T16:21:39.723733-08:00","close_reason":"Not worth fixing. The 117-line function is linear, well-commented, and cohesive. Each step (encrypt params, build URL, create request, set headers, sign, send, parse) is necessary. Extracting helpers would add indirection without improving clarity."}
{"id":"mcs-8rd","title":"Fix silent error ignoring in output functions","description":"20+ instances of fmt.Printf/Fprintf/Fprintln ignoring errors: toJSON() always ignores marshal errors (line 404-407), status.go and raw.go ignore write errors. At minimum, check errors in debug mode. Files: internal/cli/status.go, internal/cli/raw.go, internal/api/client.go lines 284-311","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-18T23:38:59.584022-08:00","updated_at":"2025-12-19T00:46:48.660722-08:00","closed_at":"2025-12-19T00:46:48.660722-08:00","close_reason":"Fixed toJSON() and all format functions to return errors instead of ignoring them"}
{"id":"mcs-9","title":"Implement config loading","description":"Load from ~/.config/cx90/config.toml, env var overrides (MYMAZDA_EMAIL, etc), viper integration","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-18T00:17:43.531426-08:00","updated_at":"2025-12-18T22:36:26.036474-08:00","closed_at":"2025-12-18T00:30:51.322087-08:00","dependencies":[{"issue_id":"mcs-9","depends_on_id":"mcs-2","type":"blocks","created_at":"2025-12-18T00:18:01.875811-08:00","created_by":"carlosvillela","metadata":"{}"}]}
{"id":"mcs-93f","title":"Tests: Add integration tests for command confirmation flows","description":"## Summary\nThe command confirmation flows lack integration tests that verify the full flow from command invocation to status polling.\n\n## Proposed Solution\nAdd integration tests that test the complete confirmation workflow with mock servers.\n\n## Files to Modify\n- `internal/cli/client_integration_test.go`\n- New integration test file for confirmations\n\n## Development Guidelines\n- **TDD**: Write tests first, then implementation\n- **DTSTTCPW**: Do the simplest thing that could possibly work\n- **DRY**: Don't repeat yourself\n- **No lint ignores**: All code must pass `golangci-lint run` without ignores\n- **No failing tests**: All tests must pass before committing\n- **Small frequent commits**: Commit after each logical change\n- **Attention to detail and high quality**: Clean code, proper error handling, good naming","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T13:41:41.158157-08:00","updated_at":"2025-12-19T17:11:17.503337-08:00","closed_at":"2025-12-19T17:11:17.503337-08:00","close_reason":"Added 480 lines of integration tests covering confirmation flows"}
{"id":"mcs-95c","title":"Simplify door status formatting with loop","description":"status_format.go lines 209-244 contain repetitive door checking logic. Use reflection or loop over door fields.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T08:10:21.319184-08:00","updated_at":"2025-12-19T09:07:21.400712-08:00","closed_at":"2025-12-19T09:07:21.400712-08:00","close_reason":"Replaced 40+ lines of repetitive if-statements with data-driven loop, 6 lines net reduction"}
{"id":"mcs-9s9","title":"Replace manual timeout loop with context.WithTimeout in status polling","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T02:15:20.391281-08:00","updated_at":"2025-12-19T07:49:24.110608-08:00","closed_at":"2025-12-19T07:49:24.110608-08:00","close_reason":"Closed","comments":[{"id":1,"issue_id":"mcs-9s9","author":"carlosvillela","text":"refreshAndWaitForStatus() in internal/cli/status_cmd.go:127-142 uses a manual for-loop with elapsed time tracking. More idiomatic Go would use context.WithTimeout() to create a derived context with deadline.\n\nFiles: internal/cli/status_cmd.go:113-162","created_at":"2025-12-24T19:28:13Z"}]}
{"id":"mcs-9yx","title":"Add Example field to 'mcs climate' commands","description":"Migrate climate set examples from Long to Example field. Add Example fields to climate on and climate off. Include success output examples.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T08:15:09.748909-08:00","updated_at":"2025-12-19T09:37:16.835211-08:00","closed_at":"2025-12-19T09:37:16.835211-08:00","close_reason":"Added Example fields to climate parent and on/off/set subcommands","dependencies":[{"issue_id":"mcs-9yx","depends_on_id":"mcs-kd7","type":"blocks","created_at":"2025-12-19T08:15:17.446819-08:00","created_by":"daemon"}]}
{"id":"mcs-a2x","title":"Add context parameter to client initialization functions","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T02:15:20.005923-08:00","updated_at":"2025-12-19T07:37:52.444015-08:00","closed_at":"2025-12-19T07:37:52.444015-08:00","close_reason":"Closed","comments":[{"id":2,"issue_id":"mcs-a2x","author":"carlosvillela","text":"createAPIClient() and setupVehicleClient() in internal/cli/client.go don't accept context parameters. This means config/cache loading happens without cancellation support. If the user hits Ctrl+C during initialization, it won't be respected.\n\nFiles: internal/cli/client.go:14, 86","created_at":"2025-12-24T19:28:13Z"}]}
{"id":"mcs-a2y","title":"Show relative time alongside timestamps","description":"Whenever we display a timestamp in status output, also show the relative time in a human-friendly format. Examples: '29 sec ago', '2 min ago', '1 hour ago', '5 days ago'. This makes it easier to quickly understand how recent the data is without doing mental date math.","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-19T01:46:30.769529-08:00","updated_at":"2025-12-19T01:51:00.595496-08:00","closed_at":"2025-12-19T01:51:00.595496-08:00","close_reason":"Closed","comments":[{"id":3,"issue_id":"mcs-a2y","author":"carlosvillela","text":"Research third-party libraries that make this easy to do in Go. No need to implement from scratch. Criteria: library should be actively maintained, well-supported, and small enough to be worth the dependency.","created_at":"2025-12-24T19:28:13Z"}]}
{"id":"mcs-a788","title":"Add tests for skill.go","description":"Add unit tests for internal/cli/skill.go:\n- getSkillPath() - returns correct path\n- uninstallSkill() - removes directory, handles not-exists\n- NewSkillInstallCmd() - installs files to correct location\n- NewSkillUninstallCmd() - removes skill directory\n- NewSkillPathCmd() - outputs correct path\n\nUse temporary directories for testing filesystem operations.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T18:47:37.187992-08:00","updated_at":"2025-12-21T18:49:31.004135-08:00","closed_at":"2025-12-21T18:49:31.004135-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mcs-a788","depends_on_id":"mcs-r6kk","type":"blocks","created_at":"2025-12-21T18:47:45.553137-08:00","created_by":"daemon"}]}
{"id":"mcs-ac2","title":"Add --confirm flag to 'mcs stop' command","description":"## Summary\nAdd a `--confirm` flag (enabled by default) to the `mcs stop` command that polls vehicle status until the engine is confirmed stopped, instead of the current fire-and-forget behavior.\n\n## Current Behavior\nThe `mcs stop` command sends the engine stop request to the API and immediately returns with a success message, without verifying the engine actually stopped.\n\n## Desired Behavior\n- Add `--confirm` flag (default: true) to poll status after sending stop command\n- Use polling logic similar to `refreshAndWaitForStatus` in `status_cmd.go:257`\n- Poll until vehicle status indicates engine is stopped\n- Support `--confirm-wait` flag to configure max wait time (default: 90s)\n- Use `--confirm=false` to skip confirmation and use fire-and-forget behavior\n- Show progress messages while waiting (e.g., \"Waiting for engine stop confirmation... (30s/90s)\")\n\n## Files to Modify\n- `internal/cli/engine.go` - Add flag handling\n- `internal/cli/command_factory.go` - May need to extend SimpleCommandConfig to support confirmation\n- Reuse shared polling logic from lock --confirm implementation\n\n## Development Guidelines\n- **TDD**: Write tests first, then implementation\n- **DTSTTCPW**: Do the simplest thing that could possibly work\n- **DRY**: Reuse polling logic from previous --confirm implementations\n- **No lint ignores**: All code must pass golangci-lint without ignores\n- **No failing tests**: All tests must pass before committing\n- **Small frequent commits**: Commit after each logical change\n- **Attention to detail and quality**: Clean code, proper error handling, good UX","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-19T11:00:26.564553-08:00","updated_at":"2025-12-19T11:12:03.856031-08:00","closed_at":"2025-12-19T11:12:03.856031-08:00","close_reason":"Implemented --confirm flag using existing polling infrastructure"}
{"id":"mcs-ai8","title":"Create type-safe helpers for map[string]interface{} assertions","description":"APIRequest returns map[string]interface{} requiring unsafe type assertions like response[\"resultCode\"].(string). Create helper functions: getString(m, key), getInt(m, key), getFloat(m, key) that return errors safely instead of panicking. Files: internal/api/client.go, control.go, vehicle.go","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T23:38:59.845164-08:00","updated_at":"2025-12-19T00:53:07.959249-08:00","closed_at":"2025-12-19T00:53:07.959249-08:00","close_reason":"Created maphelpers.go with type-safe getString/getInt/getFloat64/getBool/getMap/getSlice helpers"}
{"id":"mcs-aoi","title":"Consolidate format functions with strategy pattern","description":"status_format.go functions follow pattern: if JSON return toJSON(data), else return formatted string. Consider strategy pattern or shared dispatcher.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T08:10:46.978766-08:00","updated_at":"2025-12-19T09:20:52.859855-08:00","closed_at":"2025-12-19T09:20:52.859855-08:00","close_reason":"Analysis determined current design is optimal - strategy pattern would add complexity without benefit (YAGNI)"}
{"id":"mcs-brz","title":"Extract magic numbers to named constants","description":"Hardcoded magic numbers scattered: ChargerConnectorFitting==1, ChargeStatusSub==6, BatteryHeaterON==1, HVAC==1. Create named constants like ChargeStatusCharging=6. Files: internal/api/types.go lines 257-273, internal/cli/status.go","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-18T23:39:00.403901-08:00","updated_at":"2025-12-19T01:12:09.448332-08:00","closed_at":"2025-12-19T01:12:09.448332-08:00","close_reason":"Added 10 groups of named constants (ChargerConnected, ChargeStatusCharging, BatteryHeaterOn, HVACStatusOn, etc.)"}
{"id":"mcs-c2ui","title":"Potential race condition in token cache Save/Load if used concurrently","description":"TokenCache.Save and Load operations on the token cache file may be called from multiple goroutines without synchronization, risking race conditions when reading or writing the cache file","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T23:15:52.553668-08:00","updated_at":"2025-12-20T16:24:17.031896-08:00","closed_at":"2025-12-20T16:24:17.031896-08:00","close_reason":"Not applicable. CLI runs sequentially. Cache Load() and Save() are called in order within the same request flow in client.go, never from concurrent goroutines."}
{"id":"mcs-c56","title":"Simplify formatThousands using standard library","description":"formatThousands() (lines 695-725) is 30 lines of manual string manipulation. Replace with message.NewPrinter(language.English).Sprintf or simpler approach. File: internal/cli/status.go","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-18T23:39:00.969392-08:00","updated_at":"2025-12-19T01:17:00.663864-08:00","closed_at":"2025-12-19T01:17:00.663864-08:00","close_reason":"Replaced 30-line manual implementation with 3-line message.NewPrinter(language.English) solution"}
{"id":"mcs-cew","title":"Centralize result code error handling","description":"Result code checks (200S00) duplicated in control.go line 32, vehicle.go lines 55/77. Create handleResultCode helper.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T08:10:20.96298-08:00","updated_at":"2025-12-19T08:58:33.612362-08:00","closed_at":"2025-12-19T08:58:33.612362-08:00","close_reason":"Created checkResultCode helper and ResultCodeError type, replaced 4 duplicate checks","dependencies":[{"issue_id":"mcs-cew","depends_on_id":"mcs-0vf","type":"blocks","created_at":"2025-12-19T08:11:00.265952-08:00","created_by":"daemon"}]}
{"id":"mcs-cli9","title":"Create Claude Code skill for natural language vehicle control","description":"Create a Claude Code skill that translates natural language commands into mcs CLI commands. Users should be able to say things like 'warm up the car' and Claude will know to run 'mcs climate on'.\n\n## Goals\n- Natural language → CLI command translation\n- Cover all major vehicle controls (climate, locks, engine, charging)\n- Support status queries (battery, location, tires)\n- Provide clear feedback after commands execute\n\n## Skill Design\nSkills are stored in .claude/skills/\u003cname\u003e/SKILL.md and are auto-discovered by Claude Code. The SKILL.md provides instructions that Claude uses to translate intent into commands.","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-21T14:30:45.482203-08:00","updated_at":"2025-12-21T15:18:35.05288-08:00","closed_at":"2025-12-21T15:18:35.05288-08:00","close_reason":"Closed"}
{"id":"mcs-cpbw","title":"Add tests for raw command handlers","description":"Add tests for internal/cli/raw.go:\n- runRawStatus() - 0% coverage\n- runRawEV() - 0% coverage\n- runRawVehicle() - 0% coverage\n\nThese output raw JSON from API. Need mocked client.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-21T18:47:37.728274-08:00","updated_at":"2025-12-21T19:04:56.788163-08:00","closed_at":"2025-12-21T19:04:56.788163-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mcs-cpbw","depends_on_id":"mcs-r6kk","type":"blocks","created_at":"2025-12-21T18:47:45.953838-08:00","created_by":"daemon"}]}
{"id":"mcs-cw1s","title":"Config loading silently ignores error from v.ReadInConfig()","description":"In config.Load, the result of v.ReadInConfig() is assigned to _ and ignored, so errors like missing or malformed config files are silently skipped","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T23:14:37.785644-08:00","updated_at":"2025-12-20T16:20:03.495789-08:00","closed_at":"2025-12-20T16:20:03.495789-08:00","close_reason":"Already fixed in mcs-ehua: config errors are now propagated"}
{"id":"mcs-cy2","title":"Consolidate duplicate test server helpers in api tests","description":"## Problem\nTest server creation logic is duplicated:\n- `internal/api/test_helpers_test.go:32-52` - `createSuccessServer()`, `createErrorServer()`\n- `internal/api/control_test.go:14-50` - `createControlTestServer()`\n\nBoth implement the same pattern: create httptest server that encrypts JSON responses.\n\n## Solution\nConsolidate into `test_helpers_test.go`:\n\n```go\nfunc createTestServer(t *testing.T, handler func(w http.ResponseWriter, r *http.Request)) (*httptest.Server, *Client) {\n    // Common server setup with encryption\n}\n\nfunc createJSONResponseServer(t *testing.T, response interface{}) (*httptest.Server, *Client) {\n    // Wrapper for simple JSON response cases\n}\n```\n\nUpdate `control_test.go` to use shared helpers.\n\n## Impact\n~40 lines of duplicate test code removed, more consistent test patterns.","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-12-18T23:07:47.951579-08:00","updated_at":"2025-12-18T23:18:55.431547-08:00","closed_at":"2025-12-18T23:18:55.431547-08:00","close_reason":"Consolidated test server helpers with functional options pattern, ~65 lines removed"}
{"id":"mcs-dnb","title":"Create generic JSON field assertion helper for tests","description":"status_test.go lines 177-204, 312-324, 615-638 repeat JSON parsing and field validation. Create assertJSONField helper.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T08:10:46.802186-08:00","updated_at":"2025-12-19T09:12:24.216033-08:00","closed_at":"2025-12-19T09:12:24.216033-08:00","close_reason":"Created parseJSONToMap and assertMapValue helpers, updated 7 tests, removed 51 lines"}
{"id":"mcs-dru","title":"Add signal-aware context at CLI root level","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T02:15:20.581186-08:00","updated_at":"2025-12-19T07:51:03.970135-08:00","closed_at":"2025-12-19T07:51:03.970135-08:00","close_reason":"Closed","comments":[{"id":4,"issue_id":"mcs-dru","author":"carlosvillela","text":"The CLI root in internal/cli/root.go doesn't set up signal handling with context. While Cobra handles Ctrl+C, a custom context.WithCancel() listening for SIGINT/SIGTERM would allow graceful shutdown propagation through the entire call chain.\n\nFiles: internal/cli/root.go","created_at":"2025-12-24T19:28:13Z"}]}
{"id":"mcs-dzc","title":"Refactor: Unify status format functions signature pattern","description":"## Summary\nStatus format functions in status_format.go have inconsistent signatures - some take the info struct, some take individual fields.\n\n## Proposed Solution\nUnify all format functions to take the typed info struct consistently.\n\n## Files to Modify\n- `internal/cli/status_format.go`\n- `internal/cli/status_display.go`\n\n## Development Guidelines\n- **TDD**: Write tests first, then implementation\n- **DTSTTCPW**: Do the simplest thing that could possibly work\n- **DRY**: Don't repeat yourself\n- **No lint ignores**: All code must pass `golangci-lint run` without ignores\n- **No failing tests**: All tests must pass before committing\n- **Small frequent commits**: Commit after each logical change\n- **Attention to detail and high quality**: Clean code, proper error handling, good naming","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T13:40:05.337713-08:00","updated_at":"2025-12-19T15:10:55.707271-08:00","closed_at":"2025-12-19T15:10:55.707271-08:00","close_reason":"Unified format function signatures to consistently take typed structs"}
{"id":"mcs-e0yb","title":"Fix new linter issues (cyclop, gochecknoglobals, nestif)","description":"23 remaining issues after enabling cyclop, gochecknoglobals, godot, nestif, nlreturn linters. godot/nlreturn were auto-fixed.","status":"closed","priority":3,"issue_type":"epic","created_at":"2025-12-23T15:07:33.762878-08:00","updated_at":"2025-12-23T15:39:15.546735-08:00","closed_at":"2025-12-23T15:39:15.546735-08:00","close_reason":"All 5 tasks completed: cyclop, gochecknoglobals, and nestif linters now fully enabled","dependencies":[{"issue_id":"mcs-e0yb","depends_on_id":"mcs-gp8d","type":"blocks","created_at":"2025-12-23T15:07:58.068883-08:00","created_by":"daemon"},{"issue_id":"mcs-e0yb","depends_on_id":"mcs-y14o","type":"blocks","created_at":"2025-12-23T15:07:58.191306-08:00","created_by":"daemon"},{"issue_id":"mcs-e0yb","depends_on_id":"mcs-y4vd","type":"blocks","created_at":"2025-12-23T15:07:58.312186-08:00","created_by":"daemon"},{"issue_id":"mcs-e0yb","depends_on_id":"mcs-zach","type":"blocks","created_at":"2025-12-23T15:07:58.431937-08:00","created_by":"daemon"},{"issue_id":"mcs-e0yb","depends_on_id":"mcs-yz4p","type":"blocks","created_at":"2025-12-23T15:07:58.550374-08:00","created_by":"daemon"}]}
{"id":"mcs-e4b","title":"Tests: Consider generating mock responses from real API responses","description":"## Summary\nMock responses in tests are hand-crafted, which may drift from actual API responses.\n\n## Proposed Solution\nConsider recording real API responses and using them as test fixtures.\n\n## Files to Modify\n- `internal/api/test_helpers_test.go`\n- Test fixture files\n\n## Development Guidelines\n- **TDD**: Write tests first, then implementation\n- **DTSTTCPW**: Do the simplest thing that could possibly work\n- **DRY**: Don't repeat yourself\n- **No lint ignores**: All code must pass `golangci-lint run` without ignores\n- **No failing tests**: All tests must pass before committing\n- **Small frequent commits**: Commit after each logical change\n- **Attention to detail and high quality**: Clean code, proper error handling, good naming","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T13:42:07.683401-08:00","updated_at":"2025-12-19T18:03:00.395529-08:00","closed_at":"2025-12-19T18:03:00.395529-08:00","close_reason":"Not needed - type-safe unmarshaling provides API contract validation, current builder pattern works well","comments":[{"id":5,"issue_id":"mcs-e4b","author":"carlosvillela","text":"## Analysis\n\nAfter reviewing the codebase, I've evaluated whether generating mock responses from real API responses is worth implementing.\n\n### Current Approach\nThe project uses hand-crafted mock responses in tests with:\n1. **Structured builders**: MockVehicleStatusBuilder and MockEVVehicleStatusBuilder for fluent test data creation\n2. **Type-safe structs**: All API responses unmarshal to strongly-typed Go structs (VehicleStatusResponse, EVVehicleStatusResponse, etc.)\n3. **Comprehensive coverage**: ~4,674 lines of test code with excellent coverage of edge cases\n4. **Recent refactoring**: Just completed a refactoring sprint (commit a2fc2e2) that improved test quality and DRY\n\n### Evidence Review\n**No drift detected:**\n- All tests passing (go test ./... succeeds)\n- Type-safe unmarshaling means any API changes would fail at unmarshal time\n- Recent undisplayed_fields_test.go (673 lines) explicitly validates that undisplayed fields parse correctly\n- InternalVIN custom type handles API quirks (string vs number)\n\n**Maintenance patterns are working:**\n- Test helpers centralized in test_helpers_test.go\n- createTestServer/createSuccessServer provide consistent mock infrastructure\n- Mock builders (NewMockVehicleStatus) enable readable, maintainable tests\n- Recent refactorings show active maintenance and improvement\n\n### Cost/Benefit Analysis\n\n**Fixtures approach would add:**\n- Infrastructure to record/replay responses (new code, new complexity)\n- File management (where to store, how to update, version control bloat)\n- Reduced test readability (fixtures in separate files vs inline mock data)\n- Update friction (need to re-record when adding test cases)\n\n**Fixtures approach would provide:**\n- Guarantee that mocks exactly match real API (but we already have this via type safety)\n- Easier to add comprehensive test data (but builders already make this easy)\n\n### Decision: Close as Not Needed\n\nThe current approach is **working well** because:\n\n1. **Type safety is our fixture validator**: The strongly-typed structs mean if the API changes, unmarshaling will fail immediately. This is better than fixtures because it fails at the right abstraction level.\n\n2. **Hand-crafted mocks are more maintainable here**: \n   - Tests document exactly what matters for each scenario\n   - Builders provide reusability without file I/O\n   - Easy to create edge cases and error conditions\n\n3. **No evidence of drift**: \n   - All tests pass\n   - Recent comprehensive refactoring shows active maintenance\n   - undisplayed_fields_test.go proves the team is proactive about API coverage\n\n4. **DTSTTCPW principle**: There's no problem to solve. The current approach is simple and works.\n\nThe ONLY scenario where fixtures would help is if:\n- The API returned complex nested data that was tedious to construct\n- We needed to test exact byte-for-byte response handling\n- We were building a proxy/pass-through that needs perfect fidelity\n\nNone of these apply here. This is a CLI that extracts specific fields from API responses, with type-safe validation.\n\n**Recommendation**: Close as \"not needed\" - the current hand-crafted approach with builders is the right solution for this codebase.","created_at":"2025-12-24T19:28:13Z"}]}
{"id":"mcs-e4g","title":"Refactor: Extract common JSON extraction pattern in status_extract.go","description":"## Summary\nThe status_extract.go file has repeated JSON extraction patterns for building output maps.\n\n## Proposed Solution\nExtract common JSON building patterns into helper functions.\n\n## Files to Modify\n- `internal/cli/status_extract.go`\n\n## Development Guidelines\n- **TDD**: Write tests first, then implementation\n- **DTSTTCPW**: Do the simplest thing that could possibly work\n- **DRY**: Don't repeat yourself\n- **No lint ignores**: All code must pass `golangci-lint run` without ignores\n- **No failing tests**: All tests must pass before committing\n- **Small frequent commits**: Commit after each logical change\n- **Attention to detail and high quality**: Clean code, proper error handling, good naming","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T13:40:12.517944-08:00","updated_at":"2025-12-19T15:30:09.987697-08:00","closed_at":"2025-12-19T15:30:09.987697-08:00","close_reason":"Created generic extractWithGetter helper, added 327 lines of test coverage"}
{"id":"mcs-e7j","title":"Refactor: Consider introducing Duration type for confirmation timeouts","description":"## Summary\nConfirmation timeouts are passed as int (seconds) and converted to time.Duration. A proper Duration type could improve clarity.\n\n## Proposed Solution\nConsider using time.Duration directly or a custom ConfirmTimeout type.\n\n## Files to Modify\n- `internal/cli/confirm.go`\n- Command files using confirmation\n\n## Development Guidelines\n- **TDD**: Write tests first, then implementation\n- **DTSTTCPW**: Do the simplest thing that could possibly work\n- **DRY**: Don't repeat yourself\n- **No lint ignores**: All code must pass `golangci-lint run` without ignores\n- **No failing tests**: All tests must pass before committing\n- **Small frequent commits**: Commit after each logical change\n- **Attention to detail and high quality**: Clean code, proper error handling, good naming","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T13:41:32.085167-08:00","updated_at":"2025-12-19T16:59:55.644152-08:00","closed_at":"2025-12-19T16:59:55.644152-08:00","close_reason":"Not needed - current int seconds pattern is standard for CLI tools","comments":[{"id":6,"issue_id":"mcs-e7j","author":"carlosvillela","text":"Decision: Not implementing - current pattern is optimal\n\nAfter thorough analysis, the current implementation is the right approach:\n\n**Current Pattern:**\n- Commands accept int (seconds) via --confirm-wait flag\n- Conversion to time.Duration happens in one place: executeConfirmableCommand line 383\n- Users type: mcs lock --confirm-wait 90\n\n**Why Not to Change:**\n1. UX: Requiring '90s' instead of '90' is less intuitive for most users\n2. Industry standard: kubectl, docker, curl all use plain int seconds for timeouts\n3. No duplication: Conversion happens in exactly one place (DRY principle satisfied)\n4. Type safety: Internal functions already use time.Duration for type safety\n5. ParseDuration requires units: time.ParseDuration('90') fails with 'missing unit' error\n\n**Evidence:**\n- pflag supports DurationVar BUT requires unit suffixes (90s, 1m30s)\n- This would make the CLI less user-friendly for the common case of simple timeouts\n\n**Conclusion:**\nThe current pattern of accepting int seconds from CLI flags and converting to time.Duration internally is the standard approach for CLI tools. No change needed.","created_at":"2025-12-24T19:28:13Z"}]}
{"id":"mcs-ehua","title":"Silent config file read error ignored - config.go swallows v.ReadInConfig() error","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T23:13:04.738857-08:00","updated_at":"2025-12-19T23:26:08.041395-08:00","closed_at":"2025-12-19T23:26:08.041395-08:00","close_reason":"Closed"}
{"id":"mcs-ej7","title":"Add Example field to root 'mcs' command","description":"Add Cobra Example field to root command showing common workflows: checking status, locking doors, etc. Document region codes (MNAO=North America, MME=Europe, MJO=Japan/Oceania).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T08:15:10.603533-08:00","updated_at":"2025-12-19T09:27:54.917108-08:00","closed_at":"2025-12-19T09:27:54.917108-08:00","close_reason":"Added comprehensive Example field with status, lock, start, charge, and climate examples","dependencies":[{"issue_id":"mcs-ej7","depends_on_id":"mcs-kd7","type":"blocks","created_at":"2025-12-19T08:15:17.923559-08:00","created_by":"daemon"}]}
{"id":"mcs-eprl","title":"Command confirmation polling times out even when command succeeds","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-21T01:34:30.256577-08:00","updated_at":"2025-12-21T01:57:45.8004-08:00","closed_at":"2025-12-21T01:57:45.8004-08:00","close_reason":"Fixed in commits 495f021, 379dd42, effefca","comments":[{"id":7,"issue_id":"mcs-eprl","author":"carlosvillela","text":"## Bug Description\n\nCommands like `mcs unlock` and `mcs climate on` execute successfully (the vehicle responds correctly), but the confirmation polling times out after 90 seconds.\n\n## Steps to Reproduce\n\n1. Run `mcs unlock` or `mcs climate on`\n2. Observe the command succeeds (vehicle doors unlock / climate turns on)\n3. CLI polls for confirmation but times out\n\n## Expected Behavior\n\nConfirmation should succeed when the vehicle action completes.\n\n## Actual Behavior\n\n```\nClimate on command sent, waiting for confirmation...\nWaiting for confirmation... (5s/90s)\n...\nWaiting for confirmation... (90s/90s)\nWarning: HVAC on not confirmed within timeout period\nClimate on command sent (confirmation timeout)\n```\n\n## Possible Causes\n\n- Confirmation API endpoint returning unexpected status\n- Polling logic not recognizing success response\n- API response format changed","created_at":"2025-12-24T19:28:13Z"}]}
{"id":"mcs-ewrg","title":"Error wrapping may lose underlying error context and cause debugging difficulties","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T23:13:14.417535-08:00","updated_at":"2025-12-20T16:21:39.895679-08:00","closed_at":"2025-12-20T16:21:39.895679-08:00","close_reason":"Vague ticket with no specific examples. All error wrapping in the codebase uses fmt.Errorf with %w which preserves the error chain. errors.Is and errors.As work correctly."}
{"id":"mcs-f43g","title":"Debug logging printed directly to stdout may corrupt CLI output","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T23:13:09.038123-08:00","updated_at":"2025-12-20T12:48:01.393288-08:00","closed_at":"2025-12-20T12:48:01.393288-08:00","close_reason":"Closed"}
{"id":"mcs-fkm","title":"Add Example field to 'mcs charge' commands","description":"Add Cobra Example field to charge start and charge stop. Show success output examples.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T08:15:09.567753-08:00","updated_at":"2025-12-19T09:35:40.366658-08:00","closed_at":"2025-12-19T09:35:40.366658-08:00","close_reason":"Added Example fields to charge parent command and start/stop subcommands","dependencies":[{"issue_id":"mcs-fkm","depends_on_id":"mcs-kd7","type":"blocks","created_at":"2025-12-19T08:15:17.324114-08:00","created_by":"daemon"}]}
{"id":"mcs-fy02","title":"Eliminate real-time sleeps from tests","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T01:55:28.970636-08:00","updated_at":"2025-12-21T02:47:45.601067-08:00","closed_at":"2025-12-21T02:47:45.601067-08:00","close_reason":"Closed","comments":[{"id":8,"issue_id":"mcs-fy02","author":"carlosvillela","text":"## Problem\n\nTests are sleeping real wall-clock time, making the build unacceptably slow. Current test suite takes ~60s when it should take \u003c2s.\n\n### Worst Offenders\n\n| Test | Time | Location |\n|------|------|----------|\n| `TestAPIRequest_MaxRetries` | **23s** | `internal/api/client_integration_test.go` |\n| `TestConfirmationFlow_*` | 5-6s each | `internal/cli/confirm_integration_test.go` |\n| `TestWaitFor*` (8 tests) | 5s each | `internal/cli/confirm_test.go` |\n| `TestAPIRequest_*Retry*` | 1s each | `internal/api/client_integration_test.go` |\n\n**Total wasted time: ~70 seconds**\n\n### Root Causes\n\n1. **API retry tests** use real `sleepWithContext()` with exponential backoff (1s, 2s, 4s, 8s)\n2. **Confirmation tests** use `5*time.Second` timeout for \"never matches\" scenarios\n3. No time abstraction - tests call real `time.Sleep` via `sleepWithContext()`\n\n## Solution\n\n### 1. Inject sleep function into Client (for API retry tests)\n\n```go\n// In client.go\ntype Client struct {\n    // ... existing fields\n    sleepFunc func(context.Context, time.Duration) error // defaults to sleepWithContext\n}\n\n// Allow tests to override\nfunc (c *Client) SetSleepFunc(f func(context.Context, time.Duration) error) {\n    c.sleepFunc = f\n}\n```\n\nIn tests:\n```go\nclient.SetSleepFunc(func(ctx context.Context, d time.Duration) error {\n    return nil // instant \"sleep\"\n})\n```\n\n### 2. Reduce timeouts for \"never matches\" test cases\n\nIn `confirm_test.go`, change tests like `TestWaitForDoorsLocked` from:\n```go\n// Current: waits full 5s when doors never lock\nresult := waitForDoorsLocked(ctx, \u0026buf, mockClient, vin, 5*time.Second, 50*time.Millisecond)\n```\n\nTo:\n```go\n// Fixed: 200ms timeout for \"never matches\" cases\ntimeout := 5*time.Second\nif tt.name == \"doors never lock\" {\n    timeout = 200*time.Millisecond\n}\nresult := waitForDoorsLocked(ctx, \u0026buf, mockClient, vin, timeout, 50*time.Millisecond)\n```\n\n### 3. Use instant polling for confirmation integration tests\n\nPass shorter timeouts/intervals to integration tests, or inject a mock clock.\n\n## Acceptance Criteria\n\n- [ ] `go test ./...` completes in \u003c5 seconds\n- [ ] No test uses real sleeps \u003e100ms\n- [ ] Test coverage unchanged\n- [ ] Tests still catch timing-related bugs (context cancellation, timeout behavior)\n\n## Files to Modify\n\n- `internal/api/client.go` - Add sleepFunc field\n- `internal/api/client_integration_test.go` - Inject no-op sleep\n- `internal/cli/confirm_test.go` - Reduce timeouts for \"never matches\" cases\n- `internal/cli/confirm_integration_test.go` - Reduce timeouts","created_at":"2025-12-24T19:28:13Z"}]}
{"id":"mcs-g57","title":"Add table-driven tests for simple CLI commands","description":"lock_test.go, engine_test.go have separate functions for lock/unlock and start/stop tests when they follow identical patterns. Consolidate into single table-driven test.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T08:10:34.734673-08:00","updated_at":"2025-12-19T08:46:42.304897-08:00","closed_at":"2025-12-19T08:46:42.304897-08:00","close_reason":"Created table-driven simple_commands_test.go, consolidated 4 separate test files","dependencies":[{"issue_id":"mcs-g57","depends_on_id":"mcs-qcz","type":"blocks","created_at":"2025-12-19T08:11:00.597061-08:00","created_by":"daemon"}]}
{"id":"mcs-ghp7","title":"Potential race condition in client reuse","description":"The Client struct appears to be reused across goroutines without synchronization, which may cause race conditions when accessing shared fields like accessToken or encryption keys","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T23:14:43.990401-08:00","updated_at":"2025-12-20T16:23:38.628801-08:00","closed_at":"2025-12-20T16:23:38.628801-08:00","close_reason":"Not applicable. This is a CLI tool that runs sequentially. No goroutines share the Client. The background goroutine was removed in mcs-2mrp. Test goroutines are properly isolated."}
{"id":"mcs-gp8d","title":"Reduce cyclomatic complexity in API layer","description":"4 functions exceed cyclop max of 10:\n- auth.go:Login (12)\n- client.go:genericRetry (14)\n- client.go:executeAPIRequest (19)\n- types.go:GetDoorsInfo (11)\n\nRefactor to reduce branching, extract helpers, or split functions.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T15:07:51.697095-08:00","updated_at":"2025-12-23T15:15:05.834832-08:00","closed_at":"2025-12-23T15:15:05.834832-08:00","close_reason":"Extracted helpers: allDoorsLocked, validateLoginResponse, handleRetryableError, prepareRequestParams, calculateSignature, buildHTTPRequest"}
{"id":"mcs-gu8y","title":"Missing timeout on HTTP requests may cause hanging","description":"HTTP requests made by the client do not set a timeout, which can lead to indefinite blocking on slow or unresponsive endpoints","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T23:14:31.011286-08:00","updated_at":"2025-12-20T16:20:03.875024-08:00","closed_at":"2025-12-20T16:20:03.875024-08:00","close_reason":"Already addressed: httpClient has 30s timeout, auth functions use AuthRequestTimeout (15s) added in mcs-mnhn"}
{"id":"mcs-gv85","title":"Hardcoded IV reduces encryption security","description":"The encryption functions use a static IV (0102030405060708) which is insecure; a unique random IV should be generated for each encryption to ensure confidentiality","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T23:16:07.189355-08:00","updated_at":"2025-12-20T16:23:13.736892-08:00","closed_at":"2025-12-20T16:23:13.736892-08:00","close_reason":"Cannot fix. The IV is part of the manufacturer's API protocol. We must use their exact value for compatibility."}
{"id":"mcs-h1z","title":"Add integration tests for critical paths","description":"Missing integration tests for: config load-\u003eAPI client-\u003eAPI request-\u003etype parsing flow, error recovery (encryption key retry), cache persistence and validation. Add integration test suite with fixtures. Also consider BDD-style Given-When-Then structure for existing tests.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T23:39:00.687365-08:00","updated_at":"2025-12-19T01:05:24.032665-08:00","closed_at":"2025-12-19T01:05:24.032665-08:00","close_reason":"Added comprehensive integration tests: config-\u003eclient flow, error recovery, cache persistence. 402 tests passing."}
{"id":"mcs-hal","title":"Extract battery status formatting duplication","description":"formatBatteryStatus() (lines 410-462) and formatBatteryStatusCompact() (lines 477-513) are nearly identical - 40+ lines of duplicated conditional logic for charging flags. Extract flag-building logic into helper function. File: internal/cli/status.go","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T23:38:58.51531-08:00","updated_at":"2025-12-19T00:37:06.167274-08:00","closed_at":"2025-12-19T00:37:06.167274-08:00","close_reason":"Extracted buildBatteryStatusFlags() helper, reduced ~60 lines to 30"}
{"id":"mcs-hdx","title":"Refactor: Extract color formatting into terminal package","description":"## Summary\nColor formatting code in color.go could be extracted into a reusable terminal package for better organization.\n\n## Proposed Solution\nCreate internal/terminal package with color formatting utilities.\n\n## Files to Modify\n- `internal/cli/color.go` -\u003e `internal/terminal/color.go`\n\n## Development Guidelines\n- **TDD**: Write tests first, then implementation\n- **DTSTTCPW**: Do the simplest thing that could possibly work\n- **DRY**: Don't repeat yourself\n- **No lint ignores**: All code must pass `golangci-lint run` without ignores\n- **No failing tests**: All tests must pass before committing\n- **Small frequent commits**: Commit after each logical change\n- **Attention to detail and high quality**: Clean code, proper error handling, good naming","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T13:42:33.566239-08:00","updated_at":"2025-12-19T18:08:04.11653-08:00","closed_at":"2025-12-19T18:08:04.11653-08:00","close_reason":"Not needed - color.go only used within cli package, no reuse opportunity","comments":[{"id":9,"issue_id":"mcs-hdx","author":"carlosvillela","text":"Analysis complete: Color formatting should stay in internal/cli package.\n\nReasons:\n1. Only used within cli package - no cross-package reuse\n2. Includes CLI-specific domain logic (ColorPressure, ProgressBar)\n3. Current organization is simple and appropriate\n4. Extraction would add unnecessary abstraction and complexity\n5. Violates DTSTTCPW principle\n\nRecommendation: Keep color.go in internal/cli. Close as won't fix.","created_at":"2025-12-24T19:28:13Z"}]}
{"id":"mcs-hfm","title":"Remove or implement stub functions in sensordata","description":"## Problem\n8 generator functions in `internal/sensordata/sensor_data.go` return empty strings:\n- `generateEditedText()` (line 113)\n- `generateOrientationDataAA()` (line 117)\n- `generateMotionDataAA()` (line 121)\n- `generateOrientationDataAC()` (line 125)\n- `generateOrientationDataAB()` (line 129)\n- `generateMotionDataAC()` (line 133)\n- `generateMotionEvent()` (line 137)\n- `generateStoredStackTraces()` (line 179)\n\n## Context\nThese are placeholders from the Python port. The anti-bot fingerprinting works without them, but they add noise to the codebase.\n\n## Options\n1. **Remove entirely** - Delete functions and their call sites if not needed\n2. **Implement** - Port remaining logic from reference implementation if needed for edge cases\n\n## Recommendation\nRemove them. The current implementation passes authentication without these values.","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-12-18T23:07:47.579543-08:00","updated_at":"2025-12-18T23:13:44.7771-08:00","closed_at":"2025-12-18T23:13:44.7771-08:00","close_reason":"Removed 8 stub functions (32 lines), tests pass, lint clean"}
{"id":"mcs-itzw","title":"Missing unit tests for calculateBackoff function","description":"The calculateBackoff function contains core logic for retry delays but lacks dedicated unit tests, increasing risk of regression when modifying backoff behavior","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T23:16:10.237062-08:00","updated_at":"2025-12-20T16:24:52.663039-08:00","closed_at":"2025-12-20T16:24:52.663039-08:00","close_reason":"Invalid. TestCalculateBackoff already exists at client_test.go:428 with table-driven tests for retryCount 0-5."}
{"id":"mcs-ivb2","title":"Add location to mcs status text output","description":"The help text for `mcs status` says it shows location, but the text output doesn't include it.\n\n## Problem\n- `displayAllStatusText` in `status_display.go` doesn't include location\n- JSON output (`--json`) correctly includes location\n- `mcs status location` subcommand works correctly\n- Only the default text output is missing location\n\n## Fix\nAdd location to `displayAllStatusText` function, similar to how other sections are added.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T10:09:27.038691-08:00","updated_at":"2025-12-29T10:11:00.45755-08:00","closed_at":"2025-12-29T10:11:00.45755-08:00","close_reason":"Closed"}
{"id":"mcs-iz2e","title":"CLAUDE.md: Token Caching section could reference cache.go for implementation details","description":"## Problem\n\nCLAUDE.md Token Caching section (lines 143-147) provides good high-level info but doesn't reference where to find implementation details.\n\nCLAUDE.md:\n```\n### Token Caching\nCredentials are cached in ~/.cache/mcs/token.json. The cache stores:\n- accessToken + expiration timestamp\n- encKey and signKey\n\nWithout caching, each command takes ~4.5s (full auth). With caching: ~2.7s.\n```\n\nThe implementation in cache/cache.go shows the actual TokenCache struct and validation logic. A reference would be helpful.\n\nAlso, the timing numbers (4.5s, 2.7s) may become stale as performance characteristics change.\n\n## Location\n- /Users/carlosvillela/src/dummy/mysmartcar/mcs/CLAUDE.md (lines 143-147)\n- /Users/carlosvillela/src/dummy/mysmartcar/mcs/internal/cache/cache.go\n\n## How to Fix\n1. Add reference to cache/cache.go for implementation\n2. Consider removing or qualifying the timing numbers ('approximately' or 'as of date X')\n\n## Development Guidelines\n- TDD, DTSTTCPW, DRY\n- No lint ignores, no failing tests\n- Small commits, quality focus","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-19T17:49:25.672906-08:00","updated_at":"2025-12-20T17:21:20.085499-08:00","closed_at":"2025-12-20T17:21:20.085499-08:00","close_reason":"Fixed in docs commit 13fbe00"}
{"id":"mcs-jk1","title":"CLAUDE.md: maphelpers docs missing getMapSlice and getMapFromSlice","description":"## Problem\n\nCLAUDE.md documents the Type-Safe Map Helpers but is missing two functions that exist in the actual code.\n\nCLAUDE.md shows only:\n- getString, getInt, getFloat64, getBool, getMap, getSlice\n\nActual maphelpers.go also includes:\n- getMapSlice - extracts []map[string]interface{} from a map\n- getMapFromSlice - gets a map from a slice at given index\n\nThese additional helpers may be useful for developers working with the API responses.\n\n## Location\n- /Users/carlosvillela/src/dummy/mysmartcar/mcs/CLAUDE.md (lines 119-126)\n- /Users/carlosvillela/src/dummy/mysmartcar/mcs/internal/api/maphelpers.go (lines 91-128)\n\n## How to Fix\nAdd the missing functions to the documentation:\n```go\ngetMapSlice(m, \"key\")       // ([]map[string]interface{}, bool)\ngetMapFromSlice(slice, idx) // (map[string]interface{}, bool)\n```\n\n## Development Guidelines\n- TDD, DTSTTCPW, DRY\n- No lint ignores, no failing tests\n- Small commits, quality focus","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T17:47:59.998532-08:00","updated_at":"2025-12-20T16:39:13.11757-08:00","closed_at":"2025-12-20T16:39:13.11757-08:00","close_reason":"Fixed in docs commit a4d70e1"}
{"id":"mcs-jpq","title":"Document cryptic Feistel cipher in sensor_data.go","description":"Feistel cipher implementation (lines 238-263) has poorly named variables (toSigned32, iterate, v21, v8) and no comments. Add detailed comments explaining what the cipher does and why. Critical for maintainability. File: internal/sensordata/sensor_data.go","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-18T23:39:01.539112-08:00","updated_at":"2025-12-19T01:13:22.763076-08:00","closed_at":"2025-12-19T01:13:22.763076-08:00","close_reason":"Added comprehensive Feistel cipher documentation, renamed cryptic variables to descriptive names"}
{"id":"mcs-k7u","title":"Remove unused findSubcommand test helper","description":"## Problem\n`internal/cli/test_helpers_test.go:7-14` defines `findSubcommand()` but it's never called.\n\n```go\nfunc findSubcommand(cmd *cobra.Command, name string) *cobra.Command {\n    for _, c := range cmd.Commands() {\n        if c.Name() == name {\n            return c\n        }\n    }\n    return nil\n}\n```\n\n## Solution\nDelete the function.\n\n## Verification\n```bash\ngrep -r \"findSubcommand\" internal/\n# Should only show the definition, no call sites\n```","status":"closed","priority":4,"issue_type":"chore","created_at":"2025-12-18T23:08:08.800473-08:00","updated_at":"2025-12-18T23:19:46.72578-08:00","closed_at":"2025-12-18T23:19:46.72578-08:00","close_reason":"Invalid: function is actually used in 4 test files (charge_test, climate_test, raw_test, status_test)"}
{"id":"mcs-kd7","title":"Add Cobra Example fields with output examples for AI agent discoverability","description":"Migrate CLI help text to use Cobra's Example field instead of embedding examples in Long. Include output examples (both human-readable and JSON) so AI agents can learn the tool from --help alone. This enables simpler skill definitions that just point to the CLI.","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-19T08:14:42.193631-08:00","updated_at":"2025-12-19T09:38:58.165208-08:00","closed_at":"2025-12-19T09:38:58.165208-08:00","close_reason":"All 7 subtasks completed - Example fields added to all commands"}
{"id":"mcs-lfr","title":"Extract shared request logic from sendAPIRequest/sendAPIRequestJSON","description":"client.go lines 171-321 and 323-473 contain ~152 lines of nearly identical code. Only difference is return type. Extract common request preparation, header setup, execution, and error handling into shared function.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T08:10:06.332008-08:00","updated_at":"2025-12-19T08:18:27.920179-08:00","closed_at":"2025-12-19T08:18:27.920179-08:00","close_reason":"Extracted executeAPIRequest function, reduced ~135 lines of duplication"}
{"id":"mcs-m3t","title":"CLAUDE.md: Response Structs table shows wrong TireInfo fields","description":"## Problem\n\nCLAUDE.md documents GetTiresInfo() as returning TireInfo with fields 'FrontLeft, FrontRight, RearLeft, RearRight', but actual implementation uses '*Psi' suffix on all fields.\n\nCLAUDE.md line 80:\n`| GetTiresInfo() | TireInfo | FrontLeft, FrontRight, RearLeft, RearRight |`\n\nActual code in internal/api/types.go:\n```go\ntype TireInfo struct {\n    FrontLeftPsi  float64\n    FrontRightPsi float64\n    RearLeftPsi   float64\n    RearRightPsi  float64\n}\n```\n\n## Location\n- /Users/carlosvillela/src/dummy/mysmartcar/mcs/CLAUDE.md (line 80)\n- /Users/carlosvillela/src/dummy/mysmartcar/mcs/internal/api/types.go (lines 364-370)\n\n## How to Fix\nUpdate CLAUDE.md to show: 'FrontLeftPsi, FrontRightPsi, RearLeftPsi, RearRightPsi'\n\n## Development Guidelines\n- TDD, DTSTTCPW, DRY\n- No lint ignores, no failing tests\n- Small commits, quality focus","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T17:47:12.228528-08:00","updated_at":"2025-12-19T18:09:20.318757-08:00","closed_at":"2025-12-19T18:09:20.318757-08:00","close_reason":"Fixed Response Structs table to match actual types.go definitions"}
{"id":"mcs-m66","title":"Add --confirm flag to 'mcs charge stop' command","description":"## Summary\nAdd a `--confirm` flag (enabled by default) to the `mcs charge stop` command that polls vehicle status until charging is confirmed stopped, instead of the current fire-and-forget behavior.\n\n## Current Behavior\nThe `mcs charge stop` command sends the charge stop request to the API and immediately returns with a success message, without verifying charging actually stopped.\n\n## Desired Behavior\n- Add `--confirm` flag (default: true) to poll status after sending charge stop command\n- Use polling logic similar to `refreshAndWaitForStatus` in `status_cmd.go:257`\n- Poll until `GetBatteryInfo()` shows `Charging: false` (not ChargeStatusCharging)\n- Support `--confirm-wait` flag to configure max wait time (default: 90s)\n- Use `--confirm=false` to skip confirmation and use fire-and-forget behavior\n- Show progress messages while waiting (e.g., \"Waiting for charging stop confirmation... (30s/90s)\")\n\n## Files to Modify\n- `internal/cli/charge.go` - Add flag handling\n- `internal/cli/command_factory.go` - May need to extend SimpleCommandConfig to support confirmation\n- Reuse shared polling logic from lock --confirm implementation\n\n## Development Guidelines\n- **TDD**: Write tests first, then implementation\n- **DTSTTCPW**: Do the simplest thing that could possibly work\n- **DRY**: Reuse polling logic from previous --confirm implementations\n- **No lint ignores**: All code must pass golangci-lint without ignores\n- **No failing tests**: All tests must pass before committing\n- **Small frequent commits**: Commit after each logical change\n- **Attention to detail and quality**: Clean code, proper error handling, good UX","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-19T11:00:28.400858-08:00","updated_at":"2025-12-19T12:26:21.797975-08:00","closed_at":"2025-12-19T12:26:21.797975-08:00","close_reason":"Implemented --confirm flag using existing polling infrastructure"}
{"id":"mcs-m83","title":"Refactor: Introduce Region type instead of string for configuration","description":"## Summary\nRegion is used as a plain string (\"MNAO\", \"MME\", \"MJO\") in configuration. This allows invalid values to be passed.\n\n## Proposed Solution\nIntroduce a Region type with validation and constants for valid regions.\n\n## Files to Modify\n- `internal/config/config.go`\n- `internal/api/client.go`\n\n## Development Guidelines\n- **TDD**: Write tests first, then implementation\n- **DTSTTCPW**: Do the simplest thing that could possibly work\n- **DRY**: Don't repeat yourself\n- **No lint ignores**: All code must pass `golangci-lint run` without ignores\n- **No failing tests**: All tests must pass before committing\n- **Small frequent commits**: Commit after each logical change\n- **Attention to detail and high quality**: Clean code, proper error handling, good naming","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T13:40:19.978661-08:00","updated_at":"2025-12-19T15:37:26.433185-08:00","closed_at":"2025-12-19T15:37:26.433185-08:00","close_reason":"Introduced Region type with validation and constants for compile-time type safety"}
{"id":"mcs-mdgu","title":"Hardcoded backoff cap of 8 seconds reduces adaptability","description":"The backoff calculation uses a hardcoded cap of 8 seconds; making the cap configurable would improve adaptability to different network conditions","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T23:14:27.70149-08:00","updated_at":"2025-12-20T16:20:04.647825-08:00","closed_at":"2025-12-20T16:20:04.647825-08:00","close_reason":"Low value. The 8-second cap is reasonable and changing it provides minimal benefit."}
{"id":"mcs-mnhn","title":"Extract timeout constant for API requests","description":"mcs-zaqj added 15-second timeouts but hardcoded the value in 3 places (GetEncryptionKeys, GetUsherEncryptionKey, Login). Should be a named constant for maintainability.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-20T13:46:36.330213-08:00","updated_at":"2025-12-20T16:08:46.12076-08:00","closed_at":"2025-12-20T16:08:46.12076-08:00","close_reason":"Added AuthRequestTimeout constant and replaced 3 hardcoded timeout values."}
{"id":"mcs-mtx","title":"Extract handleAPIError from client.go","description":"Error handling switch statements (lines 298-310, 450-462) are duplicated. Extract to handleAPIError(response *APIBaseResponse) error.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T08:10:47.329963-08:00","updated_at":"2025-12-19T09:01:50.760528-08:00","closed_at":"2025-12-19T09:01:50.760528-08:00","close_reason":"Extracted handleAPIResponse function for better separation of concerns","dependencies":[{"issue_id":"mcs-mtx","depends_on_id":"mcs-lfr","type":"blocks","created_at":"2025-12-19T08:11:00.43284-08:00","created_by":"daemon"}]}
{"id":"mcs-myp","title":"Remove unnecessary marshal/unmarshal round-trip in vehicle.go","description":"unmarshalResponse[T]() performs expensive round-trip: map[string]interface{} -\u003e JSON bytes -\u003e unmarshal to T. Called 3x per session from GetVecBaseInfos, GetVehicleStatus, GetEVVehicleStatus. Either use direct type assertion or proper generic approach. File: internal/api/vehicle.go lines 9-22","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T23:38:58.93467-08:00","updated_at":"2025-12-19T00:41:57.701261-08:00","closed_at":"2025-12-19T00:41:57.701261-08:00","close_reason":"Added APIRequestJSON() to return raw bytes, eliminated double marshal/unmarshal"}
{"id":"mcs-n42l","title":"Add command reference documentation","description":"Create supporting COMMAND_REFERENCE.md with:\n- Full CLI syntax for each mcs command\n- Available flags and options\n- Output format examples (text vs JSON)\n- Confirmation polling details\n- Error handling guidance","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-21T14:31:13.299516-08:00","updated_at":"2025-12-21T15:17:50.363208-08:00","closed_at":"2025-12-21T15:17:50.363208-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mcs-n42l","depends_on_id":"mcs-cli9","type":"blocks","created_at":"2025-12-21T14:31:21.686572-08:00","created_by":"daemon"},{"issue_id":"mcs-n42l","depends_on_id":"mcs-zhlj","type":"blocks","created_at":"2025-12-21T14:31:22.205737-08:00","created_by":"daemon"}]}
{"id":"mcs-ngg","title":"CLAUDE.md: Project Structure section is missing files","description":"## Problem\n\nThe Project Structure section in CLAUDE.md is incomplete. It lists files that exist but is missing several files that have been added to the codebase.\n\n### Missing files in internal/cli/:\n- color.go - Color/formatting utilities for terminal output\n- confirm.go - Confirmation polling logic for commands\n\n### Missing files in internal/sensordata/:\n- key_event.go - Key event generation\n- background_event.go - Background event generation  \n- touch_event.go - Touch event generation\n- system_info.go - System info generation\n- performance.go - Performance test result generation\n\nThe documented structure shows only 'sensor_data.go' for sensordata, but there are 5 additional files.\n\n### command_factory.go listed but empty\nThe file is listed in CLAUDE.md as 'Command builder helpers' but the actual file is essentially empty (just package declaration).\n\n## Location\n- /Users/carlosvillela/src/dummy/mysmartcar/mcs/CLAUDE.md (lines 5-35)\n\n## How to Fix\nEither:\n1. Add the missing files to the structure with brief descriptions, OR\n2. Keep the structure high-level and note it's not exhaustive\n\n## Development Guidelines\n- TDD, DTSTTCPW, DRY\n- No lint ignores, no failing tests\n- Small commits, quality focus","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T17:47:40.226771-08:00","updated_at":"2025-12-20T16:39:13.115294-08:00","closed_at":"2025-12-20T16:39:13.115294-08:00","close_reason":"Fixed in docs commit a4d70e1"}
{"id":"mcs-olye","title":"Token cache Load returns nil without error, potential nil dereference","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T23:13:10.376479-08:00","updated_at":"2025-12-20T12:49:03.038724-08:00","closed_at":"2025-12-20T12:49:03.038724-08:00","close_reason":"Closed"}
{"id":"mcs-otp","title":"Add Example field to 'mcs start' and 'mcs stop' commands","description":"Add Cobra Example field to engine start and stop commands. Show success output examples.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T08:15:10.141073-08:00","updated_at":"2025-12-19T09:33:30.362651-08:00","closed_at":"2025-12-19T09:33:30.362651-08:00","close_reason":"Added Example fields to start and stop commands","dependencies":[{"issue_id":"mcs-otp","depends_on_id":"mcs-kd7","type":"blocks","created_at":"2025-12-19T08:15:17.684345-08:00","created_by":"daemon"}]}
{"id":"mcs-p3a5","title":"Confirmation polling should refresh vehicle status before polling","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-21T02:07:52.678903-08:00","updated_at":"2025-12-21T02:13:55.023357-08:00","closed_at":"2025-12-21T02:13:55.023357-08:00","close_reason":"Fixed in commit e04e276","comments":[{"id":10,"issue_id":"mcs-p3a5","author":"carlosvillela","text":"## Root Cause\n\nConfirmation polling reads stale cached data from the server. The status command calls `RefreshVehicleStatus` (activeRealTimeVehicleStatus endpoint) before fetching status, but confirmation polling doesn't.\n\n## Evidence\n\n- `mcs unlock` succeeds (doors physically unlock)\n- `mcs raw status` shows `LockLinkSw*: 0` (locked) - stale data\n- Status command (`internal/cli/status_cmd.go:265`) calls `RefreshVehicleStatus` first\n- Confirmation polling (`internal/cli/confirm.go`) does NOT call refresh\n\n## Fix\n\nCall `RefreshVehicleStatus` at the start of confirmation polling to wake the vehicle and get fresh data. May also need to call it periodically during polling if status remains stale.\n\n## Files\n\n- `internal/cli/confirm.go` - Add RefreshVehicleStatus call\n- `internal/api/control.go:114-116` - RefreshVehicleStatus function","created_at":"2025-12-24T19:28:13Z"}]}
{"id":"mcs-qcz","title":"Create shared CLI test helpers for command basics","description":"lock_test.go, engine_test.go, charge_test.go, climate_test.go all have identical test patterns for Use field and Short description. Create testCommandBasics helper.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T08:10:06.665551-08:00","updated_at":"2025-12-19T08:45:12.492118-08:00","closed_at":"2025-12-19T08:45:12.492118-08:00","close_reason":"Created assertCommandBasics and assertNoArgsCommand helpers, refactored 4 test files, eliminated ~40 lines"}
{"id":"mcs-r0sw","title":"Test skill with various natural language inputs","description":"Test the skill works correctly:\n- 'warm up the car' → mcs climate on\n- 'lock the doors' → mcs lock on\n- 'what's my battery level' → mcs status\n- 'start the engine' → mcs engine on\n- Verify Claude discovers and uses the skill\n- Test edge cases and ambiguous requests","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T14:31:13.480432-08:00","updated_at":"2025-12-21T15:18:09.456366-08:00","closed_at":"2025-12-21T15:18:09.456366-08:00","close_reason":"Skill structure verified. Manual testing required - ask Claude 'warm up the car' to test","dependencies":[{"issue_id":"mcs-r0sw","depends_on_id":"mcs-cli9","type":"blocks","created_at":"2025-12-21T14:31:21.808231-08:00","created_by":"daemon"},{"issue_id":"mcs-r0sw","depends_on_id":"mcs-sbhx","type":"blocks","created_at":"2025-12-21T14:31:22.323327-08:00","created_by":"daemon"}]}
{"id":"mcs-r6kk","title":"Improve test coverage","description":"Current coverage is 68%. Goal is to improve coverage, particularly in the cli package (49.6%) and new skill package (0%).\n\n## Current State\n- crypto: 91.4% ✅\n- sensordata: 86.5% ✅\n- cache: 86.1% ✅\n- config: 81.8% ✅\n- api: 81.6% ✅\n- cli: 49.6% ⚠️\n- skill: 0% ❌\n\n## Key Gaps\n1. skill.go - no tests at all\n2. CLI integration functions (withVehicleClient, runStatus, etc.)\n3. Status display/format helpers\n4. Raw command handlers","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-21T18:47:19.225728-08:00","updated_at":"2025-12-21T22:37:51.135508-08:00","closed_at":"2025-12-21T22:37:51.135508-08:00","close_reason":"All 5 sub-tasks completed: skill.go tests, CLI client helpers, raw command handlers, confirmation polling gaps, and status display functions. Coverage improvements committed."}
{"id":"mcs-rmk","title":"Add backoff delay with context check in API retry logic","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T02:15:20.198613-08:00","updated_at":"2025-12-19T07:47:40.370862-08:00","closed_at":"2025-12-19T07:47:40.370862-08:00","close_reason":"Closed","comments":[{"id":11,"issue_id":"mcs-rmk","author":"carlosvillela","text":"The retry logic in internal/api/client.go:50-71 retries immediately without any backoff delay. If auth fails, it hammers the API repeatedly. Should add exponential backoff with context cancellation check during the sleep.\n\nFiles: internal/api/client.go:50-71","created_at":"2025-12-24T19:28:13Z"}]}
{"id":"mcs-sbhx","title":"Write SKILL.md with command mappings","description":"Create the main SKILL.md file with:\n- Proper frontmatter (name, description with trigger keywords)\n- Natural language → CLI mappings for all commands\n- Climate: warm/cool/heat → mcs climate on/off\n- Locks: lock/unlock → mcs lock on/off\n- Engine: start/stop → mcs engine on/off\n- Charging: charge → mcs charge on/off\n- Status: battery/location/tires → mcs status queries\n- Examples showing translation process\n- Notes on --confirm flag usage","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T14:31:13.126706-08:00","updated_at":"2025-12-21T14:54:04.035762-08:00","closed_at":"2025-12-21T14:54:04.035762-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mcs-sbhx","depends_on_id":"mcs-cli9","type":"blocks","created_at":"2025-12-21T14:31:21.566775-08:00","created_by":"daemon"},{"issue_id":"mcs-sbhx","depends_on_id":"mcs-zhlj","type":"blocks","created_at":"2025-12-21T14:31:22.08876-08:00","created_by":"daemon"}]}
{"id":"mcs-sfjx","title":"Fix post-v0.5.1 quality issues","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-20T13:46:18.189242-08:00","updated_at":"2025-12-20T16:08:46.282415-08:00","closed_at":"2025-12-20T16:08:46.282415-08:00","close_reason":"All subtasks completed: build fixed, goroutine removed, test verified, timeout constant extracted.","dependencies":[{"issue_id":"mcs-sfjx","depends_on_id":"mcs-u32x","type":"blocks","created_at":"2025-12-20T13:46:45.917354-08:00","created_by":"daemon"},{"issue_id":"mcs-sfjx","depends_on_id":"mcs-2mrp","type":"blocks","created_at":"2025-12-20T13:46:46.036475-08:00","created_by":"daemon"},{"issue_id":"mcs-sfjx","depends_on_id":"mcs-mnhn","type":"blocks","created_at":"2025-12-20T13:46:46.153929-08:00","created_by":"daemon"},{"issue_id":"mcs-sfjx","depends_on_id":"mcs-7ob6","type":"blocks","created_at":"2025-12-20T13:46:46.272032-08:00","created_by":"daemon"}]}
{"id":"mcs-sgyn","title":"Potential missing error handling for json.Unmarshal in handleAPIResponse","description":"handleAPIResponse attempts to unmarshal the response body into APIBaseResponse without checking for JSON syntax errors, which could cause panics if the response is not valid JSON; adding explicit error handling would improve robustness","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T23:15:58.432087-08:00","updated_at":"2025-12-20T16:24:38.739559-08:00","closed_at":"2025-12-20T16:24:38.739559-08:00","close_reason":"Invalid. json.Unmarshal error IS checked at line 293-294 in executeAPIRequest before calling handleAPIResponse. Error is properly wrapped and returned."}
{"id":"mcs-sq3f","title":"Consolidate status_display.go formatting logic","description":"Two display sections (lines 61-92 and 110-141) have similar structure. Consolidate into shared helper functions.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T10:06:16.890147-08:00","updated_at":"2025-12-23T14:48:22.69155-08:00","closed_at":"2025-12-23T14:48:22.69155-08:00","close_reason":"Created appendFormattedSection helper, eliminated duplicate formatting patterns"}
{"id":"mcs-sucm","title":"Convert format/type tests to table-driven style","description":"status_format_test.go (lines 65-131) and types_test.go (lines 11-77) have duplicate test structures. Consider table-driven tests, but weigh against test clarity.","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-23T10:06:17.228381-08:00","updated_at":"2025-12-23T14:52:52.594174-08:00","closed_at":"2025-12-23T14:52:52.594174-08:00","close_reason":"Created runDoorStatusTest and runBoolStatusTest helpers, eliminated 10 duplicate test patterns in confirm_test.go"}
{"id":"mcs-swm","title":"Replace multi-value tuple returns with structs (primitive obsession)","description":"GetBatteryInfo returns 9 values, GetFuelInfo 3, GetTiresInfo 5, etc. Create proper structs: BatteryInfo, FuelInfo, TireInfo, LocationInfo, OdometerInfo, WindowInfo, HVACInfo. DoorStatus already does this correctly - follow that pattern. Affects types.go lines 246-409 and all callers in status.go.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-18T23:38:58.332004-08:00","updated_at":"2025-12-19T00:35:07.517347-08:00","closed_at":"2025-12-19T00:35:07.517347-08:00","close_reason":"Replaced multi-value tuples with proper structs: BatteryInfo, FuelInfo, TireInfo, LocationInfo, OdometerInfo, WindowStatus, HVACInfo"}
{"id":"mcs-swy","title":"Add --confirm flag to 'mcs climate off' command","description":"## Summary\nAdd a `--confirm` flag (enabled by default) to the `mcs climate off` command that polls vehicle status until HVAC is confirmed off, instead of the current fire-and-forget behavior.\n\n## Current Behavior\nThe `mcs climate off` command sends the HVAC off request to the API and immediately returns with a success message, without verifying HVAC actually turned off.\n\n## Desired Behavior\n- Add `--confirm` flag (default: true) to poll status after sending HVAC off command\n- Use polling logic similar to `refreshAndWaitForStatus` in `status_cmd.go:257`\n- Poll until `GetHvacInfo()` shows `On: false` (HVACStatusOff = 0)\n- Support `--confirm-wait` flag to configure max wait time (default: 90s)\n- Use `--confirm=false` to skip confirmation and use fire-and-forget behavior\n- Show progress messages while waiting (e.g., \"Waiting for HVAC off confirmation... (30s/90s)\")\n\n## Files to Modify\n- `internal/cli/climate.go` - Add flag handling\n- `internal/cli/command_factory.go` - May need to extend SimpleCommandConfig to support confirmation\n- Reuse shared polling logic from lock --confirm implementation\n\n## Development Guidelines\n- **TDD**: Write tests first, then implementation\n- **DTSTTCPW**: Do the simplest thing that could possibly work\n- **DRY**: Reuse polling logic from previous --confirm implementations\n- **No lint ignores**: All code must pass golangci-lint without ignores\n- **No failing tests**: All tests must pass before committing\n- **Small frequent commits**: Commit after each logical change\n- **Attention to detail and quality**: Clean code, proper error handling, good UX","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-19T11:00:30.236333-08:00","updated_at":"2025-12-19T12:33:14.547291-08:00","closed_at":"2025-12-19T12:33:14.547291-08:00","close_reason":"Implemented --confirm flag using existing polling infrastructure"}
{"id":"mcs-sz0","title":"Refactor status subcommand creation to use loop","description":"status_cmd.go lines 34-77 manually create 5 subcommands with repetitive structure. Use configuration slice and loop.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T08:10:21.142722-08:00","updated_at":"2025-12-19T09:03:47.399158-08:00","closed_at":"2025-12-19T09:03:47.399158-08:00","close_reason":"Converted 5 manual subcommands to loop-based creation, 45% code reduction"}
{"id":"mcs-szo","title":"CLAUDE.md: Status Constants section incomplete - missing several constants","description":"## Problem\n\nCLAUDE.md documents Status Constants but is missing several that exist in types.go.\n\nMissing from docs:\n- ChargeStatusNotCharging = 0\n- DefrosterOn = 1, DefrosterOff = 0\n- HazardLightsOn = 1, HazardLightsOff = 0\n- ResultCodeSuccess = \"200S00\"\n\nAlso, the documented format uses inline comments, but actual code uses Go const blocks with detailed doc comments.\n\n## Location\n- /Users/carlosvillela/src/dummy/mysmartcar/mcs/CLAUDE.md (lines 89-113)\n- /Users/carlosvillela/src/dummy/mysmartcar/mcs/internal/api/types.go (lines 519-603)\n\n## How to Fix\nEither:\n1. Add all missing constants to the documentation, OR\n2. Add a note that this is not exhaustive and refer readers to types.go for complete list\n\n## Development Guidelines\n- TDD, DTSTTCPW, DRY\n- No lint ignores, no failing tests\n- Small commits, quality focus","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T17:48:08.609241-08:00","updated_at":"2025-12-20T16:39:13.118168-08:00","closed_at":"2025-12-20T16:39:13.118168-08:00","close_reason":"Fixed in docs commit a4d70e1"}
{"id":"mcs-t6u","title":"Extract CLI command factory to reduce boilerplate","description":"## Problem\nCLI command files repeat similar patterns:\n\n- `internal/cli/lock.go` - NewLockCmd(), NewUnlockCmd()\n- `internal/cli/engine.go` - NewStartCmd(), NewStopCmd()  \n- `internal/cli/charge.go` - NewChargeCmd() with subcommands\n\nEach has ~25 lines of boilerplate for command construction.\n\n## Solution\nCreate a factory helper:\n\n```go\nfunc newVehicleCommand(use, short string, action func(context.Context, *api.Client, string) error) *cobra.Command {\n    return \u0026cobra.Command{\n        Use:   use,\n        Short: short,\n        RunE: func(cmd *cobra.Command, args []string) error {\n            return withVehicleClient(cmd.Context(), action)\n        },\n    }\n}\n```\n\n## Trade-off\nReduces lines but adds indirection. Consider if the current explicit approach is more readable.\n\n## Priority\nLow - this is cosmetic cleanup, current code is functional and clear.","status":"closed","priority":4,"issue_type":"chore","created_at":"2025-12-18T23:08:09.151912-08:00","updated_at":"2025-12-18T23:26:27.706105-08:00","closed_at":"2025-12-18T23:26:27.706105-08:00","close_reason":"Implemented command factory pattern, 94 net lines removed, tests added"}
{"id":"mcs-tfk","title":"Add --confirm flag to 'mcs start' command","description":"## Summary\nAdd a `--confirm` flag (enabled by default) to the `mcs start` command that polls vehicle status until the engine is confirmed running, instead of the current fire-and-forget behavior.\n\n## Current Behavior\nThe `mcs start` command sends the engine start request to the API and immediately returns with a success message, without verifying the engine actually started.\n\n## Desired Behavior\n- Add `--confirm` flag (default: true) to poll status after sending start command\n- Use polling logic similar to `refreshAndWaitForStatus` in `status_cmd.go:257`\n- Poll until vehicle status indicates engine is running\n- Support `--confirm-wait` flag to configure max wait time (default: 90s)\n- Use `--confirm=false` to skip confirmation and use fire-and-forget behavior\n- Show progress messages while waiting (e.g., \"Waiting for engine start confirmation... (30s/90s)\")\n\n## Files to Modify\n- `internal/cli/engine.go` - Add flag handling\n- `internal/cli/command_factory.go` - May need to extend SimpleCommandConfig to support confirmation\n- Reuse shared polling logic from lock --confirm implementation\n\n## Development Guidelines\n- **TDD**: Write tests first, then implementation\n- **DTSTTCPW**: Do the simplest thing that could possibly work\n- **DRY**: Reuse polling logic from lock/unlock --confirm implementations\n- **No lint ignores**: All code must pass golangci-lint without ignores\n- **No failing tests**: All tests must pass before committing\n- **Small frequent commits**: Commit after each logical change\n- **Attention to detail and quality**: Clean code, proper error handling, good UX","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-19T11:00:24.190946-08:00","updated_at":"2025-12-19T11:12:03.855131-08:00","closed_at":"2025-12-19T11:12:03.855131-08:00","close_reason":"Implemented --confirm flag using existing polling infrastructure"}
{"id":"mcs-tmr","title":"Add --confirm flag to 'mcs charge start' command","description":"## Summary\nAdd a `--confirm` flag (enabled by default) to the `mcs charge start` command that polls vehicle status until charging is confirmed started, instead of the current fire-and-forget behavior.\n\n## Current Behavior\nThe `mcs charge start` command sends the charge start request to the API and immediately returns with a success message, without verifying charging actually started.\n\n## Desired Behavior\n- Add `--confirm` flag (default: true) to poll status after sending charge start command\n- Use polling logic similar to `refreshAndWaitForStatus` in `status_cmd.go:257`\n- Poll until `GetBatteryInfo()` shows `Charging: true` (ChargeStatusCharging = 6)\n- Support `--confirm-wait` flag to configure max wait time (default: 90s)\n- Use `--confirm=false` to skip confirmation and use fire-and-forget behavior\n- Show progress messages while waiting (e.g., \"Waiting for charging confirmation... (30s/90s)\")\n\n## Files to Modify\n- `internal/cli/charge.go` - Add flag handling\n- `internal/cli/command_factory.go` - May need to extend SimpleCommandConfig to support confirmation\n- Reuse shared polling logic from lock --confirm implementation\n\n## Development Guidelines\n- **TDD**: Write tests first, then implementation\n- **DTSTTCPW**: Do the simplest thing that could possibly work\n- **DRY**: Reuse polling logic from previous --confirm implementations\n- **No lint ignores**: All code must pass golangci-lint without ignores\n- **No failing tests**: All tests must pass before committing\n- **Small frequent commits**: Commit after each logical change\n- **Attention to detail and quality**: Clean code, proper error handling, good UX","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-19T11:00:27.40958-08:00","updated_at":"2025-12-19T12:26:21.796957-08:00","closed_at":"2025-12-19T12:26:21.796957-08:00","close_reason":"Implemented --confirm flag using existing polling infrastructure"}
{"id":"mcs-txnr","title":"Large God object 'Client' violates SRP","description":"The Client struct accumulates many responsibilities (HTTP handling, encryption, caching, logging, token management) and should be split into smaller, focused components","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T23:14:48.734037-08:00","updated_at":"2025-12-20T16:23:13.53894-08:00","closed_at":"2025-12-20T16:23:13.53894-08:00","close_reason":"Vague architectural complaint. Same issue as mcs-57fd. Client has reasonable cohesion - it handles API communication."}
{"id":"mcs-txv","title":"Refactor: Consider builder pattern for complex status display output","description":"## Summary\nThe status display output building is complex with many string concatenations. A builder pattern could make it cleaner.\n\n## Proposed Solution\nConsider a StatusBuilder type for constructing status output more fluently.\n\n## Files to Modify\n- `internal/cli/status_display.go`\n\n## Development Guidelines\n- **TDD**: Write tests first, then implementation\n- **DTSTTCPW**: Do the simplest thing that could possibly work\n- **DRY**: Don't repeat yourself\n- **No lint ignores**: All code must pass `golangci-lint run` without ignores\n- **No failing tests**: All tests must pass before committing\n- **Small frequent commits**: Commit after each logical change\n- **Attention to detail and high quality**: Clean code, proper error handling, good naming","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T13:42:16.025218-08:00","updated_at":"2025-12-19T18:04:31.576372-08:00","closed_at":"2025-12-19T18:04:31.576372-08:00","close_reason":"Not needed - current linear string concatenation is clean and maintainable","comments":[{"id":12,"issue_id":"mcs-txv","author":"carlosvillela","text":"Decision: Closing as not needed.\n\nAfter reviewing the code in status_display.go and status_format.go, the current implementation is clean, maintainable, and follows DTSTTCPW (Do The Simplest Thing That Could Possibly Work).\n\nCurrent approach:\n- displayAllStatus() uses straightforward string concatenation (output += formatXxx())\n- 92 lines of linear, easy-to-read code\n- Each formatter is independently tested and single-purpose\n- Easy to modify, debug, and understand\n\nA builder pattern would:\n- Add abstraction without solving a real problem\n- Increase code complexity and maintenance burden\n- Not provide meaningful benefits in this context\n\nBuilder patterns are valuable when you have:\n- Complex validation between components\n- Multiple output formats requiring different assembly\n- Many optional/conditional sections\n\nThis code has none of those characteristics. It's simple sequential assembly of output strings, which is exactly what string concatenation is designed for.\n\nThe current code is not broken and doesn't need fixing.","created_at":"2025-12-24T19:28:13Z"}]}
{"id":"mcs-u32x","title":"Fix broken build: remove duplicate method declarations in client.go","description":"client.go has duplicate method declarations from line 423 onward: encryptPayloadUsingKey, decryptPayloadUsingKey, decryptPayloadBytes, getSignFromPayloadAndTimestamp (3x), encryptQueryParams, encryptBody, setHeaders, calculateSignature. This causes build failure. The duplicates appear to be remnants from an incomplete refactoring.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-20T13:46:35.992225-08:00","updated_at":"2025-12-20T16:03:39.30188-08:00","closed_at":"2025-12-20T16:03:39.30188-08:00","close_reason":"Fixed: duplicate code was in uncommitted staged changes, not in HEAD. Reverted client.go to clean state, build now passes."}
{"id":"mcs-u9he","title":"Refactor duplicate code flagged by dupl linter","status":"closed","priority":3,"issue_type":"epic","created_at":"2025-12-23T10:06:05.062698-08:00","updated_at":"2025-12-23T14:52:52.744588-08:00","closed_at":"2025-12-23T14:52:52.744588-08:00","close_reason":"All 5 tasks completed, eliminated all 23 duplicate code blocks flagged by dupl linter","dependencies":[{"issue_id":"mcs-u9he","depends_on_id":"mcs-x15n","type":"blocks","created_at":"2025-12-23T10:06:26.514073-08:00","created_by":"daemon"},{"issue_id":"mcs-u9he","depends_on_id":"mcs-3c9w","type":"blocks","created_at":"2025-12-23T10:06:26.630471-08:00","created_by":"daemon"},{"issue_id":"mcs-u9he","depends_on_id":"mcs-sq3f","type":"blocks","created_at":"2025-12-23T10:06:26.746206-08:00","created_by":"daemon"},{"issue_id":"mcs-u9he","depends_on_id":"mcs-05wz","type":"blocks","created_at":"2025-12-23T10:06:26.866947-08:00","created_by":"daemon"},{"issue_id":"mcs-u9he","depends_on_id":"mcs-sucm","type":"blocks","created_at":"2025-12-23T10:06:26.983479-08:00","created_by":"daemon"}]}
{"id":"mcs-ug3f","title":"Add tests for confirmation polling gaps","description":"Add tests for untested confirmation functions in internal/cli/confirm.go:\n- waitForDoorsUnlocked() - 0% coverage\n- GetVehicleStatus adapter - 0% coverage\n- GetEVVehicleStatus adapter - 0% coverage\n- RefreshVehicleStatus adapter - 0% coverage\n\nSimilar pattern to existing waitForDoorsLocked tests.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-21T18:47:37.904564-08:00","updated_at":"2025-12-21T19:04:41.044668-08:00","closed_at":"2025-12-21T19:04:41.044668-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mcs-ug3f","depends_on_id":"mcs-r6kk","type":"blocks","created_at":"2025-12-21T18:47:46.072171-08:00","created_by":"daemon"}]}
{"id":"mcs-uon","title":"Refactor: Extract mock response builders in confirm_test.go","description":"## Summary\nThe confirm_test.go file has verbose mock response builders that are repeated for each test case (createMockVehicleStatusResponse, createMockEVVehicleStatusResponse, etc.).\n\n## Proposed Solution\nExtract common mock builders into test fixtures or a builder pattern for cleaner tests.\n\n## Files to Modify\n- `internal/cli/confirm_test.go`\n- `internal/cli/test_helpers_test.go`\n\n## Development Guidelines\n- **TDD**: Write tests first, then implementation\n- **DTSTTCPW**: Do the simplest thing that could possibly work\n- **DRY**: Don't repeat yourself\n- **No lint ignores**: All code must pass `golangci-lint run` without ignores\n- **No failing tests**: All tests must pass before committing\n- **Small frequent commits**: Commit after each logical change\n- **Attention to detail and high quality**: Clean code, proper error handling, good naming","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T13:39:48.095167-08:00","updated_at":"2025-12-19T15:02:22.464586-08:00","closed_at":"2025-12-19T15:02:22.464586-08:00","close_reason":"Created fluent builder pattern for mock responses, removed 43 lines of duplication"}
{"id":"mcs-vb5r","title":"Encryption key rotation not implemented","description":"The client retrieves encryption keys once and does not rotate them, potentially leading to stale keys being used if the server rotates keys","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T23:14:39.749807-08:00","updated_at":"2025-12-20T16:20:03.687816-08:00","closed_at":"2025-12-20T16:20:03.687816-08:00","close_reason":"Intentionally not implemented. Key rotation was added in mcs-8ho7 and removed in mcs-2mrp - the existing EncryptionError retry logic handles stale keys"}
{"id":"mcs-vfu","title":"Remove unused OtherInformation struct field from Vehicle","description":"## Problem\n`internal/api/types.go:74` has `OtherInformation` field in Vehicle struct, but all actual vehicle data extraction uses `VehicleInformationParsed` (line 250-252).\n\nThe raw `OtherInformation` contains a JSON string that gets parsed into typed fields elsewhere.\n\n## Investigation Needed\n1. Confirm `OtherInformation` field is never accessed directly\n2. Check if removing it breaks JSON unmarshaling\n\n## Solution\nIf unused, remove the field from the struct definition.\n\n## Risk\nLow - this is internal code, not public API.","status":"closed","priority":4,"issue_type":"chore","created_at":"2025-12-18T23:08:08.976993-08:00","updated_at":"2025-12-18T23:21:31.302423-08:00","closed_at":"2025-12-18T23:21:31.302423-08:00","close_reason":"Removed unused OtherInformation field and struct, updated test"}
{"id":"mcs-vhc","title":"Refactor: Add Result type for GetXxxInfo methods instead of tuple returns","description":"## Summary\nThe GetXxxInfo methods return (T, error) tuples. A Result type could make error handling more explicit and chainable.\n\n## Proposed Solution\nConsider adding a Result[T] type for these methods (evaluate if complexity is worth it).\n\n## Files to Modify\n- `internal/api/types.go`\n- `internal/api/vehicle.go`\n\n## Development Guidelines\n- **TDD**: Write tests first, then implementation\n- **DTSTTCPW**: Do the simplest thing that could possibly work\n- **DRY**: Don't repeat yourself\n- **No lint ignores**: All code must pass `golangci-lint run` without ignores\n- **No failing tests**: All tests must pass before committing\n- **Small frequent commits**: Commit after each logical change\n- **Attention to detail and high quality**: Clean code, proper error handling, good naming","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T13:41:16.256825-08:00","updated_at":"2025-12-19T16:20:26.825539-08:00","closed_at":"2025-12-19T16:20:26.825539-08:00","close_reason":"Not needed - Go's (T, error) pattern is idiomatic and sufficient"}
{"id":"mcs-vib","title":"CLAUDE.md: Feistel cipher doc says 16-round but code confirms this - add code reference","description":"## Problem\n\nCLAUDE.md mentions the Feistel cipher uses 16 rounds but doesn't reference where this is documented in code. The code has excellent documentation that could be referenced.\n\nCLAUDE.md line 172:\n`The anti-bot fingerprinting uses a 16-round Feistel cipher (documented in sensordata/sensor_data.go).`\n\nThe code in sensor_data.go (lines 238-299) has excellent documentation explaining:\n- What a Feistel cipher is\n- Why it's used for anti-bot protection\n- Parameter meanings\n- The algorithm details\n\n## Location\n- /Users/carlosvillela/src/dummy/mysmartcar/mcs/CLAUDE.md (line 172)\n- /Users/carlosvillela/src/dummy/mysmartcar/mcs/internal/sensordata/sensor_data.go (lines 238-299)\n\n## How to Fix\nMinor: The documentation is actually consistent. This is a lower priority 'nice to have' - the CLAUDE.md reference is accurate. Could add line numbers to make it easier to find.\n\n## Development Guidelines\n- TDD, DTSTTCPW, DRY\n- No lint ignores, no failing tests\n- Small commits, quality focus","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-19T17:48:52.120732-08:00","updated_at":"2025-12-20T17:21:20.06619-08:00","closed_at":"2025-12-20T17:21:20.06619-08:00","close_reason":"Fixed in docs commit 13fbe00"}
{"id":"mcs-vnku","title":"Hardcoded backoff calculation uses bit shifting; unclear intent for future maintainers","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T23:13:15.888455-08:00","updated_at":"2025-12-20T16:20:04.454884-08:00","closed_at":"2025-12-20T16:20:04.454884-08:00","close_reason":"Not a real issue. Bit shifting for 2^n (1 \u003c\u003c n) is idiomatic Go and common for exponential backoff."}
{"id":"mcs-von","title":"CLI help text includes excessive examples that may go stale","description":"## Problem\n\nCLI command help text (Example fields) contain detailed output examples that could become stale as the output format evolves. The status_cmd.go file has particularly verbose examples including exact output formatting.\n\nFor example, status_cmd.go lines 37-62:\n```go\nExample: `  # Show all vehicle status information\n  mcs status\n\n  # Example output:\n  # CX-90 PHEV (2024)\n  # VIN: JM3XXXXXXXXXX1234\n  # Status as of 2024-03-15 14:30:45 (2 min ago)\n  #\n  # BATTERY: 85% [plugged in, not charging]\n  ...\n`\n```\n\nThis duplicates with README.md which also shows example output (lines 59-75).\n\nIf output format changes, multiple places need updating:\n1. status_cmd.go Example strings\n2. README.md example output\n3. Any other command files with detailed examples\n\n## Location\n- /Users/carlosvillela/src/dummy/mysmartcar/mcs/internal/cli/status_cmd.go (lines 37-62, 78-100, etc.)\n- /Users/carlosvillela/src/dummy/mysmartcar/mcs/README.md (lines 59-75)\n\n## How to Fix\nConsider:\n1. Keep examples minimal in code (just commands, not output)\n2. Have one canonical place for output examples (README or a docs folder)\n3. Or use golden file tests that verify output format matches docs\n\n## Development Guidelines\n- TDD, DTSTTCPW, DRY\n- No lint ignores, no failing tests\n- Small commits, quality focus","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T17:48:41.902194-08:00","updated_at":"2025-12-20T16:32:00.010326-08:00","closed_at":"2025-12-20T16:32:00.010326-08:00","close_reason":"CLI help examples are useful for discoverability. 'May go stale' is speculative and not a current problem."}
{"id":"mcs-vp83","title":"CLAUDE.md: Consider adding section on control commands and confirmation pattern","description":"## Problem\n\nCLAUDE.md has a detailed section on Data Structures but doesn't document the confirmation pattern used for control commands, which is an important architectural pattern.\n\nThe confirm.go file implements a sophisticated confirmation polling system:\n- ConfirmableCommandConfig struct with ActionFunc, WaitFunc, messages\n- executeConfirmableCommand for standardized control flow\n- waitForCondition generic polling function\n- Specific wait functions for doors, engine, charging, HVAC\n\nThis pattern is used by all control commands (lock, unlock, start, stop, charge, climate) and is not obvious from just reading individual command files.\n\n## Location\n- /Users/carlosvillela/src/dummy/mysmartcar/mcs/internal/cli/confirm.go (entire file)\n- /Users/carlosvillela/src/dummy/mysmartcar/mcs/CLAUDE.md (could add section after Data Structures)\n\n## How to Fix\nAdd a 'Control Commands' or 'Command Patterns' section explaining:\n- The confirmable command pattern\n- How wait functions work (polling with timeout)\n- The --confirm and --confirm-wait flags\n\n## Development Guidelines\n- TDD, DTSTTCPW, DRY\n- No lint ignores, no failing tests\n- Small commits, quality focus","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T17:49:45.921047-08:00","updated_at":"2025-12-20T16:32:00.574903-08:00","closed_at":"2025-12-20T16:32:00.574903-08:00","close_reason":"Nice-to-have, low priority. Control commands are self-explanatory from code."}
{"id":"mcs-w1e","title":"Reduce duplication in status_extract.go extraction functions","description":"Lines 19-117 show 8 repetitive extraction patterns (extractBatteryData, extractFuelData, etc). Consider generics or reflection for common extraction logic.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T08:10:07.008675-08:00","updated_at":"2025-12-19T09:19:29.926025-08:00","closed_at":"2025-12-19T09:19:29.926025-08:00","close_reason":"Created 8 *ToMap helper functions, eliminated ~60 lines of duplication across extract and format functions"}
{"id":"mcs-w9a","title":"CLAUDE.md: Response Structs table shows wrong HVACInfo fields","description":"## Problem\n\nCLAUDE.md documents GetHvacInfo() as returning HVACInfo with field 'On', but actual implementation uses 'HVACOn'. Also documents 'Temperature' and 'TemperatureUnit' but actual uses 'InteriorTempC' and 'TargetTempC' (no unit field - always Celsius).\n\nCLAUDE.md line 84:\n`| GetHvacInfo() | HVACInfo | On, FrontDefroster, RearDefroster, Temperature, TemperatureUnit |`\n\nActual code in internal/api/types.go:\n```go\ntype HVACInfo struct {\n    HVACOn         bool\n    FrontDefroster bool\n    RearDefroster  bool\n    InteriorTempC  float64\n    TargetTempC    float64\n}\n```\n\n## Location\n- /Users/carlosvillela/src/dummy/mysmartcar/mcs/CLAUDE.md (line 84)\n- /Users/carlosvillela/src/dummy/mysmartcar/mcs/internal/api/types.go (lines 392-399)\n\n## How to Fix\nUpdate CLAUDE.md to show: 'HVACOn, FrontDefroster, RearDefroster, InteriorTempC, TargetTempC'\n\n## Development Guidelines\n- TDD, DTSTTCPW, DRY\n- No lint ignores, no failing tests\n- Small commits, quality focus","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T17:47:04.857778-08:00","updated_at":"2025-12-19T18:09:20.302319-08:00","closed_at":"2025-12-19T18:09:20.302319-08:00","close_reason":"Fixed Response Structs table to match actual types.go definitions"}
{"id":"mcs-w9m2","title":"Add tests for status display functions","description":"Add tests for status display in internal/cli/:\n- displayAllStatus() - status_display.go:11\n- displayStatusWithVehicle() - status_cmd.go:313\n- formatRelativeTime() - status_format.go:267\n- formatTimestamp() - status_format.go:300\n- formatWindowsStatus() - status_format.go:363\n\nSome of these just need sample VehicleStatusResponse data.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-21T18:47:37.546805-08:00","updated_at":"2025-12-21T20:31:23.720151-08:00","closed_at":"2025-12-21T20:31:23.720151-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mcs-w9m2","depends_on_id":"mcs-r6kk","type":"blocks","created_at":"2025-12-21T18:47:45.811198-08:00","created_by":"daemon"}]}
{"id":"mcs-wlc","title":"EV range display shows incorrect value (610km instead of ~35km)","description":"PHEV showing 610km EV range which is impossible - PHEVs typically have 35-50km EV range. Likely showing fuel range or total range instead of actual EV-only range. Need to investigate which API field is being used and fix the calculation/display in status output.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-19T01:34:10.614427-08:00","updated_at":"2025-12-19T01:36:54.546896-08:00","closed_at":"2025-12-19T01:36:54.546896-08:00","close_reason":"Fixed: SmaphRemDrvDistKm is total range, not EV-only. Removed misleading 'EV range' label.","comments":[{"id":13,"issue_id":"mcs-wlc","author":"carlosvillela","text":"Analysis: The API field SmaphRemDrvDistKm (610km) is being displayed as 'EV range' but it appears to be the TOTAL estimated driving distance (hybrid mode), not EV-only range. Evidence: Fuel range is 620km, battery 'range' is 610km - nearly identical. A PHEV with 43% SOC should have ~15-20km EV-only range, not 610km. Fix: Either calculate true EV range from SOC (SOC% * ~35km max EV range) or remove the misleading 'EV' label.","created_at":"2025-12-24T19:28:13Z"}]}
{"id":"mcs-wune","title":"CLAUDE.md: Request Methods section is overly detailed for high-level doc","description":"## Problem\n\nCLAUDE.md Request Methods section (lines 49-51) documents implementation details that are better discovered from the code itself.\n\nCLAUDE.md:\n```\n### Request Methods\nTwo methods for API requests:\n- APIRequest() → Returns map[string]interface{} for dynamic access\n- APIRequestJSON() → Returns raw bytes for direct unmarshaling to typed structs (preferred)\n```\n\nThis level of detail:\n1. Could go stale if the API changes\n2. Duplicates the godoc on these methods in client.go\n3. The '(preferred)' annotation is subjective and may not always be true\n\nThe code in client.go lines 49-57 already has doc comments explaining these methods.\n\n## Location\n- /Users/carlosvillela/src/dummy/mysmartcar/mcs/CLAUDE.md (lines 49-51)\n- /Users/carlosvillela/src/dummy/mysmartcar/mcs/internal/api/client.go (lines 49-57)\n\n## How to Fix\nEither:\n1. Keep the reference minimal ('See client.go for API request methods'), OR\n2. Focus on when to use each (the 'why') rather than what they return\n\n## Development Guidelines\n- TDD, DTSTTCPW, DRY\n- No lint ignores, no failing tests\n- Small commits, quality focus","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T17:49:35.808432-08:00","updated_at":"2025-12-20T16:32:00.385465-08:00","closed_at":"2025-12-20T16:32:00.385465-08:00","close_reason":"Detail in developer docs is helpful, not a problem. 'Overly detailed' is subjective."}
{"id":"mcs-x15n","title":"Consolidate CLI command boilerplate (charge, climate, engine, lock)","description":"8 command functions share ~45 lines of boilerplate each. Create a generic command builder to reduce ~320 lines to ~100. Files: charge.go, climate.go, engine.go, lock.go","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T10:06:16.547892-08:00","updated_at":"2025-12-23T10:13:05.982595-08:00","closed_at":"2025-12-23T10:13:05.982595-08:00","close_reason":"Created buildConfirmableCommand helper, reduced 8 command functions from ~45 to ~30 lines each"}
{"id":"mcs-y14o","title":"Reduce cyclomatic complexity in CLI layer","description":"6 functions exceed cyclop max of 10:\n- confirm.go:executeConfirmableCommand (11)\n- skill.go:NewSkillInstallCmd (11)\n- status_cmd.go:displayStatusWithVehicle (11)\n- status_display.go:displayAllStatus (11)\n- status_format.go:formatChargeTime (11)\n- status_format.go:formatWindowsStatus (11)\n\nRefactor to reduce branching or extract helpers.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T15:07:51.874612-08:00","updated_at":"2025-12-23T15:20:43.543296-08:00","closed_at":"2025-12-23T15:20:43.543296-08:00","close_reason":"Extracted helpers and used map-based dispatch for 6 functions: executeConfirmableCommand, NewSkillInstallCmd, displayStatusWithVehicle, displayAllStatus, formatChargeTime, formatWindowsStatus"}
{"id":"mcs-y4vd","title":"Reduce cyclomatic complexity in CLI tests","description":"2 test functions exceed cyclop max of 10:\n- confirm_test.go:TestWaitForCondition (14)\n- confirm_test.go:TestWaitForHvacOn (11)\n\nConsider restructuring tests or adding exclusions if complexity is inherent to test structure.","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-23T15:07:52.048789-08:00","updated_at":"2025-12-23T15:39:15.368863-08:00","closed_at":"2025-12-23T15:39:15.368863-08:00","close_reason":"Extracted test helpers: setupMockForWaitCondition, verifyWaitConditionResult, setupMockForHvacOn, verifyHvacOnResult"}
{"id":"mcs-y9vz","title":"Root command help duplicates CLAUDE.md configuration documentation","description":"## Problem\n\nThe root.go CLI command includes detailed configuration documentation in its Long description that duplicates CLAUDE.md.\n\nroot.go lines 34-55:\n```go\nLong: `mcs is a CLI tool for controlling your connected vehicle via manufacturer API.\n\nFeatures:\n  - Check vehicle status (battery, fuel, location, etc.)\n  - Lock/unlock doors\n  ...\n\nConfiguration:\n  Configuration can be loaded from ~/.config/mcs/config.toml or via environment variables.\n\n  Environment variables:\n    MCS_EMAIL     - Your account email\n    MCS_PASSWORD  - Your account password\n    MCS_REGION    - Region (MNAO, MME, or MJO)\n\nExample config.toml:\n  email = \"your.email@example.com\"\n  ...\n`\n```\n\nThis same information appears in:\n- README.md (lines 14-22) - config.toml format\n- README.md (line 22) - environment variables\n- CLAUDE.md doesn't have this, but it's documented in three places\n\n## Location\n- /Users/carlosvillela/src/dummy/mysmartcar/mcs/internal/cli/root.go (lines 44-55)\n- /Users/carlosvillela/src/dummy/mysmartcar/mcs/README.md (lines 14-22)\n\n## How to Fix\nThe CLI help text is appropriate for --help output. README should be the source of truth.\nConsider making CLI help briefer with 'see mcs --help or README for details'.\n\n## Development Guidelines\n- TDD, DTSTTCPW, DRY\n- No lint ignores, no failing tests\n- Small commits, quality focus","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T17:49:04.17847-08:00","updated_at":"2025-12-20T16:32:00.199133-08:00","closed_at":"2025-12-20T16:32:00.199133-08:00","close_reason":"Duplication between CLI help and docs is fine - users access them in different contexts."}
{"id":"mcs-yde","title":"CLAUDE.md: Authentication Flow docs inaccurate - usher prefix missing","description":"## Problem\n\nCLAUDE.md Authentication Flow section lists endpoints without the 'usher/' prefix that some actually have, and uses endpoint names that don't match the constant names in code.\n\nCLAUDE.md line 42-43:\n`1. checkVersion → Get encKey and signKey\n2. usher/system/encryptionKey → Get RSA public key`\n\nBut the code constants in internal/api/auth.go show:\n```go\nEndpointCheckVersion  = \"service/checkVersion\"\nEndpointEncryptionKey = \"system/encryptionKey\"\nEndpointLogin         = \"user/login\"\n```\n\nThe 'usher/' prefix comes from using usherURL as the base, not from the endpoint constant itself.\n\n## Location\n- /Users/carlosvillela/src/dummy/mysmartcar/mcs/CLAUDE.md (lines 42-43)\n- /Users/carlosvillela/src/dummy/mysmartcar/mcs/internal/api/auth.go (lines 50-54)\n\n## How to Fix\nEither show full URLs or clarify that some endpoints use baseURL and some use usherURL as their base.\n\n## Development Guidelines\n- TDD, DTSTTCPW, DRY\n- No lint ignores, no failing tests\n- Small commits, quality focus","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T17:47:50.695905-08:00","updated_at":"2025-12-20T16:39:13.116851-08:00","closed_at":"2025-12-20T16:39:13.116851-08:00","close_reason":"Fixed in docs commit a4d70e1"}
{"id":"mcs-yz4p","title":"Reduce nested if complexity","description":"2 nestif violations:\n- client.go:98 - complex nested blocks in error handling (complexity: 10)\n- status_format.go:56 - nested blocks in batteryInfo.PluggedIn (complexity: 5)\n\nRefactor using early returns, guard clauses, or extracted functions.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T15:07:52.410694-08:00","updated_at":"2025-12-23T15:24:12.549963-08:00","closed_at":"2025-12-23T15:24:12.549963-08:00","close_reason":"Extracted getChargingStatusFlag and getHeaterStatusFlag helpers, removed nestif exclusion from config"}
{"id":"mcs-z0a","title":"Refactor: Simplify API control endpoint methods in control.go","description":"## Summary\nThe control.go file has 11 nearly identical API control methods:\n- DoorLock, DoorUnlock\n- EngineStart, EngineStop\n- ChargeStart, ChargeStop\n- HVACOn, HVACOff, SetHVACSetting\n- etc.\n\nEach method follows the same pattern: build request, call API, check response.\n\n## Proposed Solution\nCreate a generic controlEndpoint method that takes endpoint path and parameters, reducing boilerplate.\n\n## Files to Modify\n- `internal/api/control.go`\n\n## Development Guidelines\n- **TDD**: Write tests first, then implementation\n- **DTSTTCPW**: Do the simplest thing that could possibly work\n- **DRY**: Don't repeat yourself\n- **No lint ignores**: All code must pass `golangci-lint run` without ignores\n- **No failing tests**: All tests must pass before committing\n- **Small frequent commits**: Commit after each logical change\n- **Attention to detail and high quality**: Clean code, proper error handling, good naming","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T13:40:28.14599-08:00","updated_at":"2025-12-19T15:41:12.961107-08:00","closed_at":"2025-12-19T15:41:12.961107-08:00","close_reason":"Created generic controlEndpoint method, reduced SetHVACSetting by 65%"}
{"id":"mcs-z8p","title":"Refactor: Remove redundant SimpleCommandConfig - all commands now use confirmation","description":"## Summary\nSimpleCommandConfig in command_factory.go is no longer used - all commands now use the confirmation pattern with custom RunE functions.\n\n## Proposed Solution\nRemove SimpleCommandConfig and NewSimpleCommand if truly unused, or document why they're kept.\n\n## Files to Modify\n- `internal/cli/command_factory.go`\n\n## Development Guidelines\n- **TDD**: Write tests first, then implementation\n- **DTSTTCPW**: Do the simplest thing that could possibly work\n- **DRY**: Don't repeat yourself\n- **No lint ignores**: All code must pass `golangci-lint run` without ignores\n- **No failing tests**: All tests must pass before committing\n- **Small frequent commits**: Commit after each logical change\n- **Attention to detail and high quality**: Clean code, proper error handling, good naming","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T13:41:23.980051-08:00","updated_at":"2025-12-19T16:33:28.485608-08:00","closed_at":"2025-12-19T16:33:28.485608-08:00","close_reason":"Removed 218 lines of unused SimpleCommandConfig code"}
{"id":"mcs-zach","title":"Address gochecknoglobals violations","description":"9 global variables flagged:\n- auth.go:RegionConfigs (config map - may need exclusion)\n- root.go:Version, ConfigFile, NoColor (CLI flags - may need exclusion)\n- color.go:colorEnabled, colorMu (state - consider refactor)\n- color_test.go:colorTestMutex (test helper)\n- sensordata/system_info.go:screenSizes, androidVersionToSDK (lookup tables - may need exclusion)\n\nEvaluate each: refactor to avoid global state, or add justified exclusions.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T15:07:52.225332-08:00","updated_at":"2025-12-23T15:35:12.389715-08:00","closed_at":"2025-12-23T15:35:12.389715-08:00","close_reason":"Added specific exclusions for 9 justified globals: lookup tables, CLI flags, color state, and test helper"}
{"id":"mcs-zaqj","title":"HTTP requests lack timeout, may hang indefinitely on slow responses","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T23:13:07.779701-08:00","updated_at":"2025-12-20T12:44:05.62715-08:00","closed_at":"2025-12-20T12:44:05.62715-08:00","close_reason":"Closed"}
{"id":"mcs-zby","title":"Tests: Consolidate subcommand test patterns across test files","description":"## Summary\nTest files for subcommands (charge_test.go, climate_test.go, etc.) have similar patterns for testing subcommand behavior but aren't consistent.\n\n## Proposed Solution\nCreate a common test pattern/helper for testing subcommands consistently.\n\n## Files to Modify\n- `internal/cli/charge_test.go`\n- `internal/cli/climate_test.go`\n- `internal/cli/simple_commands_test.go`\n\n## Development Guidelines\n- **TDD**: Write tests first, then implementation\n- **DTSTTCPW**: Do the simplest thing that could possibly work\n- **DRY**: Don't repeat yourself\n- **No lint ignores**: All code must pass `golangci-lint run` without ignores\n- **No failing tests**: All tests must pass before committing\n- **Small frequent commits**: Commit after each logical change\n- **Attention to detail and high quality**: Clean code, proper error handling, good naming","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T13:39:56.589883-08:00","updated_at":"2025-12-19T15:07:04.826139-08:00","closed_at":"2025-12-19T15:07:04.826139-08:00","close_reason":"Created reusable test helpers, eliminated ~94 lines of duplicated test code"}
{"id":"mcs-zh07","title":"Create Homebrew formula for mcs","description":"Create a Homebrew formula that:\n- Builds mcs from source\n- Runs mcs skill install in post_install hook\n- Optionally runs mcs skill uninstall in post_uninstall\n\nFormula should go in a tap repo (homebrew-mcs) or be submitted to homebrew-core.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T17:26:43.139159-08:00","updated_at":"2025-12-21T18:44:56.320377-08:00","closed_at":"2025-12-21T18:44:56.320377-08:00","close_reason":"Added post_install hook to goreleaser config","dependencies":[{"issue_id":"mcs-zh07","depends_on_id":"mcs-3qwd","type":"blocks","created_at":"2025-12-21T17:26:51.454968-08:00","created_by":"daemon"}]}
{"id":"mcs-zhlj","title":"Set up skill directory structure","description":"Create .claude/skills/mcs-control/ directory structure for the skill. This follows Claude Code conventions for project-scoped skills.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T14:31:12.952495-08:00","updated_at":"2025-12-21T14:53:08.486353-08:00","closed_at":"2025-12-21T14:53:08.486353-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mcs-zhlj","depends_on_id":"mcs-cli9","type":"blocks","created_at":"2025-12-21T14:31:21.447737-08:00","created_by":"daemon"}]}
{"id":"mcs-zr7","title":"Refactor: Reduce duplication in waitFor* confirmation functions in confirm.go","description":"## Summary\nThe confirm.go file has 9 nearly identical waitFor* functions:\n- waitForDoorsLocked, waitForDoorsUnlocked\n- waitForEngineRunning, waitForEngineStopped\n- waitForCharging, waitForNotCharging\n- waitForHvacOn, waitForHvacOff, waitForHvacSettings\n\nEach follows the same pattern with only the condition check differing.\n\n## Proposed Solution\nCreate a generic waitForCondition function that takes a condition checker function, reducing duplication significantly.\n\n## Files to Modify\n- `internal/cli/confirm.go`\n- `internal/cli/confirm_test.go`\n\n## Development Guidelines\n- **TDD**: Write tests first, then implementation\n- **DTSTTCPW**: Do the simplest thing that could possibly work\n- **DRY**: Don't repeat yourself\n- **No lint ignores**: All code must pass `golangci-lint run` without ignores\n- **No failing tests**: All tests must pass before committing\n- **Small frequent commits**: Commit after each logical change\n- **Attention to detail and high quality**: Clean code, proper error handling, good naming","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T13:39:32.798851-08:00","updated_at":"2025-12-19T14:22:11.216723-08:00","closed_at":"2025-12-19T14:22:11.216723-08:00","close_reason":"Implemented generic waitForCondition function, reduced ~150 lines of duplication"}
